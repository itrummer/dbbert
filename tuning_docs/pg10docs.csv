dbms,filenr,sentence,KeySentence,Context,Parameter,Formula,Condition
pg,1,Performance Optimization - PostgreSQL wiki,,,,,
pg,1,"Want to edit, but don't see an edit button when logged in?",,,,,
pg,1,Click here,,,,,
pg,1,,,,,,
pg,1,Performance Optimization,,,,,
pg,1,From PostgreSQL wiki,,,,,
pg,1,"Jump to: navigation, search",,,,,
pg,1,Contents,,,,,
pg,1,1 How to Effectively Ask Questions Regarding Performance on Postgres Lists,,,,,
pg,1,2 General Setup and Optimization,,,,,
pg,1,3 Critical maintenance for performance,,,,,
pg,1,4 Database architecture,,,,,
pg,1,5 Database Hardware Selection and Setup,,,,,
pg,1,6 Benchmark Workloads,,,,,
pg,1,How to Effectively Ask Questions Regarding Performance on Postgres Lists,,,,,
pg,1,Slow_Query_Questions,,,,,
pg,1,General Setup and Optimization,,,,,
pg,1,"Tuning Your PostgreSQL Server by Greg Smith, Robert Treat, and Christopher Browne",,,,,
pg,1,PostgreSQL Query Profiler in dbForge Studio by Devart,,,,,
pg,1,Performance Tuning PostgreSQL by Frank Wiles,,,,,
pg,1,QuickStart Guide to Tuning,,,,,
pg,1,PostgreSQL by Christopher Browne,,,,,
pg,1,Performance Tuning by Josh Berkus and Shridhar Daithankar,,,,,
pg,1,Replacing Slow Loops in PostgreSQL by Joel Burton,,,,,
pg,1,PostgreSQL Hardware Performance Tuning by Bruce Momjian,,,,,
pg,1,The effects of data fragmentation in a mixed load database by Dmitry Dvoinikov,,,,,
pg,1,Understanding Postgres Performance by Craig Kerstiens,,,,,
pg,1,More on Postgres Performance by Craig Kerstiens,,,,,
pg,1,Faster PostgreSQL counting by Joe Nelson,,,,,
pg,1,Row count estimates in Postgres by David Conlin,,,,,
pg,1,Index-only scans in Postgres by David Conlin,,,,,
pg,1,Optimize PostgreSQL Server Performance Through Configuration by Tom Swartz,,,,,
pg,1,Performance courses are available from a number of companies,,,,,
pg,1,Check events and trainings for further details,,,,,
pg,1,,,,,,
pg,1,Critical maintenance for performance,,,,,
pg,1,"Introduction to VACUUM, ANALYZE, EXPLAIN, and COUNT by Jim Nasby",,,,,
pg,1,,,,,,
pg,1,VACUUM FULL and why you should avoid it,,,,,
pg,1,Planner Statistics,,,,,
pg,1,Using EXPLAIN,,,,,
pg,1,Logging Difficult Queries,,,,,
pg,1,Logging Checkpoints,,,,,
pg,1,Bulk Loading and Restores,,,,,
pg,1,Performance Analysis Tools by Craig Ringer,,,,,
pg,1,Database architecture,,,,,
pg,1,Limiting and prioritizing user/query/database resource usage by Craig Ringer,,,,,
pg,1,Prioritizing databases by separating into multiple clusters by Craig Ringer,,,,,
pg,1,Clustering,,,,,
pg,1,Shared Storage,,,,,
pg,1,Database Hardware Selection and Setup,,,,,
pg,1,Database Hardware,,,,,
pg,1,Reliable Writes,,,,,
pg,1,Benchmark Workloads,,,,,
pg,1,Category:Benchmarking,,,,,
pg,1,"Retrieved from ""https://wiki",,,,,
pg,1,postgresql,,,,,
pg,1,org/index,,,,,
pg,1,"php?title=Performance_Optimization&oldid=35388""",,,,,
pg,1,Categories: AdministrationPerformanceBenchmarkingGeneral articles and guides,,,,,
pg,1,Navigation menu,,,,,
pg,1,Views,,,,,
pg,1,Page,,,,,
pg,1,Discussion,,,,,
pg,1,View source,,,,,
pg,1,History,,,,,
pg,1,Personal tools,,,,,
pg,1,Log in,,,,,
pg,1,Navigation,,,,,
pg,1,Main Page,,,,,
pg,1,Random page,,,,,
pg,1,Recent changes,,,,,
pg,1,Help,,,,,
pg,1,Search,,,,,
pg,1,Tools,,,,,
pg,1,What links here,,,,,
pg,1,Related changes,,,,,
pg,1,Special pages,,,,,
pg,1,Printable version,,,,,
pg,1,Permanent link,,,,,
pg,1,Page information,,,,,
pg,1,"This page was last edited on 29 September 2020, at 13:37",,,,,
pg,1,,,,,,
pg,1,Privacy policy,,,,,
pg,1,About PostgreSQL wiki,,,,,
pg,1,Disclaimers,,,,,
pg,2,Tuning Your PostgreSQL Server - PostgreSQL wiki,,,,,
pg,2,"Want to edit, but don't see an edit button when logged in?",,,,,
pg,2,Click here,,,,,
pg,2,,,,,,
pg,2,Tuning Your PostgreSQL Server,,,,,
pg,2,From PostgreSQL wiki,,,,,
pg,2,"Jump to: navigation, search",,,,,
pg,2,"by Greg Smith, Robert Treat, and Christopher Browne",,,,,
pg,2,PostgreSQL ships with a basic configuration tuned for wide compatibility rather than performance,,,,,
pg,2,Odds are good the default parameters are very undersized for your system,,,,,
pg,2,"Rather than get dragged into the details of everything you should eventually know (which you can find if you want it at the GUC Three Hour Tour), here we're going to sprint through a simplified view of the basics, with a look at the most common things people new to PostgreSQL aren't aware of",,,,,
pg,2,,,,,,
pg,2,You should click on the name of the parameter in each section to jump to the relevant documentation in the PostgreSQL manual for more details after reading the quick intro here,,,,,
pg,2,,,,,,
pg,2,"There is also additional information available about many of these parameters, as well as a list of parameters you shouldn't adjust, at Server Configuration Tuning",,,,,
pg,2,,,,,,
pg,2,Background Information on Configuration Settings,,,,,
pg,2,"PostgreSQL settings can be manipulated a number of different ways, but generally you will want them changed in your configuration files, either directly or, starting with PostgreSQL 9.4, through ALTER SYSTEM",,,,,
pg,2,"The specific options available change from release to release, the definitive list is in the source code at src/backend/utils/misc/guc",,,,,
pg,2,c for your version of PostgreSQL (but the pg_settings view works well enough for most purposes),,,,,
pg,2,,,,,,
pg,2,The types of settings,,,,,
pg,2,"There are several different types of configuration settings, divided up based on the possible inputs they take",,,,,
pg,2,"Boolean: true, false, on, off",,,,,
pg,2,Integer: Whole numbers,,,,,
pg,2,-2112,,,,,
pg,2,Float: Decimal values (21.12),,,,,
pg,2,"Memory / Disk: Integers (2112) or ""computer units"" (512MB, 2112GB)",,,,,
pg,2,,,,,,
pg,2,Avoid integers--you need to know the underlying unit to figure out what they mean,,,,,
pg,2,,,,,,
pg,2,"Time: ""Time units"" aka d,m,s (30s)",,,,,
pg,2,,,,,,
pg,2,Sometimes the unit is left out; don't do that,,,,,
pg,2,Strings: Single quoted text ('pg_log'),,,,,
pg,2,"ENUMs: Strings, but from a specific list ('WARNING', 'ERROR')",,,,,
pg,2,"Lists: A comma separated list of strings ('""$user"",public,tsearch2)",,,,,
pg,2,When they take effect,,,,,
pg,2,"PostgreSQL settings have different levels of flexibility for when they can be changed, usually related to internal code restrictions",,,,,
pg,2,The complete list of levels is:,,,,,
pg,2,Postmaster: requires restart of server,,,,,
pg,2,"Sighup: requires a HUP of the server, either by kill -HUP (usually -1), pg_ctl reload, or SELECT pg_reload_conf();",,,,,
pg,2,"User: can be set within individual sessions, take effect only within that session",,,,,
pg,2,"Internal: set at compile time, can't be changed, mainly for reference",,,,,
pg,2,Backend: settings which must be set before session start,,,,,
pg,2,Superuser: can be set at runtime for the server by superusers,,,,,
pg,2,"Most of the time you'll only use the first of these, but the second can be useful if you have a server you don't want to take down, while the user session settings can be helpful for some special situations",,,,,
pg,2,,,,,,
pg,2,"You can tell which type of parameter a setting is by looking at the ""context"" field in the pg_settings view",,,,,
pg,2,,,,,,
pg,2,Important notes about configuration files,,,,,
pg,2,Command line options override postgresql,,,,,
pg,2,auto,,,,,
pg,2,conf settings override postgresql,,,,,
pg,2,conf settings,,,,,
pg,2,,,,,,
pg,2,"If the same setting is listed multiple times, the last one wins",,,,,
pg,2,,,,,,
pg,2,You can figure out the postgresql,,,,,
pg,2,conf location with SHOW config_file,,,,,
pg,2,,,,,,
pg,2,It will generally be $PGDATA/postgresql,,,,,
pg,2,"conf (SHOW data_directory), but watch out for symbolic links, postmaster",,,,,
pg,2,opts and other trickiness,,,,,
pg,2,Lines with # are comments and have no effect,,,,,
pg,2,"For a new database, this will mean the setting is using the default, but on running systems this may not hold true! Changes to the configuration files do not take effect without a reload/restart, so it's possible for the system to be running something different from what is in the file",,,,,
pg,2,,,,,,
pg,2,Viewing the current settings,,,,,
pg,2,Look at the configuration files,,,,,
pg,2,,,,,,
pg,2,This is generally not definitive!,,,,,
pg,2,"SHOW ALL, SHOW <setting> will show you the current value of the setting",,,,,
pg,2,,,,,,
pg,2,Watch out for session specific changes,,,,,
pg,2,SELECT * FROM pg_settings will label session specific changes as locally modified,,,,,
pg,2,Tuning tools,,,,,
pg,2,"dbForge Studio for PostgreSQL helps to identify productivity bottlenecks, and provides PostgreSQL performance tuning",,,,,
pg,2,,,,,,
pg,2,The postgresqltuner,,,,,
pg,2,pl script can analyze the configuration and make tuning recommendations,,,,,
pg,2,,,,,,
pg,2,PgBadger analyse PostgreSQL logs to generate performance reports,,,,,
pg,2,,,,,,
pg,2,pgMustard provides tuning advice based on EXPLAIN ANALYZE output,,,,,
pg,2,,,,,,
pg,2,listen_addresses,,,,,
pg,2,"By default, PostgreSQL only responds to connections from the local host",,,,,
pg,2,,,,,,
pg,2,"If you want your server to be accessible from other systems via standard TCP/IP networking, you need to change listen_addresses from its default",,,,,
pg,2,,,,,,
pg,2,The usual approach is to set it to listen to all addresses like this:,,,,,
pg,2,listen_addresses = '*',,,,,
pg,2,And then control who can and cannot connect via the pg_hba,,,,,
pg,2,conf file,,,,,
pg,2,,,,,,
pg,2,max_connections,,,,,
pg,2,max_connections sets exactly that:,,,,,
pg,2,the maximum number of client connections allowed,,,,,
pg,2,,,,,,
pg,2,"This is very important to some of the below parameters (particularly work_mem) because there are some memory resources that are or can be allocated on a per-client basis, so the maximum number of clients suggests the maximum possible memory use",,,,,
pg,2,,,,,,
pg,2,"Generally, PostgreSQL on good hardware can support a few hundred connections",,,,,
pg,2,,,,,,
pg,2,"If you want to have thousands instead, you should consider using connection pooling software to reduce the connection overhead",,,,,
pg,2,,,,,,
pg,2,shared_buffers,,,,,
pg,2,The shared_buffers configuration parameter determines how much memory is dedicated to PostgreSQL to use for caching data,,,,,
pg,2,,,,,,
pg,2,"One reason the defaults are low is because on some platforms (like older Solaris versions and SGI), having large values requires invasive action like recompiling the kernel",,,,,
pg,2,,,,,,
pg,2,"Even on a modern Linux system, the stock kernel will likely not allow setting shared_buffers to over 32MB without adjusting kernel settings first",1,,shared_buffers,P1 < 32MB,
pg,2,,,,,,
pg,2,"(PostgreSQL 9.4 and later use a different shared memory mechanism, so kernel settings will usually not have to be adjusted there",,,,,
pg,2,,,,,,
pg,2,"If you have a system with 1GB or more of RAM, a reasonable starting value for shared_buffers is 1/4 of the memory in your system",1,,shared_buffers,P1 = 0.25 * memory,Memory >= 1GB
pg,2,,,,,,
pg,2,If you have less RAM you'll have to account more carefully for how much RAM the OS is taking up; closer to 15% is more typical there,1,202,shared_buffers,P1 = 0.15 * memory,Memory < 1GB
pg,2,,,,,,
pg,2,"There are some workloads where even larger settings for shared_buffers are effective, but given the way PostgreSQL also relies on the operating system cache, it's unlikely you'll find using more than 40% of RAM to work better than a smaller amount",1,,shared_buffers,P1 < 0.4 * memory,
pg,2,,,,,,
pg,2,"Be aware that if your system or PostgreSQL build is 32-bit, it might not be practical to set shared_buffers above 2 ~ 2.5GB",1,,shared_buffers,P1 < 2.5GB,Bits = 32
pg,2,See this blog post for details,,,,,
pg,2,,,,,,
pg,2,"Note that on Windows, large values for shared_buffers aren't as effective, and you may find better results keeping it relatively low and using the OS cache more instead",,,,,
pg,2,,,,,,
pg,2,On Windows the useful range is 64MB to 512MB,1,211,shared_buffers,P1 < 512MB,OS = Windows
pg,2,,,,,,
pg,2,Changing this setting requires restarting the database,,,,,
pg,2,"Also, this is a hard allocation of memory; the whole thing gets allocated out of virtual memory when the database starts",,,,,
pg,2,,,,,,
pg,2,PostgreSQL 9.2 or earlier,,,,,
pg,2,"If you are running PostgreSQL 9.2 or earlier, it's likely that in order to increase the value of shared_buffers you will have to increase the amount of memory your operating system allows you to allocate to a single shared memory segment",,,,,
pg,2,,,,,,
pg,2,"On UNIX-like systems, if you set it above what's supported, you'll get a message like this:",,,,,
pg,2,"IpcMemoryCreate: shmget(key=5432001, size=415776768, 03600) failed: Invalid argument",,,,,
pg,2,This error usually means that PostgreSQL's request for a shared memory,,,,,
pg,2,segment exceeded your kernel's SHMMAX parameter,,,,,
pg,2,You can either,,,,,
pg,2,reduce the request size or reconfigure the kernel with larger SHMMAX,,,,,
pg,2,,,,,,
pg,2,"To reduce the request size (currently 415776768 bytes), reduce",,,,,
pg,2,PostgreSQL's shared_buffers parameter (currently 50000) and/or,,,,,
pg,2,its max_connections parameter (currently 12),,,,,
pg,2,,,,,,
pg,2,See Managing Kernel Resources for details on how to correct this,,,,,
pg,2,,,,,,
pg,2,effective_cache_size,,,,,
pg,2,"effective_cache_size should be set to an estimate of how much memory is available for disk caching by the operating system and within the database itself, after taking into account what's used by the OS itself and other applications",,,,,
pg,2,,,,,,
pg,2,"This is a guideline for how much memory you expect to be available in the OS and PostgreSQL buffer caches, not an allocation!",,,,,
pg,2,This value is used only by the PostgreSQL query planner to figure out whether plans it's considering would be expected to fit in RAM or not,,,,,
pg,2,,,,,,
pg,2,"If it's set too low, indexes may not be used for executing queries the way you'd expect",,,,,
pg,2,,,,,,
pg,2,"The setting for shared_buffers is not taken into account here--only the effective_cache_size value is, so it should include memory dedicated to the database too",,,,,
pg,2,,,,,,
pg,2,"Setting effective_cache_size to 1/2 of total memory would be a normal conservative setting, and 3/4 of memory is a more aggressive but still reasonable amount",1,,effective_cache_size;effective_cache_size,P >= 0.5 * memory; P <= 0.75 * memory,
pg,2,,,,,,
pg,2,You might find a better estimate by looking at your operating system's statistics,,,,,
pg,2,"On UNIX-like systems, add the free+cached numbers from free or top to get an estimate",,,,,
pg,2,"On Windows see the ""System Cache"" size in the Windows Task Manager's Performance tab",,,,,
pg,2,,,,,,
pg,2,Changing this setting does not require restarting the database (HUP is enough),,,,,
pg,2,,,,,,
pg,2,checkpoint_segments checkpoint_completion_target,,,,,
pg,2,Note: This applies to PostgreSQL 9.4 and below,,,,,
pg,2,PostgreSQL 9.5 introduced min_wal_size and max_wal_size configuration parameters and removed checkpoint_segments,,,,,
pg,2,"Please review the release notes and the documentation on min_wal_size, max_wal_size and WAL configuration",,,,,
pg,2,,,,,,
pg,2,PostgreSQL writes new transactions to the database in files called WAL segments that are 16MB in size,,,,,
pg,2,,,,,,
pg,2,"Every time checkpoint_segments worth of these files have been written, by default 3, a checkpoint occurs",,,,,
pg,2,,,,,,
pg,2,"Checkpoints can be resource intensive, and on a modern system doing one every 48MB will be a serious performance bottleneck",,,,,
pg,2,,,,,,
pg,2,Setting checkpoint_segments to a much larger value improves that,,,,,
pg,2,,,,,,
pg,2,"Unless you're running on a very small configuration, you'll almost certainly be better setting this to at least 10, which also allows usefully increasing the completion target",1,263,checkpoint_segments,P >= 10,
pg,2,,,,,,
pg,2,"For more write-heavy systems, values from 32 (checkpoint every 512MB) to 256 (every 4GB) are popular nowadays",1,263,checkpoint_segments;checkpoint_segments,P >= 32; P <= 256,
pg,2,,,,,,
pg,2,"Very large settings use a lot more disk and will cause your database to take longer to recover, so make sure you're comfortable with both those things before large increases",,,,,
pg,2,,,,,,
pg,2,Normally the large settings (>64/1GB) are only used for bulk loading,1,263,checkpoint_segments,P <= 64,Not bulkloading
pg,2,,,,,,
pg,2,"Note that whatever you choose for the segments, you'll still get a checkpoint at least every 5 minutes unless you also increase checkpoint_timeout (which isn't necessary on most systems)",,,,,
pg,2,,,,,,
pg,2,Checkpoint writes are spread out a bit while the system starts working toward the next checkpoint,,,,,
pg,2,,,,,,
pg,2,"You can spread those writes out further, lowering the average write overhead, by increasing the checkpoint_completion_target parameter to its useful maximum of 0.9 (aim to finish by the time 90% of the next checkpoint is here) rather than the default of 0.5 (aim to finish when the next one is 50% done)",1,,checkpoint_completion_target,P = 0.9,
pg,2,,,,,,
pg,2,A setting of 0 gives something similar to the behavior of obsolete versions,1,277,checkpoint_completion_target,P > 0,
pg,2,,,,,,
pg,2,The main reason the default isn't just 0.9 is that you need a larger checkpoint_segments value than the default for broader spreading to work well,,,,,
pg,2,,,,,,
pg,2,"For lots more information on checkpoint tuning, see Checkpoints and the Background Writer (where you'll also learn why tuning the background writer parameters is challenging to do usefully)",,,,,
pg,2,,,,,,
pg,2,autovacuum,,,,,
pg,2,The autovacuum process takes care of several maintenance chores inside your database that you really need,,,,,
pg,2,"Generally, if you think you need to turn regular vacuuming off because it's taking too much time or resources, that means you're doing it wrong",,,,,
pg,2,,,,,,
pg,2,"The answer to almost all vacuuming problems is to vacuum more often, not less, so that each individual vacuum operation has less to clean up",,,,,
pg,2,,,,,,
pg,2,"However, it's acceptable to disable autovacuum for short periods of time, for instance when bulk loading large amounts of data",1,,autovacuum,P = off,Bulk loading
pg,2,,,,,,
pg,2,Logging,,,,,
pg,2,There are many things you can log that may or may not be important to you,,,,,
pg,2,"You should investigate the documentation on all of the options, but here are some tips & tricks to get you started:",,,,,
pg,2,log_destination & log_directory (& log_filename):,,,,,
pg,2,What you set these options to is not as important as knowing they can give you hints to determine where your database server is logging to,,,,,
pg,2,Best practice would be to try and make this as similar as possible across your servers,,,,,
pg,2,,,,,,
pg,2,"Note that in some cases, the init script starting your database may be customizing the log destination in the command line used to start the database, overriding what's in the configuration files (and making it so you'll get different behavior if you run pg_ctl manually instead of using the init script)",,,,,
pg,2,,,,,,
pg,2,log_min_error_statement:,,,,,
pg,2,"You should probably make sure this is at least on error, so that you will see any SQL commands which cause an error",,,,,
pg,2,should be the default on recent versions,,,,,
pg,2,,,,,,
pg,2,log_min_duration_statement:,,,,,
pg,2,"Not necessary for everyday use, but this can generate logs of ""slow queries"" on your system",,,,,
pg,2,,,,,,
pg,2,log_line_prefix:,,,,,
pg,2,Appends information to the start of each line,,,,,
pg,2,"A good generic recommendation is '%t:%r:%u@%d:[%p]: ' : %t=timestamp, %u=db user name, %r=host connecting from, %d=database connecting to, %p=PID of connection",,,,,
pg,2,"It may not be obvious what the PID is useful at first, but it can be vital for trying to troubleshoot problems in the future so better to put in the logs from the start",,,,,
pg,2,,,,,,
pg,2,log_statement:,,,,,
pg,2,"Choices of none, ddl, mod, all",,,,,
pg,2,Using all or mod in production would introduce overhead of the logging,1,314,log_statement;log_statement,P != all; P != mod,
pg,2,"The performance penalties for ""all"" would be significant if the workload is select intensive and less significant for write-intensive workloads",,,,,
pg,2,Turning the synchronous_commit to off would cause a more severe performance regression,1,,synchronous_commit,P != off,
pg,2,"DDL can sometime be helpful to discover rogue changes made outside of your recommend processes, by ""cowboy DBAs"" for example",,,,,
pg,2,,,,,,
pg,2,"There are also external tools such pgbadger that can analyze Postgres logs, see Monitoring for a comprehensive list",,,,,
pg,2,,,,,,
pg,2,default_statistics_target,,,,,
pg,2,The database software collects statistics about each of the tables in your database to decide how to execute queries against it,,,,,
pg,2,,,,,,
pg,2,If you're not getting good execution query plans particularly on larger (or more varied) tables you should increase default_statistics_target then ANALYZE the database again (or wait for autovacuum to do it for you),,,,,
pg,2,,,,,,
pg,2,Increasing the default_statistics_target may be useful but the default value shipped with PostgreSQL is a reasonable starting point,,,,,
pg,2,,,,,,
pg,2,PostgreSQL 8.3 and earlier,,,,,
pg,2,In PostgreSQL 8.3 and earlier increasing the supplied default_statistics_target would often greatly improve query plans,,,,,
pg,2,The starting default_statistics_target value was raised from 10 to 100 in PostgreSQL 8.4,,,,,
pg,2,"The maximum value for the parameter was also increased from 1000 to 10,000 in 8.4",1,,default_statistics_target,P <= 10000,
pg,2,,,,,,
pg,2,work_mem,,,,,
pg,2,"If you do a lot of complex sorts, and have a lot of memory, then increasing the work_mem parameter allows PostgreSQL to do larger in-memory sorts which, unsurprisingly, will be faster than disk-based equivalents",,,,,
pg,2,,,,,,
pg,2,"This size is applied to each and every sort done by each user, and complex queries can use multiple working memory sort buffers",,,,,
pg,2,"Set it to 50MB, and have 30 users submitting queries, and you are soon using 1.5GB of real memory",,,,,
pg,2,"Furthermore, if a query involves doing merge sorts of 8 tables, that requires 8 times work_mem",,,,,
pg,2,You need to consider what you set max_connections to in order to size this parameter correctly,,,,,
pg,2,"This is a setting where data warehouse systems, where users are submitting very large queries, can readily make use of many gigabytes of memory",,,,,
pg,2,,,,,,
pg,2,"log_temp_files can be used to log sorts, hashes, and temp files which can be useful in figuring out if sorts are spilling to disk instead of fitting in memory",,,,,
pg,2,You can see sorts spilling to disk using EXPLAIN ANALYZE plans as well,,,,,
pg,2,"For example, if you see a line like Sort Method:",,,,,
pg,2,external merge,,,,,
pg,2,"Disk: 7526kB in the output of EXPLAIN ANALYZE, a work_mem of at least 8MB would keep the intermediate data in memory and likely improve the query response time (although it may take substantially more than 8MB to do the sort entirely in memory, as data on disk is stored in a more compact format)",,,,,
pg,2,,,,,,
pg,2,maintenance_work_mem,,,,,
pg,2,"Specifies the maximum amount of memory to be used by maintenance operations, such as VACUUM, CREATE INDEX, and ALTER TABLE ADD FOREIGN KEY",,,,,
pg,2,It defaults to 64 megabytes (64MB) since version 9.4,,,,,
pg,2,"Since only one of these operations can be executed at a time by a database session, and an installation normally doesn't have many of them running concurrently, it's safe to set this value significantly larger than work_mem",1,,maintenance_work_mem,P > work_mem,
pg,2,Larger settings might improve performance for vacuuming and for restoring database dumps,,,,,
pg,2,,,,,,
pg,2,wal_sync_method wal_buffers,,,,,
pg,2,"After every transaction, PostgreSQL forces a commit to disk out to its write-ahead log",,,,,
pg,2,"This can be done a couple of ways, and on some platforms other options than the shipped wal_sync_method are considerably faster than the conservative default",,,,,
pg,2,,,,,,
pg,2,"open_sync is the most common non-default setting switched to, on platforms that support it but default to one of the fsync methods",1,358,wal_sync_method,P = open_sync,
pg,2,See Tuning PostgreSQL WAL Synchronization for a lot of background on this topic,,,,,
pg,2,"Note that open_sync writing is buggy on some platforms (such as Linux), and you should (as always) do plenty of tests under a heavy write load to make sure that you haven't made your system less stable with this change",,,,,
pg,2,,,,,,
pg,2,Reliable Writes contains more information on this topic,,,,,
pg,2,,,,,,
pg,2,"wal_buffers defaults to 1/32 of the size of shared_buffers, with an upper limit of 16MB (reached when shared_buffers=512MB)",,,,,
pg,2,,,,,,
pg,2,Adjustments to the default are required much less often than in earlier PostgreSQL releases,,,,,
pg,2,,,,,,
pg,2,PostgreSQL 9.0 and earlier,,,,,
pg,2,Linux kernels starting with version 2.6.33 cause PostgreSQL versions before 9.0.2 to default to wal_sync_method=open_datasync; before kernel 2.6.32 the default picked was always fdatasync,,,,,
pg,2,,,,,,
pg,2,This can cause a significant performance decrease when combined with small writes and/or small values for wal_buffers,,,,,
pg,2,,,,,,
pg,2,PostgreSQL versions starting with 9.0.2 again default wal_sync_method to fdatasync when running on Linux,,,,,
pg,2,,,,,,
pg,2,"On PostgreSQL 9.0 and earlier, increasing wal_buffers from its tiny default of a small number of kilobytes is helpful for write-heavy systems",,,,,
pg,2,,,,,,
pg,2,"Benchmarking generally suggests that just increasing to 1MB is enough for some large systems, and given the amount of RAM in modern servers allocating a full WAL segment (16MB, the useful upper-limit here) is reasonable",1,377,wal_buffers,P <= 16MB,
pg,2,,,,,,
pg,2,Changing wal_buffers requires a database restart,,,,,
pg,2,,,,,,
pg,2,constraint_exclusion,,,,,
pg,2,constraint_exclusion now defaults to a new choice: partition,,,,,
pg,2,This will only enable constraint exclusion for partitioned tables which is the right thing to do in nearly all cases,,,,,
pg,2,,,,,,
pg,2,max_prepared_transactions,,,,,
pg,2,This setting is used for managing 2 phase commit,,,,,
pg,2,"If you do not use two phase commit (and if you don't know what it is, you don't use it), then you can set this value to 0",1,387,max_prepared_transactions,P = 0,
pg,2,That will save a little bit of shared memory,,,,,
pg,2,"For database systems with a large number (at least hundreds) of concurrent connections, be aware that this setting also affects the number of available lock-slots in pg_locks, so you may want to leave it at the default setting",,,,,
pg,2,,,,,,
pg,2,There is a formula for how much memory gets allocated in the docs and in the default postgresql,,,,,
pg,2,conf,,,,,
pg,2,,,,,,
pg,2,Changing max_prepared_transactions requires a server restart,,,,,
pg,2,,,,,,
pg,2,synchronous_commit,,,,,
pg,2,PostgreSQL can only safely use a write cache if it has a battery backup,,,,,
pg,2,See WAL reliability for an essential introduction to this topic,,,,,
pg,2,,,,,,
pg,2,"No, really; go read that right now, it's vital to understand that if you want your database to work right",,,,,
pg,2,,,,,,
pg,2,You may be limited to approximately 100 transaction commits per second per client in situations where you don't have such a durable write cache (and perhaps only 500/second even with lots of clients),,,,,
pg,2,,,,,,
pg,2,"For situations where a small amount of data loss is acceptable in return for a large boost in how many updates you can do to the database per second, consider switching synchronous commit off",1,,synchronous_commit,P = off,
pg,2,"This is particularly useful in the situation where you do not have a battery-backed write cache on your disk controller, because you could potentially get thousands of commits per second instead of just a few hundred",,,,,
pg,2,,,,,,
pg,2,"For obsolete versions of PostgreSQL, you may find people recommending that you set fsync=off to speed up writes on busy systems",,,,,
pg,2,,,,,,
pg,2,This is dangerous--a power loss could result in your database getting corrupted and not able to start again,1,409,fsync,P != off,
pg,2,,,,,,
pg,2,"Synchronous commit doesn't introduce the risk of corruption, which is really bad, just some risk of data loss",,,,,
pg,2,,,,,,
pg,2,random_page_cost,,,,,
pg,2,"This setting suggests to the optimizer how long it will take your disks to seek to a random disk page, as a multiple of how long a sequential read (with a cost of 1.0) takes",,,,,
pg,2,"If you have particularly fast disks, as commonly found with",,,,,
pg,2,"RAID arrays of SCSI disks, it may be appropriate to lower random_page_cost, which will encourage the query optimizer to use random access index scans",,,,,
pg,2,Some feel that 4.0 is always too large on current hardware; it's not unusual for administrators to standardize on always setting this between 2.0 and 3.0 instead,1,418,random_page_cost;random_page_cost,P >= 2.0; P <= 3.0,
pg,2,,,,,,
pg,2,In some cases that behavior is a holdover from earlier PostgreSQL versions where having random_page_cost too high was more likely to screw up plan optimization than it is now (and setting at or below 2.0 was regularly necessary),,,,,
pg,2,Since these cost estimates are just that--estimates--it shouldn't hurt to try lower values,,,,,
pg,2,,,,,,
pg,2,But this not where you should start to search for plan problems,,,,,
pg,2,Note that random_page_cost is pretty far down this list (at the end in fact),,,,,
pg,2,"If you are getting bad plans, this shouldn't be the first thing you look at, even though lowering this value may be effective",,,,,
pg,2,"Instead, you should start by making sure autovacuum is working properly, that you are collecting enough statistics, and that you have correctly sized the memory parameters for your server--all the things gone over above",,,,,
pg,2,,,,,,
pg,2,"After you've done all those much more important things, if you're still getting bad plans then you should see if lowering random_page_cost is still useful",,,,,
pg,2,,,,,,
pg,2,"Retrieved from ""https://wiki",,,,,
pg,2,postgresql,,,,,
pg,2,org/index,,,,,
pg,2,"php?title=Tuning_Your_PostgreSQL_Server&oldid=35462""",,,,,
pg,2,Categories: AdministrationPerformance,,,,,
pg,2,Navigation menu,,,,,
pg,2,Views,,,,,
pg,2,Page,,,,,
pg,2,Discussion,,,,,
pg,2,View source,,,,,
pg,2,History,,,,,
pg,2,Personal tools,,,,,
pg,2,Log in,,,,,
pg,2,Navigation,,,,,
pg,2,Main Page,,,,,
pg,2,Random page,,,,,
pg,2,Recent changes,,,,,
pg,2,Help,,,,,
pg,2,Search,,,,,
pg,2,Tools,,,,,
pg,2,What links here,,,,,
pg,2,Related changes,,,,,
pg,2,Special pages,,,,,
pg,2,Printable version,,,,,
pg,2,Permanent link,,,,,
pg,2,Page information,,,,,
pg,2,"This page was last edited on 14 October 2020, at 11:57",,,,,
pg,2,,,,,,
pg,2,Privacy policy,,,,,
pg,2,About PostgreSQL wiki,,,,,
pg,2,Disclaimers,,,,,
pg,3,How to tune PostgreSQL for memory | EDB,,,,,
pg,3,Skip to main content,,,,,
pg,3,Barrio main menu,,,,,
pg,3,Why EDB?,,,,,
pg,3,EDB Supercharges PostgreSQL,,,,,
pg,3,wrapper,,,,,
pg,3,Use Cases,,,,,
pg,3,Oracle Migration,,,,,
pg,3,Hybrid Cloud,,,,,
pg,3,High Availability,,,,,
pg,3,Solutions for,,,,,
pg,3,IT Professionals,,,,,
pg,3,Database Architects,,,,,
pg,3,Developers,,,,,
pg,3,Database Admins,,,,,
pg,3,Products,,,,,
pg,3,Products Overview,,,,,
pg,3,wrapper,,,,,
pg,3,Databases,,,,,
pg,3,EDB Postgres Advanced Server,,,,,
pg,3,PostgreSQL,,,,,
pg,3,wrapper,,,,,
pg,3,Tools,,,,,
pg,3,Postgres Enterprise Manager,,,,,
pg,3,Backup and Recovery Tool,,,,,
pg,3,Failover Manager,,,,,
pg,3,Open Source Projects,,,,,
pg,3,Migration Portal,,,,,
pg,3,Migration Toolkit,,,,,
pg,3,Replication Server,,,,,
pg,3,Services,,,,,
pg,3,Services Overview,,,,,
pg,3,Training,,,,,
pg,3,Getting Started,,,,,
pg,3,PostgreSQL Optimization,,,,,
pg,3,Enterprise Strategy,,,,,
pg,3,Custom Services,,,,,
pg,3,Support,,,,,
pg,3,Customer Support Portal,,,,,
pg,3,Support Overview,,,,,
pg,3,PostgreSQL Technical Support,,,,,
pg,3,Remote DBA Service,,,,,
pg,3,Cloud DBA Service,,,,,
pg,3,Technical Account Management,,,,,
pg,3,Resources,,,,,
pg,3,Docs,,,,,
pg,3,wrapper,,,,,
pg,3,Blog,,,,,
pg,3,Webinars,,,,,
pg,3,PostgreSQL Tutorials,,,,,
pg,3,Training,,,,,
pg,3,Partners,,,,,
pg,3,White Papers,,,,,
pg,3,Customer Stories,,,,,
pg,3,Product Compatibility,,,,,
pg,3,Plans,,,,,
pg,3,Barrio utility menu,,,,,
pg,3,Contact,,,,,
pg,3,Dashboard,,,,,
pg,3,Sign In,,,,,
pg,3,Downloads,,,,,
pg,3,Barrio Mobile Menu,,,,,
pg,3,Why EDB?,,,,,
pg,3,EDB Supercharges PostgreSQL,,,,,
pg,3,Use Cases,,,,,
pg,3,Oracle Migration,,,,,
pg,3,Hybrid Cloud,,,,,
pg,3,High Availability,,,,,
pg,3,Solutions for,,,,,
pg,3,IT Professionals,,,,,
pg,3,Database Architects,,,,,
pg,3,Developers,,,,,
pg,3,Database Admins,,,,,
pg,3,Products,,,,,
pg,3,Products Overview,,,,,
pg,3,Databases,,,,,
pg,3,EDB Postgres Advanced Server,,,,,
pg,3,PostgreSQL,,,,,
pg,3,Tools,,,,,
pg,3,Postgres Enterprise Manager,,,,,
pg,3,Backup and Recovery Tool,,,,,
pg,3,Failover Manager,,,,,
pg,3,Open Source Projects,,,,,
pg,3,Migration Portal,,,,,
pg,3,Migration Toolkit,,,,,
pg,3,Replication Server,,,,,
pg,3,Services,,,,,
pg,3,Services Overview,,,,,
pg,3,Training,,,,,
pg,3,Getting Started,,,,,
pg,3,Postgres Optimization,,,,,
pg,3,Enterprise Strategy,,,,,
pg,3,Custom Services,,,,,
pg,3,Support,,,,,
pg,3,Support Overview,,,,,
pg,3,PostgreSQL Technical Support,,,,,
pg,3,Remote DBA Service,,,,,
pg,3,Cloud DBA Service,,,,,
pg,3,Technical Account Management,,,,,
pg,3,Resources,,,,,
pg,3,Docs,,,,,
pg,3,Blog,,,,,
pg,3,Webinars,,,,,
pg,3,Postgres Tutorials,,,,,
pg,3,Training,,,,,
pg,3,Partners,,,,,
pg,3,White Papers,,,,,
pg,3,Customer Stories,,,,,
pg,3,Product Compatibility,,,,,
pg,3,Plans,,,,,
pg,3,Downloads,,,,,
pg,3,Contact,,,,,
pg,3,Sign In,,,,,
pg,3,Dashboard,,,,,
pg,3,PostgreSQL Tutorials,,,,,
pg,3,Back,,,,,
pg,3,How to tune PostgreSQL for memory,,,,,
pg,3,Tuning,,,,,
pg,3,Tushar Ahuja,,,,,
pg,3,Sr,,,,,
pg,3,QA Manager,,,,,
pg,3,"Apr 6, 2020",,,,,
pg,3,This article looks at parameters that can be used to help manage memory in PostgreSQL,,,,,
pg,3,Recommended settings for each parameter are also provided,,,,,
pg,3,,,,,,
pg,3,1,,,,,
pg,3,Shared_buffers (integer),,,,,
pg,3,2,,,,,
pg,3,Work_mem (integer),,,,,
pg,3,3,,,,,
pg,3,Maintenance_work_mem (integer),,,,,
pg,3,4,,,,,
pg,3,Effective_cache_size (integer),,,,,
pg,3,"In this post, we are going to look at some of the important GUC parameters recommended for memory management in PostgreSQL, which is helpful for improving the performance of your database server",,,,,
pg,3,All of these parameters reside under the postgresql,,,,,
pg,3,"conf file (inside $PDATA directory), which manages the configurations of the database server",,,,,
pg,3,,,,,,
pg,3,shared_buffers (integer),,,,,
pg,3,The shared_buffers parameter determines how much memory is dedicated to the server for caching data,,,,,
pg,3,,,,,,
pg,3,"The default value for this parameter, which is set in postgresql",,,,,
pg,3,"conf, is:",,,,,
pg,3,#shared_buffers = 128MB,,,,,
pg,3,The value should be set to 15% to 25% of the machine’s total RAM,1,604,shared_buffers;shared_buffers,P >= 0.15 * memory; P <= 0.25 * memory,
pg,3,"For example: if your machine’s RAM size is 32 GB, then the recommended value for shared_buffers is 8 GB",1,604,shared_buffers,P = 8GB,Memory = 32GB
pg,3,Please note that the database server needs to be restarted after this change,,,,,
pg,3,,,,,,
pg,3,work_mem (integer),,,,,
pg,3,The work_mem parameter basically provides the amount of memory to be used by internal sort operations and hash tables before writing to temporary disk files,,,,,
pg,3,"Sort operations are used for order by, distinct, and merge join operations",,,,,
pg,3,Hash tables are used in hash joins and hash based aggregation,,,,,
pg,3,,,,,,
pg,3,"The default value for this parameter, which is set in postgresql",,,,,
pg,3,"conf, is:",,,,,
pg,3,#work_mem = 4MB,,,,,
pg,3,"Setting the correct value of work_mem parameter can result in less disk-swapping, and therefore far quicker queries",,,,,
pg,3,,,,,,
pg,3,We can use the formula below to calculate the optimal work_mem value for the database server:,,,,,
pg,3,Total RAM * 0.25 / max_connections,1,619,work_mem,P = 0.25 * memory / max_connections,
pg,3,The max_connections parameter is one of the GUC parameters to specify the maximum number of concurrent connections to the database server,,,,,
pg,3,By default it is set to 100 connections,,,,,
pg,3,,,,,,
pg,3,We can also directly assign work_mem to a role:,,,,,
pg,3,postgres=# alter user test set work_mem='4GB';,,,,,
pg,3,ALTER ROLE,,,,,
pg,3,maintenance_work_mem (integer),,,,,
pg,3,"The maintenance_work_mem parameter basically provides the maximum amount of memory to be used by maintenance operations like vacuum, create index, and alter table add foreign key operations",,,,,
pg,3,,,,,,
pg,3,"The default value for this parameter, which is set in postgresql",,,,,
pg,3,"conf, is:",,,,,
pg,3,#maintenance_work_mem = 64MB,,,,,
pg,3,It’s recommended to set this value higher than work_mem; this can improve performance for vacuuming,1,632,maintenance_work_mem,P > work_mem,
pg,3,In general it should be:,,,,,
pg,3,Total RAM * 0.05,1,632,maintenance_work_mem,P = 0.05 * memory,
pg,3,effective_cache_size (integer),,,,,
pg,3,The effective_cache_size parameter estimates how much memory is available for disk caching by the operating system and within the database itself,,,,,
pg,3,The PostgreSQL query planner decides whether it’s fixed in RAM or not,,,,,
pg,3,"Index scans are most likely to be used against higher values; otherwise, sequential scans will be used if the value is low",,,,,
pg,3,Recommendations are to set Effective_cache_size at 50% of the machine’s total RAM,1,,effective_cache_size,P = 0.5 * memory,
pg,3,,,,,,
pg,3,"For more details and other parameters, please refer to the PostgreSQL documentation: https://www",,,,,
pg,3,postgresql,,,,,
pg,3,org/docs/12/runtime-config-resource,,,,,
pg,3,html,,,,,
pg,3,,,,,,
pg,3,Hope it helps!,,,,,
pg,3,Tushar AhujaSr,,,,,
pg,3,QA Manager,,,,,
pg,3,Ready to take the next step with PostgreSQL? Contact Us,,,,,
pg,3,Barrio main menu,,,,,
pg,3,Why EDB?,,,,,
pg,3,Use Cases,,,,,
pg,3,Oracle Migration,,,,,
pg,3,Hybrid Cloud,,,,,
pg,3,High Availability,,,,,
pg,3,Solutions for,,,,,
pg,3,IT Professionals,,,,,
pg,3,Database Architects,,,,,
pg,3,Developers,,,,,
pg,3,Database Admins,,,,,
pg,3,Products,,,,,
pg,3,Databases,,,,,
pg,3,EDB Postgres Advanced Server,,,,,
pg,3,PostgreSQL,,,,,
pg,3,Tools,,,,,
pg,3,Postgres Enterprise Manager,,,,,
pg,3,Backup and Recovery Tool,,,,,
pg,3,Failover Manager,,,,,
pg,3,Open Source Projects,,,,,
pg,3,Migration Portal,,,,,
pg,3,Migration Toolkit,,,,,
pg,3,Replication Server,,,,,
pg,3,Services,,,,,
pg,3,Services Overview,,,,,
pg,3,Training,,,,,
pg,3,Getting Started,,,,,
pg,3,PostgreSQL Optimization,,,,,
pg,3,Enterprise Strategy,,,,,
pg,3,Custom Services,,,,,
pg,3,Support,,,,,
pg,3,Customer Support Portal,,,,,
pg,3,Support Overview,,,,,
pg,3,PostgreSQL Technical Support,,,,,
pg,3,Remote DBA Service,,,,,
pg,3,Cloud DBA Service,,,,,
pg,3,Technical Account Management,,,,,
pg,3,Resources,,,,,
pg,3,Docs,,,,,
pg,3,Blog,,,,,
pg,3,Webinars,,,,,
pg,3,PostgreSQL Tutorials,,,,,
pg,3,Training,,,,,
pg,3,Partners,,,,,
pg,3,White Papers,,,,,
pg,3,Customer Stories,,,,,
pg,3,Product Compatibility,,,,,
pg,3,Plans,,,,,
pg,3,Company,,,,,
pg,3,About EDB,,,,,
pg,3,PostgreSQL Contributions,,,,,
pg,3,Careers,,,,,
pg,3,Events,,,,,
pg,3,Press Releases,,,,,
pg,3,Media Coverage,,,,,
pg,3,Customers,,,,,
pg,3,Follow Us,,,,,
pg,3,Twitter,,,,,
pg,3,LinkedIn,,,,,
pg,3,Facebook,,,,,
pg,3,YouTube,,,,,
pg,3,Barrio Footer Secondary Menu,,,,,
pg,3,© 2020 EDB,,,,,
pg,3,GDPR,,,,,
pg,3,Privacy Policy,,,,,
pg,3,Terms of Use,,,,,
pg,3,Trademarks,,,,,
pg,3,Select LanguageEnglish (EN)DutchFrenchGermanJapaneseKoreanPortugueseSpanishThis automated translation should not be considered exact and only used to approximate the original English language content,,,,,
pg,3,"EDB does not guarantee the accuracy, reliability, or timeliness of any information translated",,,,,
pg,3,,,,,,
pg,4,PGTune - calculate configuration for PostgreSQL based on the maximum performance for a given hardware configuration,,,,,
pg,4,Loading,,,,,
pg,4,,,,,,
pg,4,,,,,,
pg,5,PostgreSQL Performance Tuning - 2ndQuadrant | PostgreSQL,,,,,
pg,5,2ndQuadrant is now part of EDBBringing together some of the world's top PostgreSQL experts,,,,,
pg,5,,,,,,
pg,5,Mission Critical DatabasesContact Us,,,,,
pg,5,EN,,,,,
pg,5,FR,,,,,
pg,5,IT,,,,,
pg,5,ES,,,,,
pg,5,DE,,,,,
pg,5,PT,,,,,
pg,5,Support & Services,,,,,
pg,5,Support,,,,,
pg,5,24/7 PostgreSQL Support,,,,,
pg,5,Developer Support,,,,,
pg,5,DBA Services,,,,,
pg,5,Remote DBA,,,,,
pg,5,Database Monitoring,,,,,
pg,5,Consulting Services,,,,,
pg,5,Health Check,,,,,
pg,5,Performance Tuning,,,,,
pg,5,Database Security Audit,,,,,
pg,5,PostgreSQL Upgrade,,,,,
pg,5,Migration Services,,,,,
pg,5,Migrate to PostgreSQL,,,,,
pg,5,Migration Assessment,,,,,
pg,5,Products,,,,,
pg,5,Postgres-BDR ®,,,,,
pg,5,PostgreSQL High Availability,,,,,
pg,5,Kubernetes Operators for BDR & PostgreSQL,,,,,
pg,5,Managed PostgreSQL in the Cloud,,,,,
pg,5,Installers,,,,,
pg,5,Postgres Installer,,,,,
pg,5,2UDA,,,,,
pg,5,2ndQPostgres,,,,,
pg,5,pglogical,,,,,
pg,5,Barman,,,,,
pg,5,repmgr,,,,,
pg,5,OmniDB,,,,,
pg,5,SQL Firewall,,,,,
pg,5,Postgres-XL,,,,,
pg,5,Downloads,,,,,
pg,5,Installers,,,,,
pg,5,Postgres Installer,,,,,
pg,5,2UDA – Unified Data Analytics,,,,,
pg,5,Whitepapers,,,,,
pg,5,Business Case for PostgreSQL Support,,,,,
pg,5,AlwaysOn Postgres,,,,,
pg,5,PostgreSQL with High Availability,,,,,
pg,5,Security Best Practices,,,,,
pg,5,BDR,,,,,
pg,5,Case Studies,,,,,
pg,5,Performance Tuning,,,,,
pg,5,BenchPrep,,,,,
pg,5,tastyworks,,,,,
pg,5,Distributed Clusters,,,,,
pg,5,ClickUp,,,,,
pg,5,European Space Agency (ESA),,,,,
pg,5,Telefónica del Sur,,,,,
pg,5,Animal Logic,,,,,
pg,5,Database Administration,,,,,
pg,5,Agilis Systems,,,,,
pg,5,Professional Training,,,,,
pg,5,Met Office,,,,,
pg,5,London & Partners,,,,,
pg,5,Database Upgrades,,,,,
pg,5,Alfred Wegener Institute (AWI),,,,,
pg,5,Database Migration,,,,,
pg,5,International Game Technology (IGT),,,,,
pg,5,Healthcare Software Solutions (HSS),,,,,
pg,5,Navionics,,,,,
pg,5,Postgres Learning Center,,,,,
pg,5,Webinars,,,,,
pg,5,Upcoming Webinars,,,,,
pg,5,Webinar Library,,,,,
pg,5,Whitepapers,,,,,
pg,5,Business Case for PostgreSQL Support,,,,,
pg,5,AlwaysOn Postgres,,,,,
pg,5,PostgreSQL with High Availability,,,,,
pg,5,Security Best Practices,,,,,
pg,5,BDR,,,,,
pg,5,Blog,,,,,
pg,5,Training,,,,,
pg,5,Course Catalogue,,,,,
pg,5,Case Studies,,,,,
pg,5,Performance Tuning,,,,,
pg,5,BenchPrep,,,,,
pg,5,tastyworks,,,,,
pg,5,Distributed Clusters,,,,,
pg,5,ClickUp,,,,,
pg,5,European Space Agency (ESA),,,,,
pg,5,Telefónica del Sur,,,,,
pg,5,Animal Logic,,,,,
pg,5,Database Administration,,,,,
pg,5,Agilis Systems,,,,,
pg,5,Professional Training,,,,,
pg,5,Met Office,,,,,
pg,5,London & Partners,,,,,
pg,5,Database Upgrades,,,,,
pg,5,Alfred Wegener Institute (AWI),,,,,
pg,5,Database Migration,,,,,
pg,5,International Game Technology (IGT),,,,,
pg,5,Healthcare Software Solutions (HSS),,,,,
pg,5,Navionics,,,,,
pg,5,Books,,,,,
pg,5,PostgreSQL 11 Administration Cookbook,,,,,
pg,5,PostgreSQL 10 Administration Cookbook,,,,,
pg,5,PostgreSQL High Availability Cookbook – 2nd Edition,,,,,
pg,5,PostgreSQL 9 Administration Cookbook – 3rd Edition,,,,,
pg,5,PostgreSQL Server Programming Cookbook – 2nd Edition,,,,,
pg,5,PostgreSQL 9 Cookbook – Chinese Edition,,,,,
pg,5,Videos,,,,,
pg,5,Events,,,,,
pg,5,PostgreSQL,,,,,
pg,5,PostgreSQL – History,,,,,
pg,5,Who uses PostgreSQL?,,,,,
pg,5,PostgreSQL FAQ,,,,,
pg,5,PostgreSQL vs MySQL,,,,,
pg,5,The Business Case for PostgreSQL,,,,,
pg,5,Security Information,,,,,
pg,5,Documentation,,,,,
pg,5,About Us,,,,,
pg,5,About 2ndQuadrant,,,,,
pg,5,What Does “2ndQuadrant” Mean?,,,,,
pg,5,2ndQuadrant’s Passion for PostgreSQL,,,,,
pg,5,News,,,,,
pg,5,Careers,,,,,
pg,5,Team Profile,,,,,
pg,5,Blog,,,,,
pg,5,Menu,,,,,
pg,5,Menu,,,,,
pg,5,You are here: Home1 / Services2 / PostgreSQL Performance TuningPostgreSQL Performance Tuning,,,,,
pg,5,Boost the Performance of your Database,,,,,
pg,5,,,,,,
pg,5,"You have made significant investments in your hardware, so be sure your database fully utilizes it for your workloads",,,,,
pg,5,"To maximize your ROI, it is crucial for your business to tune your PostgreSQL Database to its top performance",,,,,
pg,5,,,,,,
pg,5,"Although PostgreSQL performs well out-of-the-box, there are several parameters that require further tuning to achieve peak performance for your specific workloads",,,,,
pg,5,"2ndQuadrant provides a personalized service for tuning your database, customized to your organizational needs",,,,,
pg,5,Our PostgreSQL consultants will help you deliver outstanding performance to your customers while ensuring data integrity,,,,,
pg,5,,,,,,
pg,5,On this page:,,,,,
pg,5,7 Good Reasons to get Performance Tuning,,,,,
pg,5,PostgreSQL Performance Tuning Service,,,,,
pg,5,Our Customers’ Experiences,,,,,
pg,5,Performance Tuning Knowledge Base,,,,,
pg,5,Get in touch with us,,,,,
pg,5,What Our Clients Say,,,,,
pg,5,"12“During our daily load test, we observed an immediate 2-4x improvement in peak throughput",,,,,
pg,5,,,,,,
pg,5,"Jordan von Kluck, CTO, tastyworks",,,,,
pg,5,“The goal of having platinum support was very simple – to serve as a backup and safety mechanism for the internal team at BenchPrep,,,,,
pg,5,This allowed the team the ability to work with the professionals at 2ndQuadrant and figure out what we should be tuning and tweaking continuously with regards to the Postgres configuration and also with regards to errors and issues,,,,,
pg,5,"This ensures that we have a very efficient, responsive, and professional team ready to be accessed any time we need",,,,,
pg,5,,,,,,
pg,5,"Nickolay Schwarz, CTO, BenchPrep",,,,,
pg,5,7 Good Reasons to get Performance Tuning,,,,,
pg,5,"Increasing the performance of your Postgres database is of critical importance, whether it is to improve your current architecture or as a preparation to start a new project",,,,,
pg,5,"Every database is different, but these are some of the top indications you can tune the performance of your PostgreSQL database:",,,,,
pg,5,Scalability Analysis,,,,,
pg,5,"Before investing in vertical or horizontal scaling, analyze available headroom in your existing hardware by tuning it for performance",,,,,
pg,5,,,,,,
pg,5,Capacity Planning,,,,,
pg,5,It is important to benchmark the maximum throughput your database can achieve in order to plan the workloads it can handle,,,,,
pg,5,Tune your database before you benchmark,,,,,
pg,5,,,,,,
pg,5,Performance Degradation,,,,,
pg,5,"You are routinely encountering problems in database performance, slowing your applications down",,,,,
pg,5,Optimize your database performance and give your applications a boost,,,,,
pg,5,,,,,,
pg,5,Under-Utilized Hardware,,,,,
pg,5,"Your database server does not fully utilize available hardware resources, resulting in slower performance than what is achievable",,,,,
pg,5,Tune your database to ensure full utilization of your hardware’s potential,,,,,
pg,5,,,,,,
pg,5,Sub-Optimal Configuration,,,,,
pg,5,Your database is delivering throughput that is lower than what’s achievable because it isn’t customized for your organizational workload,,,,,
pg,5,Optimize your database configuration based on your organizational workloads,,,,,
pg,5,,,,,,
pg,5,Underperforming Queries,,,,,
pg,5,Some frequently executed queries are taking too long to return,,,,,
pg,5,Let our experts guide you on how to optimize these queries,,,,,
pg,5,,,,,,
pg,5,Changing Workloads,,,,,
pg,5,"As businesses grow, workloads can change and/or increase",,,,,
pg,5,Tune your database for performance so it can keep up,,,,,
pg,5,,,,,,
pg,5,PostgreSQL Performance Tuning Service,,,,,
pg,5,"Performance Tuning from 2ndQuadrant includes an in-depth analysis of the following aspects, after which, we provide you with a detailed report of our findings",,,,,
pg,5,The report includes our recommendations to optimize your database for your specific use case and overall business goals,,,,,
pg,5,,,,,,
pg,5,Database Configuration Tuning,,,,,
pg,5,We analyze the configuration parameters of your PostgreSQL database and recommend the optimum configuration for your organizational workload,,,,,
pg,5,"Among other things, we examine the block size of different file systems like ZFS, and recommend optimum configuration",,,,,
pg,5,,,,,,
pg,5,Index Analysis,,,,,
pg,5,"Indexes can be tricky to handle, especially as your data grows",,,,,
pg,5,We analyze your existing indexes and suggest any optimizations,,,,,
pg,5,"In addition to that, we recommend the addition/removal of indexes according to your organizational needs",,,,,
pg,5,,,,,,
pg,5,Table Partition Analysis,,,,,
pg,5,Table partitions are essential to data management and maximizing efficiency when accessing that data,,,,,
pg,5,We analyze and recommend the addition/removal of partitions based on your workloads,,,,,
pg,5,,,,,,
pg,5,Hardware Usage Analysis,,,,,
pg,5,"In order to fully utilize the hardware your database is hosted on, we study the configuration and recommend changes which will ensure full utilization of the power your hardware provides",,,,,
pg,5,,,,,,
pg,5,Connection Pooling Review,,,,,
pg,5,Many users and applications will connect to the database to perform functions they are responsible for; we review your connection pooling strategy to ensure that it’s optimized for your specific use case,,,,,
pg,5,,,,,,
pg,5,Analysis of Slow Running Queries,,,,,
pg,5,"If there are specific queries that you feel are running slower than expected, we perform a detailed analysis to identify potential optimizations accordingly",,,,,
pg,5,,,,,,
pg,5,Operating System Configuration Tuning,,,,,
pg,5,"The OS forms the underlying layer of your database, so configuration parameters for the OS and the hardware it’s hosted on should also be customized for your organizational workload",,,,,
pg,5,"Among other things, we can use pg_buffercache as our guide and make recommendations about shared_buffer parameter setting to optimize for your workload",,,,,
pg,5,,,,,,
pg,5,Storage Partition Analysis,,,,,
pg,5,"Building on the OS configuration, storage disk partitions also tend to play a significant role in the performance of any software the OS hosts",,,,,
pg,5,We examine existing partitions and provide recommendations on their configuration and structure that will enhance processing efficiency,,,,,
pg,5,,,,,,
pg,5,Our Customers’ Experiences,,,,,
pg,5,BenchPrep is a Chicago-based learning success platform which allows organizations to offer test preparation and continued learning programs to users across the globe,,,,,
pg,5,,,,,,
pg,5,"Due to an exponential increase in the demand for online training, the number of organizations using BenchPrep for their learning needs grew significantly",,,,,
pg,5,"The platform, which was originally based on a single Postgres database, started to have performance issues due to the unexpected load",,,,,
pg,5,,,,,,
pg,5,Find out how 2ndQuadrant recommended solutions to help BenchPrep scale their infrastructure and provide an unmatched learning experience to its customers,,,,,
pg,5,,,,,,
pg,5,Download Case Study,,,,,
pg,5,"tastyworks is a retail brokerage firm based in Chicago, IL that is leading a financial revolution for the do-it-yourself investor, and uses PostgreSQL as its backend database for its cutting edge technology applications",,,,,
pg,5,"Shortly after launching, the rapid success of the tastyworks platform created a larger than expected production volume, leading to unforeseen performance issues",,,,,
pg,5,,,,,,
pg,5,"Find out how 2ndQuadrant helped optimize their database with a 4x performance boost and achieve: High Availability, updated PostgreSQL configuration to meet best practices, seamless migration to new servers, and much more!",,,,,
pg,5,Download Case Study,,,,,
pg,5,Performance Tuning Knowledge Base,,,,,
pg,5,Videos,,,,,
pg,5,Postgres Vacuuming Through Pictures Webinar Video,,,,,
pg,5,This webinar was held on 24 July 2019 and covered key concepts of Postgres Vacuum and Autovacuum,,,,,
pg,5,"It included use of diagrams, illustrations, and animations to present Postgres Vacuum, tuning Postgres Vacuum concepts and how tuning Vacuum properly makes a difference in database performance",,,,,
pg,5,Watch the complete webinar video here,,,,,
pg,5,,,,,,
pg,5,Power of Indexing in PostgreSQL Webinar Video,,,,,
pg,5,"The webinar was held on April 4, 2018 and covered the following topics: various ways to access data in PostgreSQL, different types of indexes supported by PostgreSQL, internals of BTree and BRIN indexes, overview of GIN and GiST indexes, how to find missing and unused indexes",,,,,
pg,5,Watch the complete webinar video here,,,,,
pg,5,,,,,,
pg,5,Training,,,,,
pg,5,Advanced Development & Performance,,,,,
pg,5,This class covers important Intermediate and Advanced level details for developers interacting with PostgreSQL,,,,,
pg,5,,,,,,
pg,5,Blogs,,,,,
pg,5,"TPC-H performance since PostgreSQL 8.3			 October 22, 2020/0 Comments/in 2ndQuadrant, PostgreSQL, Tomas' PlanetPostgreSQL /by Tomas VondraIn the first part of this blog series, I’ve presented a couple of benchmark results showing how PostgreSQL OLTP performance changed since 8.3, released in 2008",,,,,
pg,5,"In this part I plan to do the same thing but for analytical / BI queries, processing large amounts of data",,,,,
pg,5,There’s a number of industry benchmarks for testing […],,,,,
pg,5,"Read more OLTP performance since PostgreSQL 8.3			 October 8, 2020/4 Comments/in PostgreSQL, Tomas' PlanetPostgreSQL /by Tomas VondraA couple years ago (at the pgconf",,,,,
pg,5,eu 2014 in Madrid) I presented a talk called “Performance Archaeology” which showed how performance changed in recent PostgreSQL releases,,,,,
pg,5,I did that talk as I think the long-term view is interesting and may give us insights that may be very valuable,,,,,
pg,5,For people who actually work on PostgreSQL […],,,,,
pg,5,"Read more Webinar: KNN Indexing in PostgreSQL [Follow Up]			 May 4, 2020/0 Comments/in Webinars /by Bilal IbrarK-nearest neighbor is a proximity algorithm to find data in order of distance",,,,,
pg,5,"Typically, this data cannot be indexed in advance, as both the centroid and the data can be in constant motion",,,,,
pg,5,"PostgreSQL provides efficient searching algorithms for finding proximity data on the fly, including unique, high-performance indexing options",,,,,
pg,5,For a deeper understanding of […],,,,,
pg,5,Read more,,,,,
pg,5,View All Blogs,,,,,
pg,5,Back to Postgres Support & Services,,,,,
pg,5,Get in touch with us!,,,,,
pg,5,Please fill in the form below and we'll be in touch as soon as possible,,,,,
pg,5,,,,,,
pg,5,Get in touch with us!,,,,,
pg,5,Support & Services,,,,,
pg,5,24/7 Production Support,,,,,
pg,5,Developer Support,,,,,
pg,5,Remote DBA for PostgreSQL,,,,,
pg,5,PostgreSQL Database Monitoring,,,,,
pg,5,PostgreSQL Health Check,,,,,
pg,5,PostgreSQL Performance Tuning,,,,,
pg,5,Database Security Audit,,,,,
pg,5,Upgrade PostgreSQL,,,,,
pg,5,PostgreSQL Migration Assessment,,,,,
pg,5,Migrate from Oracle to PostgreSQL,,,,,
pg,5,Products,,,,,
pg,5,HA Postgres Clusters,,,,,
pg,5,Postgres-BDR®,,,,,
pg,5,2ndQPostgres,,,,,
pg,5,pglogical,,,,,
pg,5,repmgr,,,,,
pg,5,Barman,,,,,
pg,5,Postgres Cloud Manager,,,,,
pg,5,SQL Firewall,,,,,
pg,5,Postgres-XL,,,,,
pg,5,OmniDB,,,,,
pg,5,Postgres Installer,,,,,
pg,5,2UDA,,,,,
pg,5,Postgres Learning Center,,,,,
pg,5,Introducing Postgres,,,,,
pg,5,Blog,,,,,
pg,5,Webinars,,,,,
pg,5,Books,,,,,
pg,5,Videos,,,,,
pg,5,Training,,,,,
pg,5,Case Studies,,,,,
pg,5,Events,,,,,
pg,5,About Us,,,,,
pg,5,About 2ndQuadrant,,,,,
pg,5,What does 2ndQuadrant Mean?,,,,,
pg,5,News,,,,,
pg,5,Careers,,,,,
pg,5,Team Profile,,,,,
pg,5,© 2ndQuadrant Ltd,,,,,
pg,5,All rights reserved,,,,,
pg,5,| Privacy Policy,,,,,
pg,5,TwitterLinkedInFacebookYoutubeMail,,,,,
pg,5,Scroll to top,,,,,
pg,5,Need Help?,,,,,
pg,5,×,,,,,
pg,6,PostgreSQL Performance Tuning Tutorial – Stackify,,,,,
pg,6,PostgreSQL Performance Tuning Tutorial,,,,,
pg,6,Product Features OverviewApplication Performance ManagementCentralized LoggingFull Transaction Tracing,,,,,
pg,6,Menu OverviewApplication Performance ManagementCentralized LoggingFull Transaction Tracing Error TrackingApplication & Server MonitoringReal User MonitoringDeployment Tracking,,,,,
pg,6,"Menu Error TrackingApplication & Server MonitoringReal User MonitoringDeployment TrackingTry Our Code ProfilerWant to write better code? Check our free transaction tracing tool, Prefix!",,,,,
pg,6,Features OverviewApplication Performance ManagementCentralized LoggingFull Transaction TracingError TrackingApplication & Server MonitoringReal User MonitoringDeployment Tracking,,,,,
pg,6,"Menu OverviewApplication Performance ManagementCentralized LoggingFull Transaction TracingError TrackingApplication & Server MonitoringReal User MonitoringDeployment TrackingTry Our Code ProfilerWant to write better code? Check our free transaction tracing tool, Prefix! PricingSolutions By Role For DevelopersFor DevOps",,,,,
pg,6,Menu For DevelopersFor DevOpsBy Technology Azure MonitoringAWS MonitoringCompatibility,,,,,
pg,6,Menu Azure MonitoringAWS MonitoringCompatibilityBy Language,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython,,,,,
pg,6,Menu,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython,,,,,
pg,6,By Role For DevelopersFor DevOps,,,,,
pg,6,Menu For DevelopersFor DevOpsBy Technology Azure MonitoringAWS MonitoringCompatibility,,,,,
pg,6,Menu Azure MonitoringAWS MonitoringCompatibilityBy Language,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython,,,,,
pg,6,Menu,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython Learn Resources BlogeBooksCase StudiesWebinarsROI Calculator,,,,,
pg,6,Menu BlogeBooksCase StudiesWebinarsROI CalculatorTechnical DocumentationSupportIdeas Portal,,,,,
pg,6,Menu DocumentationSupportIdeas Portal,,,,,
pg,6,Resources BlogeBooksCase StudiesWebinarsROI Calculator,,,,,
pg,6,Menu BlogeBooksCase StudiesWebinarsROI CalculatorTechnical DocumentationSupportIdeas Portal,,,,,
pg,6,Menu DocumentationSupportIdeas Portal Login,,,,,
pg,6,Start Free Trial,,,,,
pg,6,Product Features OverviewApplication Performance ManagementCentralized LoggingFull Transaction Tracing,,,,,
pg,6,Menu OverviewApplication Performance ManagementCentralized LoggingFull Transaction Tracing Error TrackingApplication & Server MonitoringReal User MonitoringDeployment Tracking,,,,,
pg,6,"Menu Error TrackingApplication & Server MonitoringReal User MonitoringDeployment TrackingTry Our Code ProfilerWant to write better code? Check our free transaction tracing tool, Prefix!",,,,,
pg,6,Features OverviewApplication Performance ManagementCentralized LoggingFull Transaction TracingError TrackingApplication & Server MonitoringReal User MonitoringDeployment Tracking,,,,,
pg,6,"Menu OverviewApplication Performance ManagementCentralized LoggingFull Transaction TracingError TrackingApplication & Server MonitoringReal User MonitoringDeployment TrackingTry Our Code ProfilerWant to write better code? Check our free transaction tracing tool, Prefix! PricingSolutions By Role For DevelopersFor DevOps",,,,,
pg,6,Menu For DevelopersFor DevOpsBy Technology Azure MonitoringAWS MonitoringCompatibility,,,,,
pg,6,Menu Azure MonitoringAWS MonitoringCompatibilityBy Language,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython,,,,,
pg,6,Menu,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython,,,,,
pg,6,By Role For DevelopersFor DevOps,,,,,
pg,6,Menu For DevelopersFor DevOpsBy Technology Azure MonitoringAWS MonitoringCompatibility,,,,,
pg,6,Menu Azure MonitoringAWS MonitoringCompatibilityBy Language,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython,,,,,
pg,6,Menu,,,,,
pg,6,ETJavaPHPNode,,,,,
pg,6,jsRubyPython Learn Resources BlogeBooksCase StudiesWebinarsROI Calculator,,,,,
pg,6,Menu BlogeBooksCase StudiesWebinarsROI CalculatorTechnical DocumentationSupportIdeas Portal,,,,,
pg,6,Menu DocumentationSupportIdeas Portal,,,,,
pg,6,Resources BlogeBooksCase StudiesWebinarsROI Calculator,,,,,
pg,6,Menu BlogeBooksCase StudiesWebinarsROI CalculatorTechnical DocumentationSupportIdeas Portal,,,,,
pg,6,Menu DocumentationSupportIdeas Portal Login,,,,,
pg,6,"PostgreSQL Performance Tuning Tutorial Lou Bichard November 6, 2018 Developer Tips, Tricks & Resources",,,,,
pg,6,Setting up the database correctly is just the first step in PostgreSQL performance tuning,,,,,
pg,6,"With every table you add and every query you run, your databases will require maintenance and updates to ensure ideal PostgreSQL optimization",,,,,
pg,6,"PostgreSQL optimization is pretty straight-forward, however, there are some things that it needs to know from you, the database admin, in order to run effectively",,,,,
pg,6,"When it comes to PostgreSQL performance tuning an application, one rule applies: don’t optimize early",,,,,
pg,6,Start first by implementing your database and schema,,,,,
pg,6,"Then when you’ve got your optimal setup, you can start to monitor your SQL queries with tools like Retrace",,,,,
pg,6,This is important because PostgreSQL performance tuning is all about trade-offs,,,,,
pg,6,You might accept a slow-running query in one part of your application that isn’t used so often in order to get a lightning-fast response time on a frequently performed query,,,,,
pg,6,"Download your free, two week trial of Retrace today",,,,,
pg,6,Today I’m going to walk you through some different PostgreSQL optimizations,,,,,
pg,6,"First, we’ll go through some of the basic setup options available:Hardware updates—Changes you can make to the physical serverConfiguration—Modifications to the out-of-the-box PostgreSQL configurationVacuuming—Ways in which vacuum settings can improve performanceOnce your system is set up, we’ll see how you can analyze and improve your schema:Analyze your query performance—How to analyze individual queriesAnalyze your logs—How to get information out of your system for analysisIndex for query performance—How adding indexes helps the database to optimize its query plan",,,,,
pg,6,"Tip: Find application errors and performance problems instantly with Stackify RetraceTroubleshooting and optimizing your code is easy with integrated errors, logs and code level performance insights",,,,,
pg,6,,,,,,
pg,6,"Part 1: Best Practices and SetupIn the first part of this article, we’re going to go through how you can alter your basic setup for faster PostgreSQL performance",,,,,
pg,6,"In part 2, I’ll cover how to optimize your system specifics, such as query optimizations",,,,,
pg,6,Let’s get to it!Beefing up your PostgreSQL hardwareThe obvious place to start when it comes to optimizing PostgreSQL performance is looking at the hardware of the system itself,,,,,
pg,6,"Some of the most important factors to your database are the available memory, CPU and disk space, and performance",,,,,
pg,6,"When it comes to hardware updates, you should consider the following:Updating your memory",,,,,
pg,6,Memory is what your system uses to effectively cache data it needs often,,,,,
pg,6,It’s important to keep memory in mind when you’re optimizing your queries later,,,,,
pg,6,"The bigger your cache, the less your database will need to go out to disk—which can be painful for performance",,,,,
pg,6,PostgreSQL tries to hold the most frequently accessed data in memory to make performance improvements based on how your queries are performed and the configuration that you give it,,,,,
pg,6,But we’ll return to memory-based performance optimization later,,,,,
pg,6,Separating the application from the database,,,,,
pg,6,"On the note of increasing memory, if you’re running your database application on the same server as your application, you may want to consider isolating it",,,,,
pg,6,It’ll be difficult to truly analyze and improve your database performance if a separate component is affecting your metrics and environment,,,,,
pg,6,"Database configuration: The what, why, and howSource: pixcove",,,,,
pg,6,comPostgreSQL comes with a set of default configurations,,,,,
pg,6,This default configuration is set up for compatibility and is essentially a best guess that tries to suit all possible use cases of PostgreSQL,,,,,
pg,6,"Luckily for you, that means there are some potential quick wins if you start to tweak the default configuration",,,,,
pg,6,"Before we dive in and go through some of the most common configuration optimizations you can make, it’s worth pointing out that there are several PostgreSQL performance tuning tools available—such as PGTune—that try to do some of this configuration legwork for you",,,,,
pg,6,"Their effectiveness varies, but it might be worth experimenting to the delta between the output of these tools and your current database configuration",,,,,
pg,6,Database configurations in PostgreSQL are made directly in the configuration file (postgresql,,,,,
pg,6,"conf), or through running an ALTER SYSTEM command",,,,,
pg,6,"If you want to see all the current configurations of your database now, simply run the SHOW command as follows:SHOW ALLThis command will list out all of the existing configuration and their settings",,,,,
pg,6,"It’s also important to note that different configurations will apply only in certain conditions, such as a database restart",,,,,
pg,6,Some configuration changes will require a server restart; others will require a reload of the configuration,,,,,
pg,6,"When you’ve made configuration changes to your database, you can see details such as whether a restart is required for your configuration update by running the following command:SELECT * FROM pg_settings WHERE pending_restart = true;PostgreSQL performance tuning configuration changesYou will probably want to modify a lot of different configurations to get the most out of your PostgreSQL database",,,,,
pg,6,Let’s go through some of the main configurations that you can change to get more performance from your system,,,,,
pg,6,max_connectionsConnections are how your applications communicate with your database,,,,,
pg,6,Each connection will require some communication chatter and setup in order to establish,,,,,
pg,6,"However, once established, queries can be sent down the wire to your database",,,,,
pg,6,"Your PostgreSQL database will come with a default number of connections, which you can alter",,,,,
pg,6,"You want to make sure that your applications aren’t unnecessarily connecting, as this can be costly and can impact performance",,,,,
pg,6,"Memory allocations are performed on a per-connection basis, so you’ll want to balance between allocating memory and the number of connections",,,,,
pg,6,checkpoint_segmentsA checkpoint is a periodic action that stores information about your system,,,,,
pg,6,"By default, a checkpoint will run after a number of segments, but depending on your system, you may want to increase this value",,,,,
pg,6,"We’ll talk later in the article about how you can log out your checkpoint data, but checkpoint configuration is important because it can be quite an expensive operation",,,,,
pg,6,"It’s often thought that the default configuration is too aggressive and performs checkpoints too often, so you might want to increase this value to make checkpoints less frequent",,,,,
pg,6,"work_memAs I mentioned earlier, memory allocation and management is a big part of PostgreSQL performance tuning",,,,,
pg,6,"If your system is doing a lot of complex sorts, increasing the sort memory can help the database optimize its configuration for your setup",,,,,
pg,6,"This allows PostgreSQL to cache more data in memory while it performs its sorting, as opposed to making expensive calls to the disk",,,,,
pg,6,random_page_costThis setting essentially is the amount of time that your optimizer should spend reading memory before reaching out to your disk,,,,,
pg,6,"You should alter this setting only when you’ve done other plan-based optimizations that we’ll cover soon, such as vacuuming, indexing, or altering your queries and schema",,,,,
pg,6,"These are just some of the optimizations you can make for database configurations, but there are plenty more",,,,,
pg,6,"Now that you know how to tweak your database setup, let’s look at another area for investigation: vacuuming",,,,,
pg,6,Use vacuuming to avoid bloatThe next area we’re looking at is vacuuming,,,,,
pg,6,A vacuum is a scan that marks tuples as no longer needed so that they can be overwritten,,,,,
pg,6,Failure to do this can mean that you have dead tuples lingering in your system,,,,,
pg,6,These dead tuples are often called bloat,,,,,
pg,6,"Bloat originates mostly from records that are being deleted, updated, or inserted",,,,,
pg,6,"PostgreSQL sets up vacuuming by default, but just as you can configure other settings, you can also set your vacuuming settings",,,,,
pg,6,You can even set vacuuming settings on a per-table basis for more fine-grained optimization,,,,,
pg,6,"To perform a vacuum, you simply run the command:VACUUMIf you want to see the history of previously run vacuums, you can do so by executing the following:SELECT * FROM pg_stat_user_tablesGenerally speaking, regular vacuuming can’t be done enough",,,,,
pg,6,More frequent vacuuming keeps bloat to a minimum and ensures that database performance stays high,,,,,
pg,6,"Although autovacuuming is already set up, you might want to alter the settings to be more aggressive",,,,,
pg,6,Part 2: Analyzing PostgreSQL PerformanceUpfront system configuration will have a limit on PostgreSQL performance increases,,,,,
pg,6,"Although you can do some configuration upfront, a lot of your configuration decisions will be driven by the data and analysis you have of your system",,,,,
pg,6,"You’ll want to optimize how it’s set up, know how it’s being queried, and optimize based on these use cases",,,,,
pg,6,PostgreSQL and the community give us some handy tools for making these optimizations,,,,,
pg,6,"Update Postgres algorithm data with ANALYZEBefore we continue, it’s important to understand the life cycle of a query",,,,,
pg,6,The life cycle is what happens from an initial request to the database right up to the response it sends,,,,,
pg,6,PostgreSQL doesn’t just dip its hand into a big bag of memory,,,,,
pg,6,"When you have a lot of data, crude fetching of your data can lead to performance drops",,,,,
pg,6,"If you’re scanning your database sequentially (often called a table scan) for your data, your performance will scale linearly— more rows, slower performance",,,,,
pg,6,But we can do better than that,,,,,
pg,6,"So what is the life cycle of a query? Initially, there is a transmission of the query string to PostgreSQL",,,,,
pg,6,The query string is then parsed and a plan is created,,,,,
pg,6,Plans are really important,,,,,
pg,6,Plans are the steps that PostgreSQL is going to take to find requested data,,,,,
pg,6,"How you set up your database configuration, your schema, and your indexes (more on indexes soon) will all affect how performant these plans are",,,,,
pg,6,"So, it’ll be important that we understand plans and how to optimize them",,,,,
pg,6,"Finally, the database will perform the plan and retrieve the data",,,,,
pg,6,A discrepancy can occur between the database plan that PostgreSQL intends to use to get your data and the way it actually fetches your data,,,,,
pg,6,This is because PostgreSQL bases its plan on infrequently updated metrics and statistics,,,,,
pg,6,Some data has to be updated periodically so that the statistics used for the plans are up to date,,,,,
pg,6,This is where ANALYZE comes in,,,,,
pg,6,Running the ANALYZE command updates these statistics so that Postgres has a fresh set of data about how to create its plans,,,,,
pg,6,"So, if you’re updating the tables or schema or adding indexes, remember to run an ANALYZE command after so the changes will take effect",,,,,
pg,6,Deeply understand your query performanceOne of the next obvious areas to go to is query optimization,,,,,
pg,6,"The queries that you are running might be inefficient for many reasons, so we’ll need a way to understand what’s going on with these queries—which is where the EXPLAIN command comes in",,,,,
pg,6,EXPLAIN gives you a precise breakdown of how PostgreSQL will execute your query,,,,,
pg,6,"The plan is based on statistics about the table, and it takes into account things like database indexes to find the most efficient path to your data",,,,,
pg,6,But EXPLAIN will only guess and give you a plan that it thinks it will execute,,,,,
pg,6,"You can run EXPLAIN ANALYZE to get not only the information about the predicted plan, but also an update on how the query performed",,,,,
pg,6,"When you’ve got the plan that the database is trying to perform, you can then begin to analyze it",,,,,
pg,6,"Several tools exist to make life easier, such as PEV, which allows you to visualize and understand the output of your EXPLAIN command",,,,,
pg,6,Logs as a source of high-quality PostgreSQL performance tuning dataLet’s assume that you have a running database and you’re looking to debug slow performance in the application,,,,,
pg,6,One way you’ll want to do this is through logs,,,,,
pg,6,Logs are short information statements that the application leaves behind when it performs an action,,,,,
pg,6,You can then gather up these actions and analyze them in a log management tool like Retrace to get a picture of how the system is behaving,,,,,
pg,6,"By default, your application doesn’t log all data",,,,,
pg,6,This is because increases in logging also have an effect on database performance,,,,,
pg,6,"So, while we go through how you can change log settings to analyze performance, remember that the log settings themselves can actually affect performance",,,,,
pg,6,"Logs are emitted to a file in your system, depending on your configuration",,,,,
pg,6,"When you’ve found where your logs are at, you can use a tool such as Retrace to analyze these logs",,,,,
pg,6,"Retrace will tell you stats such as the most frequently run queries, how long the queries take on average, and so on",,,,,
pg,6,These aggregate metrics can give you a better understanding of where you may have performance bottlenecks within your system,,,,,
pg,6,"So, now that we see how great logs are for understanding system performance, how do we go about setting them up or changing them?log_line_prefixThis is the format of your database logs",,,,,
pg,6,"For tools like PGBadger, they’ll need rich data and will also need to know the data format",,,,,
pg,6,Your log line prefix tells PostgreSQL what format to emit its log data in,,,,,
pg,6,"If you want to do any meaningful log analysis, you’ll need to set this value to be compatible with the tooling you are using to analyze your logs",,,,,
pg,6,log_statementThis is the logging level you’re operating at,,,,,
pg,6,Log levels usually refer to the level of detail you want in your logs,,,,,
pg,6,"For instance, do you want absolutely all logs, or only logs of a certain critical type? log_statement has a few different settings, including:ddl, which logs only structural changes to the databasemod, which logs modifications to existing data (basically everything except SELECT)all, which logs … everythinglog_checkpointsAs we discussed in the configuration settings, checkpoints in PostgreSQL are periodic actions that store data about your system",,,,,
pg,6,"These log checkpoints can, if excessive, lead to performance degradations",,,,,
pg,6,"If you suspect this might be the case, by enabling log checkpoints you’ll be able to see rich data about those checkpoints, such as how often they’re running and what could be triggering them",,,,,
pg,6,logging_connectionYou also might want to know information about connections,,,,,
pg,6,"If you’ve only got one application connecting to your database, but you’re seeing many concurrent connections, something could be wrong",,,,,
pg,6,Too many connections flooding your database could also mean that requests are failing to reach the database and could be affecting your application’s end users,,,,,
pg,6,"Now that we’ve got lots of data about our system, what tools do we have for improving the structure of our system to be more performant?Faster queries with database indexesIn a world without indexes, every request to the database would lead to a full scan of the entirety of the table to find the relevant results",,,,,
pg,6,"With a large data set, this can be extremely slow—and that’s where database indexing comes in",,,,,
pg,6,"Just as in a book, indexes give information to your database engine about roughly where in the system the data you’re looking for lives",,,,,
pg,6,"To index our system properly, we need an understanding of our data and how we’re trying to access it",,,,,
pg,6,"Which is why it’s important we have observability and monitoring tools, like Retrace setup to help us",,,,,
pg,6,"Indexes don’t come for free, however; if you updated the content of a book, you’ll have to update the index each time you make a change to the content",,,,,
pg,6,PostgreSQL has a few different types of index,,,,,
pg,6,The difference between these is that they all use a different algorithm,,,,,
pg,6,"The indexes available are B-tree (the default index), Hash, GiST, SP-GiST, and GIN",,,,,
pg,6,PostgreSQL will create implicit indexes when you create a primary key or a unique key constraint,,,,,
pg,6,"However, you will have to add the rest of your indexes manually",,,,,
pg,6,"The basic syntax for an INDEX is:CREATE INDEX index_name ON table_name;However, you shouldn’t use an index in some use cases—for example, when the overhead of using the index exceeds the benefit from the algorithm, such as on a small table",,,,,
pg,6,But tables that have large batch updates performed might also see performance issues,,,,,
pg,6,"It may make sense to remove indexes on these tables temporarily while it’s updating, before restoring indexes",,,,,
pg,6,"There you have it: lightning-fast PostgreSQL performance tuningHopefully, that gives you an understanding of how to start PostgreSQL performance tuning your database",,,,,
pg,6,"Now you should be able to analyze your queries with EXPLAIN, pull out your logs for further insight, and modify your indexes for faster performance",,,,,
pg,6,"Plus, you should be able to tweak your database configuration to match use so you can get the most out of it",,,,,
pg,6,"Just remember, tuning your database will take time and practice",,,,,
pg,6,So be patient and stay curious to find out more about your system to get the best performance results,,,,,
pg,6,"About the Author Latest PostsAbout Lou BichardLou Bichard is a JavaScript full stack engineer with a passion for culture, approach, and delivery",,,,,
pg,6,He believes the best products emerge from high performing teams and practices,,,,,
pg,6,"Lou is a fan and advocate of old-school lean and systems thinking, XP, continuous delivery, and DevOps",,,,,
pg,6,"Flamegraph: How to Visualize Stack Traces and Performance - July 3, 2019Docker Performance Improvement: Tips and Tricks - April 4, 2019Node",,,,,
pg,6,"js Performance Testing and Tuning - January 11, 2019Winston Logger Ultimate Tutorial: Best Practices, Resources, and Tips - December 31, 2018Node",,,,,
pg,6,"js Module Exports – Demystified - December 27, 2018",,,,,
pg,6,a-Retraceapplication performanceDeveloperloggingmonitoringSQL,,,,,
pg,6,Search Stackify Search Topics/KeywordsASP,,,,,
pg,6,NETProduct Updates,,,,,
pg,6,NET CoreApp MonitoringJavaApp Performance TipsAzureError HandlingAWSLogging TipsCloudDevOpsPopular Posts How to Troubleshoot IIS Worker Process (w3wp) High CPU Usage How to Monitor IIS Performance: From the Basics to Advanced IIS Performance Monitoring SQL Performance Tuning: 7 Practical Tips for Developers Looking for New Relic Alternatives & Competitors? Learn Why Developers Pick Retrace 5 Awesome Retrace Logging & Error Tracking FeaturesRecent Posts Site Performance Monitoring Best Practices How To Load Test Your PHP Website Best website load testing services How to Monitor a Windows Process Best 5 Tools for Node,,,,,
pg,6,js Monitoring,,,,,
pg,6,Get In Touch,,,,,
pg,6,Contact UsRequest a DemoStart Free Trial,,,,,
pg,6,"Menu Contact UsRequest a DemoStart Free TrialPO Box 2159Mission, KS 66201816-888-5055",,,,,
pg,6,Facebook,,,,,
pg,6,Twitter,,,,,
pg,6,Youtube,,,,,
pg,6,Linkedin,,,,,
pg,6,Products,,,,,
pg,6,RetracePrefixStackify Hidden Menu Item,,,,,
pg,6,NET MonitoringJava MonitoringPHP MonitoringNode,,,,,
pg,6,js MonitoringRuby MonitoringPython MonitoringRetrace vs New RelicRetrace vs Application Insights,,,,,
pg,6,Menu RetracePrefixStackify Hidden Menu Item,,,,,
pg,6,NET MonitoringJava MonitoringPHP MonitoringNode,,,,,
pg,6,js MonitoringRuby MonitoringPython MonitoringRetrace vs New RelicRetrace vs Application InsightsSolutions,,,,,
pg,6,Application Performance ManagementCentralized LoggingCode ProfilingError TrackingApplication & Server MonitoringReal User MonitoringStackify Hidden Menu ItemFor DevelopersFor DevOps,,,,,
pg,6,Menu Application Performance ManagementCentralized LoggingCode ProfilingError TrackingApplication & Server MonitoringReal User MonitoringStackify Hidden Menu ItemFor DevelopersFor DevOpsResources,,,,,
pg,6,What is APM?PricingCase StudiesBlogDocumentationFree eBooksFree WebinarsVideosIdeas PortalROI CalculatorSupport,,,,,
pg,6,Menu What is APM?PricingCase StudiesBlogDocumentationFree eBooksFree WebinarsVideosIdeas PortalROI CalculatorSupportCompany,,,,,
pg,6,About UsNewsCareersGDPRSecurity InformationTerms & ConditionsPrivacy PolicySitemap,,,,,
pg,6,"Menu About UsNewsCareersGDPRSecurity InformationTerms & ConditionsPrivacy PolicySitemapPO Box 2159Mission, KS 66201816-888-5055",,,,,
pg,6,Facebook,,,,,
pg,6,Twitter,,,,,
pg,6,Youtube,,,,,
pg,6,Linkedin,,,,,
pg,6,© 2020 Stackify,,,,,
pg,6,Monitor SQL queries with Retrace’s lightweight code profiling View detailed snapshots of what your code is doing and how long it takesTrack every SQL query executed by your codeTrack the usage and performance anywhere your code makes HTTP Requests,,,,,
pg,6,Start Your Free Trial Now,,,,,
pg,7,Tuning PostgreSQL Database Parameters to Optimize Performance,,,,,
pg,7,Percona LiveAbout UsContact Us,,,,,
pg,7,Services,,,,,
pg,7,Support,,,,,
pg,7,MySQL Support,,,,,
pg,7,MongoDB Support,,,,,
pg,7,MariaDB Support,,,,,
pg,7,PostgreSQL Support,,,,,
pg,7,DBaaS Support,,,,,
pg,7,High Availability Support,,,,,
pg,7,Flexible Pricing,,,,,
pg,7,Support Tiers,,,,,
pg,7,Technical Account Managers,,,,,
pg,7,Managed Services,,,,,
pg,7,Percona Managed Database Services,,,,,
pg,7,Percona Advanced Managed Database Service,,,,,
pg,7,Consulting,,,,,
pg,7,Percona Cloud Cover,,,,,
pg,7,Percona Open Source Advance,,,,,
pg,7,Percona and Microsoft Azure Partnership,,,,,
pg,7,Policies,,,,,
pg,7,Training,,,,,
pg,7,Products,,,,,
pg,7,MySQL Database Software,,,,,
pg,7,Percona Distribution for MySQL,,,,,
pg,7,Percona Server for MySQL,,,,,
pg,7,Percona XtraDB Cluster,,,,,
pg,7,Percona XtraBackup,,,,,
pg,7,MongoDB Database Software,,,,,
pg,7,Percona Distribution for MongoDB,,,,,
pg,7,Percona Server for MongoDB,,,,,
pg,7,Percona Backup for MongoDB,,,,,
pg,7,PostgreSQL Database Software,,,,,
pg,7,Percona Monitoring and Management,,,,,
pg,7,Percona Kubernetes Operators,,,,,
pg,7,Open Source Database Tools,,,,,
pg,7,Percona Toolkit,,,,,
pg,7,Percona DBaaS Command Line Tool,,,,,
pg,7,Solutions,,,,,
pg,7,Eliminate Vendor Lock-In,,,,,
pg,7,Embrace the Cloud,,,,,
pg,7,Optimize Database Performance,,,,,
pg,7,Reduce Costs and Complexity,,,,,
pg,7,Resources,,,,,
pg,7,Calculators,,,,,
pg,7,Solution Briefs,,,,,
pg,7,White Papers,,,,,
pg,7,Webinars,,,,,
pg,7,Datasheets,,,,,
pg,7,Case Studies,,,,,
pg,7,Ebooks,,,,,
pg,7,Videos,,,,,
pg,7,Technical Presentations,,,,,
pg,7,About,,,,,
pg,7,About Percona,,,,,
pg,7,Contact Us,,,,,
pg,7,Customers,,,,,
pg,7,Careers,,,,,
pg,7,In The News,,,,,
pg,7,Percona Live,,,,,
pg,7,Events,,,,,
pg,7,Survey,,,,,
pg,7,Community,,,,,
pg,7,Forums,,,,,
pg,7,Community Blog,,,,,
pg,7,PMM Community Contributions,,,,,
pg,7,Tuning PostgreSQL Database Parameters to Optimize Performance,,,,,
pg,7,Back to the Homepage 31 Aug 2018 Ibrar Ahmed2019-08-07T09:11:09-04:00 By Ibrar Ahmed,,,,,
pg,7,"Insight for DBAs, Open Source, PostgreSQL",,,,,
pg,7,"database performance, parameters, PostgreSQL, PostgreSQL Performance Tuning",,,,,
pg,7,"4 CommentsOut of the box, the default PostgreSQL configuration is not tuned for any particular workload",,,,,
pg,7,"Default values are set to ensure that PostgreSQL runs everywhere, with the least resources it can consume and so that it doesn’t cause any vulnerabilities",,,,,
pg,7,It has default settings for all of the database parameters,,,,,
pg,7,It is primarily the responsibility of the database administrator or developer to tune PostgreSQL according to their system’s workload,,,,,
pg,7,"In this blog, we will establish basic guidelines for setting PostgreSQL database parameters to improve database performance according to workload",,,,,
pg,7,"Bear in mind that while optimizing PostgreSQL server configuration improves performance, a database developer must also be diligent when writing queries for the application",,,,,
pg,7,"If queries perform full table scans where an index could be used or perform heavy joins or expensive aggregate operations, then the system can still perform poorly even if the database parameters are tuned",,,,,
pg,7,It is important to pay attention to performance when writing database queries,,,,,
pg,7,"Nevertheless, database parameters are very important too, so let’s take a look at the eight that have the greatest potential to improve performancePostgreSQL’s Tuneable Parametersshared_bufferPostgreSQL uses its own buffer and also uses kernel buffered IO",,,,,
pg,7,"That means data is stored in memory twice, first in PostgreSQL buffer and then kernel buffer",,,,,
pg,7,"Unlike other databases, PostgreSQL does not provide direct IO",,,,,
pg,7,This is called double buffering,,,,,
pg,7,The PostgreSQL buffer is called shared_buffer which is the most effective tunable parameter for most operating systems,,,,,
pg,7,This parameter sets how much dedicated memory will be used by PostgreSQL for cache,,,,,
pg,7,The default value of shared_buffer is set very low and you will not get much benefit from that,,,,,
pg,7,It’s low because certain machines and operating systems do not support higher values,,,,,
pg,7,"But in most modern machines, you need to increase this value for optimal performance",,,,,
pg,7,The recommended value is 25% of your total machine RAM,1,1353,shared_buffers,P = 0.25 * memory,
pg,7,You should try some lower and higher values because in some cases we achieve good performance with a setting over 25%,,,,,
pg,7,The configuration really depends on your machine and the working data set,,,,,
pg,7,"If your working set of data can easily fit into your RAM, then you might want to increase the shared_buffer value to contain your entire database, so that the whole working set of data can reside in cache",,,,,
pg,7,"That said, you obviously do not want to reserve all RAM for PostgreSQL",1,1359,shared_buffers,P < memory,
pg,7,"In production environments, it is observed that a large value for shared_buffer gives really good performance, though you should always benchmark to find the right balance",,,,,
pg,7,Check shared_buffer ValueTransact-SQL,,,,,
pg,7,testdb=# SHOW shared_buffers;,,,,,
pg,7,shared_buffers,,,,,
pg,7,----------------,,,,,
pg,7,128MB,,,,,
pg,7,"(1 row)12345testdb=# SHOW shared_buffers;shared_buffers----------------128MB(1 row) Note: Be careful as some kernels do not allow a bigger value, specifically in Windows there is no use of higher value",,,,,
pg,7,wal_buffersPostgreSQL writes its WAL (write ahead log) record into the buffers and then these buffers are flushed to disk,,,,,
pg,7,"The default size of the buffer, defined by wal_buffers, is 16MB, but if you have a lot of concurrent connections then a higher value can give better performance",,,,,
pg,7,effective_cache_sizeThe effective_cache_size provides an estimate of the memory available for disk caching,,,,,
pg,7,"It is just a guideline, not the exact allocated memory or cache size",,,,,
pg,7,It does not allocate actual memory but tells the optimizer the amount of cache available in the kernel,,,,,
pg,7,"If the value of this is set too low the query planner can decide not to use some indexes, even if they’d be helpful",,,,,
pg,7,"Therefore, setting a large value is always beneficial",,,,,
pg,7,work_memThis configuration is used for complex sorting,,,,,
pg,7,If you have to do complex sorting then increase the value of work_mem for good results,,,,,
pg,7,In-memory sorts are much faster than sorts spilling to disk,,,,,
pg,7,Setting a very high value can cause a memory bottleneck for your deployment environment because this parameter is per user sort operation,,,,,
pg,7,"Therefore, if you have many users trying to execute sort operations, then the system will allocate work_mem * total sort operations  for all users",,,,,
pg,7,Setting this parameter globally can cause very high memory usage,,,,,
pg,7,So it is highly recommended to modify this at the session level,,,,,
pg,7,work_mem = 2MBShell,,,,,
pg,7,"testdb=# SET work_mem TO ""2MB"";",,,,,
pg,7,testdb=# EXPLAIN SELECT * FROM bar ORDER BY bar,,,,,
pg,7,b;,,,,,
pg,7,QUERY PLAN,,,,,
pg,7,-----------------------------------------------------------------------------------,,,,,
pg,7,Gather Merge  (cost=509181.84,,,,,
pg,7,1706542.14 rows=10000116 width=24),,,,,
pg,7,Workers Planned: 4,,,,,
pg,7,->  Sort  (cost=508181.79,,,,,
pg,7,514431.86 rows=2500029 width=24),,,,,
pg,7,Sort Key: b,,,,,
pg,7,->  Parallel Seq Scan on bar  (cost=0.00,,,,,
pg,7,88695.29 rows=2500029 width=24),,,,,
pg,7,"(5 rows)12345678910testdb=# SET work_mem TO ""2MB"";testdb=# EXPLAIN SELECT * FROM bar ORDER BY bar",,,,,
pg,7,b;                                    QUERY PLAN                                     -----------------------------------------------------------------------------------Gather Merge  (cost=509181.84,,,,,
pg,7,1706542.14 rows=10000116 width=24)   Workers Planned: 4   ->  Sort  (cost=508181.79,,,,,
pg,7,514431.86 rows=2500029 width=24)         Sort Key: b         ->  Parallel Seq Scan on bar  (cost=0.00,,,,,
pg,7,88695.29 rows=2500029 width=24)(5 rows) The initial query’s sort node has an estimated cost of 514431.86,,,,,
pg,7,Cost is an arbitrary unit of computation,,,,,
pg,7,"For the above query, we have a work_mem of only 2MB",,,,,
pg,7,"For testing purposes, let’s increase this to 256MB and see if there is any impact on cost",1,1402,work_mem,P = 256MB,
pg,7,work_mem = 256MBShell,,,,,
pg,7,"testdb=# SET work_mem TO ""256MB"";",,,,,
pg,7,testdb=# EXPLAIN SELECT * FROM bar ORDER BY bar,,,,,
pg,7,b;,,,,,
pg,7,QUERY PLAN,,,,,
pg,7,-----------------------------------------------------------------------------------,,,,,
pg,7,Gather Merge  (cost=355367.34,,,,,
pg,7,1552727.64 rows=10000116 width=24),,,,,
pg,7,Workers Planned: 4,,,,,
pg,7,->  Sort  (cost=354367.29,,,,,
pg,7,360617.36 rows=2500029 width=24),,,,,
pg,7,Sort Key: b,,,,,
pg,7,->  Parallel Seq Scan on bar  (cost=0.00,,,,,
pg,7,"88695.29 rows=2500029 width=24)123456789testdb=# SET work_mem TO ""256MB"";testdb=# EXPLAIN SELECT * FROM bar ORDER BY bar",,,,,
pg,7,b;                                    QUERY PLAN                                     -----------------------------------------------------------------------------------Gather Merge  (cost=355367.34,,,,,
pg,7,1552727.64 rows=10000116 width=24)   Workers Planned: 4   ->  Sort  (cost=354367.29,,,,,
pg,7,360617.36 rows=2500029 width=24)         Sort Key: b         ->  Parallel Seq Scan on bar  (cost=0.00,,,,,
pg,7,88695.29 rows=2500029 width=24) The query cost is reduced to 360617.36 from 514431.86 — a 30% reduction,,,,,
pg,7,maintenance_work_memmaintenance_work_mem is a memory setting used for maintenance tasks,,,,,
pg,7,The default value is 64MB,,,,,
pg,7,"Setting a large value helps in tasks like VACUUM, RESTORE, CREATE INDEX, ADD FOREIGN KEY and ALTER TABLE",,,,,
pg,7,maintenance_work_mem = 10MBShell,,,,,
pg,7,postgres=# CHECKPOINT;,,,,,
pg,7,postgres=# SET maintenance_work_mem to '10MB';,,,,,
pg,7,postgres=# CREATE INDEX foo_idx ON foo (c);,,,,,
pg,7,CREATE INDEX,,,,,
pg,7,Time: 170091.371 ms (02:50.091)123456postgres=# CHECKPOINT;postgres=# SET maintenance_work_mem to '10MB'; postgres=# CREATE INDEX foo_idx ON foo (c);CREATE INDEXTime: 170091.371 ms (02:50.091) maintenance_work_mem = 256MBShell,,,,,
pg,7,postgres=# CHECKPOINT;,,,,,
pg,7,postgres=# set maintenance_work_mem to '256MB';,,,,,
pg,7,postgres=# CREATE INDEX foo_idx ON foo (c);,,,,,
pg,7,CREATE INDEX,,,,,
pg,7,"Time: 111274.903 ms (01:51.275)123456postgres=# CHECKPOINT;postgres=# set maintenance_work_mem to '256MB'; postgres=# CREATE INDEX foo_idx ON foo (c);CREATE INDEXTime: 111274.903 ms (01:51.275) The index creation time is 170091.371ms when maintenance_work_mem is set to only 10MB, but that is reduced to 111274.903 ms when we increase maintenance_work_mem setting to 256MB",1,,maintenance_work_mem,P = 256MB,
pg,7,synchronous_commitThis is used to enforce that commit will wait for WAL to be written on disk before returning a success status to the client,,,,,
pg,7,This is a trade-off between performance and reliability,,,,,
pg,7,"If your application is designed such that performance is more important than the reliability, then turn off synchronous_commit",1,,synchronous_commit,P = off,
pg,7,This means that there will be a time gap between the success status and a guaranteed write to disk,,,,,
pg,7,"In the case of a server crash, data might be lost even though the client received a success message on commit",,,,,
pg,7,"In this case, a transaction commits very quickly because it will not wait for a WAL file to be flushed, but reliability is compromised",,,,,
pg,7,"checkpoint_timeout, checkpoint_completion_targetPostgreSQL writes changes into WAL",,,,,
pg,7,The checkpoint process flushes the data into the data files,,,,,
pg,7,This activity is done when CHECKPOINT occurs,,,,,
pg,7,This is an expensive operation and can cause a huge amount of IO,,,,,
pg,7,This whole process involves expensive disk read/write operations,,,,,
pg,7,Users can always issue CHECKPOINT whenever it seems necessary or automate the system by PostgreSQL’s parameters checkpoint_timeout and checkpoint_completion_target,,,,,
pg,7,The checkpoint_timeout parameter is used to set time between WAL checkpoints,,,,,
pg,7,"Setting this too low decreases crash recovery time, as more data is written to disk, but it hurts performance too since every checkpoint ends up consuming valuable system resources",,,,,
pg,7,The checkpoint_completion_target is the fraction of time between checkpoints for checkpoint completion,,,,,
pg,7,A high frequency of checkpoints can impact performance,,,,,
pg,7,"For smooth checkpointing, checkpoint_timeout must be a low value",,,,,
pg,7,Otherwise the OS will accumulate all the dirty pages until the ratio is met and then go for a big flush,,,,,
pg,7,ConclusionThere are more parameters that can be tuned to gain better performance but those have less impact than the ones highlighted here,,,,,
pg,7,"In the end, we must always keep in mind that not all parameters are relevant for all applications types",,,,,
pg,7,Some applications perform better by tuning a parameter and some don’t,,,,,
pg,7,Tuning PostgreSQL Database Parameters must be done for the specific needs of an application and the OS it runs on,,,,,
pg,7,"Related postsYou can read my post about tuning Linux parameters for PostgreSQL database performancePlus another recent post on benchmarks:Tuning PostgreSQL for sysbench-tpccYou May Also LikeIf your PostgreSQL database is running on a Linux OS, be sure to read my post about tuning Linux parameters to optimize PostgreSQL database performance",,,,,
pg,7,"After tuning your PostgreSQL database to improve its performance, the next step is to put your optimized database to the test",,,,,
pg,7,"With sysbench, you can quickly evaluate your database’s performance",,,,,
pg,7,This process is especially important if you plan to run your database under an intensive workload,,,,,
pg,7,"Our blog article, Tuning PostgreSQL for sysbench-tpcc, can guide you through the benchmarking process",,,,,
pg,7,Optimizing your database is one way to course-correct poor database performance,,,,,
pg,7,"However, the problem is not always the database itself! There are several causes that can contribute to your database’s lackluster performance",,,,,
pg,7,Our solution brief details the Top 5 Causes of Poor Database Performance,,,,,
pg,7,"With this crucial information, you can better implement a quick and efficient resolution",,,,,
pg,7,Related,,,,,
pg,7,AuthorIbrar AhmedJoined Percona in the month of July 2018,,,,,
pg,7,"Before joining Percona, Ibrar worked as a Senior Database Architect at EnterpriseDB for 10 Years",,,,,
pg,7,Ibrar has 18 years of software development experience,,,,,
pg,7,Ibrar authored multiple books on PostgreSQL,,,,,
pg,7,Share this postFacebookTwitterLinkedInEmailComments (4),,,,,
pg,7,fpuga,,,,,
pg,7,I understad that most of this suggestions like using 25% of RAM for shared_buffer is for servers that are only running PostgreSQL and not for servers that also run a web server or other services,,,,,
pg,7,"Is this true? September 1, 2018 at 11:42 am",,,,,
pg,7,Ibrar Ahmed,,,,,
pg,7,Most of the tuning advices are for the dedicated “database” server,,,,,
pg,7,In case of shared system where you are running database and some,,,,,
pg,7,other server on a single machine need to be tuned accordingly,,,,,
pg,7,"September 3, 2018 at 10:50 am",,,,,
pg,7,Glyn,,,,,
pg,7,"That shared_buffer advice isn’t great, especially if applied to modern systems with large volumes of ram",,,,,
pg,7,"Generally there’s a tipping point, and it’s much lower than you’d think",,,,,
pg,7,,,,,,
pg,7,A better approach is to use pg_buffercache extension to inspect the system under typical load and tune down,,,,,
pg,7,"September 3, 2018 at 6:26 am",,,,,
pg,7,joshuamills235,,,,,
pg,7,In this post you are very thoughtful,,,,,
pg,7,I am very happy to read this post,,,,,
pg,7,It’s so motivational post for me,,,,,
pg,7,I would like to very thankful for this best and most important information,,,,,
pg,7,For more info :-https://www,,,,,
pg,7,autoupgrades,,,,,
pg,7,co,,,,,
pg,7,"nz/ August 2, 2019 at 9:43 amComments are closed",,,,,
pg,7,Use Percona's Technical Forum to ask any follow-up questions on this blog topic,,,,,
pg,7,,,,,,
pg,7,"How Can We Help? Percona's experts can maximize your application performance with our open source database support, managed services or consulting",,,,,
pg,7,Contact usSubscribeWant to get weekly updates listing the latest blog posts? Subscribe now and we'll send you an update every Friday at 1pm ET,,,,,
pg,7,Subscribe to our blog CategoriesMySQL(3355)Insight for DBAs(1528)Percona Software(1479)Percona Events(870)MongoDB(549)Insight for Developers(472)Benchmarks(340)Percona Live(332)Webinars(287)Cloud(276)PostgreSQL(176)Monitoring(164)MariaDB(157)Percona Services(138)ProxySQL(127)Security(125)Hardware and Storage(105)Storage Engine(52)Database Trends(46)Percona Announcements(10)  Percona Blog RSS Feed,,,,,
pg,7,Upcoming WebinarsThe Open Source Alternative to Paying for MongoDBWhy PostgreSQL Is Becoming A Migration Target For EnterpriseHow To Measure Linux Performance WrongConverting MongoDB to Percona Server for MongoDBMoving MongoDB to the Cloud: Strategies and Points To ConsiderAll Webinars,,,,,
pg,7,"»ServicesSupportManaged ServicesConsultingTrainingProductsMySQL SoftwareMongoDB SoftwarePostgreSQL DistributionKubernetesMonitoring & ManagementResourcesSolution BriefsWhite PapersWebinarsCase StudiesDatasheetsMoreBlogCommunity BlogTechnical Forum HelpAboutCustomersNewsroomAboutCareers Contact UsSales & General Inquiries (888) 316-9775 (USA) (208) 473-2904 (USA) +44 203 608 6727 (UK) 0-808-169-6490 (UK) 0-800-724-4569 (GER)MySQL, InnoDB, MariaDB and MongoDB are trademarks of their respective owners",,,,,
pg,7,Proudly running Percona Server for MySQL,,,,,
pg,7,Terms of Use |,,,,,
pg,7,Privacy |,,,,,
pg,7,Copyright |,,,,,
pg,7,LegalCopyright © 2006-2020 Percona LLC,,,,,
pg,7,,,,,,
pg,8,A Performance Cheat Sheet for PostgreSQL | Severalnines,,,,,
pg,8,Login,,,,,
pg,8,Sign up,,,,,
pg,8,ProductClusterControl Free Community Edition,,,,,
pg,8,ClusterControl Enterprise Edition,,,,,
pg,8,Severalnines Labs,,,,,
pg,8,Download,,,,,
pg,8,Pricing Plans,,,,,
pg,8,ResourcesWebinars,,,,,
pg,8,Whitepapers,,,,,
pg,8,Tutorials,,,,,
pg,8,Trainings,,,,,
pg,8,ClusterControl Certification,,,,,
pg,8,SupportDocumentation,,,,,
pg,8,Community Help,,,,,
pg,8,ClusterControl on Slack,,,,,
pg,8,Knowledge Base,,,,,
pg,8,Blog,,,,,
pg,8,About usCompany,,,,,
pg,8,Careers,,,,,
pg,8,Customers,,,,,
pg,8,Partners,,,,,
pg,8,Contact us,,,,,
pg,8,Login / Sign Up,,,,,
pg,8,Subscribe for newsletter,,,,,
pg,8,Filters,,,,,
pg,8,Severalnines Database Blog,,,,,
pg,8,Back to Home Page,,,,,
pg,8,Clear all,,,,,
pg,8,Apply,,,,,
pg,8,Filters,,,,,
pg,8,Close Filters,,,,,
pg,8,Subscribe,,,,,
pg,8,Categories:,,,,,
pg,8,ClusterControl,,,,,
pg,8,Backup Management,,,,,
pg,8,Monitoring & Alerting,,,,,
pg,8,Deployment & Scaling,,,,,
pg,8,Upgrades & Patches,,,,,
pg,8,Security & Compliance,,,,,
pg,8,Operational Reporting,,,,,
pg,8,Configuration Management,,,,,
pg,8,Recovery & Repair,,,,,
pg,8,Performance Management,,,,,
pg,8,Cloud,,,,,
pg,8,Industry News & Events,,,,,
pg,8,Database - General,,,,,
pg,8,Technologies:,,,,,
pg,8,Docker,,,,,
pg,8,Galera Cluster,,,,,
pg,8,MariaDB,,,,,
pg,8,MongoDB,,,,,
pg,8,MySQL,,,,,
pg,8,MySQL NDB Cluster,,,,,
pg,8,PostgreSQL,,,,,
pg,8,TimescaleDB,,,,,
pg,8,Tags:,,,,,
pg,8,Home Page,,,,,
pg,8,A Performance Cheat Sheet for PostgreSQL,,,,,
pg,8,Sebastian Insausti,,,,,
pg,8,"June 18, 2018",,,,,
pg,8,Severalnines,,,,,
pg,8,"August 26, 2019",,,,,
pg,8,Posted in:,,,,,
pg,8,Performance Management,,,,,
pg,8,PostgreSQL,,,,,
pg,8,Performance is one of the most important and most complex tasks when managing a database,,,,,
pg,8,"It can be affected by the configuration, the hardware or even the design of the system",,,,,
pg,8,"By default, PostgreSQL is configured with compatibility and stability in mind, since the performance depends a lot on the hardware and on our system itself",,,,,
pg,8,We can have a system with a lot of data being read but the information does not change frequently,,,,,
pg,8,Or we can have a system that writes continuously,,,,,
pg,8,"For this reason, it is impossible to define a default configuration that works for all types of workloads",,,,,
pg,8,,,,,,
pg,8,"In this blog, we will see how one goes about analyzing the workload, or queries, that are running",,,,,
pg,8,We shall then review some basic configuration parameters to improve the performance of our PostgreSQL database,,,,,
pg,8,"As we mentioned, we will see only some of the parameters",,,,,
pg,8,"The list of PostgreSQL parameters is extensive, we would only touch on some of the key ones",,,,,
pg,8,"However, one can always consult the official documentation to delve into the parameters and configurations that seem most important or useful in our environment",,,,,
pg,8,,,,,,
pg,8,EXPLAIN,,,,,
pg,8,One of the first steps we can take to understand how to improve the performance of our database is to analyze the queries that are made,,,,,
pg,8,,,,,,
pg,8,PostgreSQL devises a query plan for each query it receives,,,,,
pg,8,"To see this plan, we will use EXPLAIN",,,,,
pg,8,,,,,,
pg,8,The structure of a query plan is a tree of plan nodes,,,,,
pg,8,The nodes in the lower level of the tree are scan nodes,,,,,
pg,8,They return raw rows from a table,,,,,
pg,8,There are different types of scan nodes for different methods of accessing the table,,,,,
pg,8,The EXPLAIN output has a line for each node in the plan tree,,,,,
pg,8,,,,,,
pg,8,"world=# EXPLAIN SELECT * FROM city t1,country t2 WHERE id>100 AND t1",,,,,
pg,8,opulation>700000 AND t2,,,,,
pg,8,opulation<7000000;,,,,,
pg,8,QUERY PLAN,,,,,
pg,8,--------------------------------------------------------------------------,,,,,
pg,8,Nested Loop,,,,,
pg,8,(cost=0.00,,,,,
pg,8,734.81 rows=50662 width=144),,,,,
pg,8,->,,,,,
pg,8,Seq Scan on city t1,,,,,
pg,8,(cost=0.00,,,,,
pg,8,93.19 rows=347 width=31),,,,,
pg,8,Filter: ((id > 100) AND (population > 700000)),,,,,
pg,8,->,,,,,
pg,8,Materialize,,,,,
pg,8,(cost=0.00,,,,,
pg,8,8.72 rows=146 width=113),,,,,
pg,8,->,,,,,
pg,8,Seq Scan on country t2,,,,,
pg,8,(cost=0.00,,,,,
pg,8,7.99 rows=146 width=113),,,,,
pg,8,Filter: (population < 7000000),,,,,
pg,8,(6 rows),,,,,
pg,8,This command shows how the tables in our query will be scanned,,,,,
pg,8,Let's see what these values correspond to that we can observe in our EXPLAIN,,,,,
pg,8,,,,,,
pg,8,The first parameter shows the operation that the engine is performing on the data in this step,,,,,
pg,8,,,,,,
pg,8,Estimated start-up cost,,,,,
pg,8,This is the time spent before the output phase can begin,,,,,
pg,8,,,,,,
pg,8,Estimated total cost,,,,,
pg,8,This is stated on the assumption that the plan node is run to completion,,,,,
pg,8,"In practice, a node's parent node might stop short of reading all available rows",,,,,
pg,8,,,,,,
pg,8,Estimated number of rows output by this plan node,,,,,
pg,8,"Again, the node is assumed to be run to completion",,,,,
pg,8,,,,,,
pg,8,Estimated average width of rows output by this plan node,,,,,
pg,8,,,,,,
pg,8,"The most critical part of the display is the estimated statement execution cost, which is the planner's guess at how long it will take to run the statement",,,,,
pg,8,"When comparing how effective one query is against the other, we will in practice be comparing the cost values of them",,,,,
pg,8,,,,,,
pg,8,It's important to understand that the cost of an upper-level node includes the cost of all its child nodes,,,,,
pg,8,It's also important to realize that the cost only reflects things that the planner cares about,,,,,
pg,8,"In particular, the cost does not consider the time spent transmitting result rows to the client, which could be an important factor in the real elapsed time; but the planner ignores it because it cannot change it by altering the plan",,,,,
pg,8,,,,,,
pg,8,The costs are measured in arbitrary units determined by the planner's cost parameters,,,,,
pg,8,"Traditional practice is to measure the costs in units of disk page fetches; that is, seq_page_cost is conventionally set to 1.0 and the other cost parameters are set relative to that",,,,,
pg,8,,,,,,
pg,8,EXPLAIN ANALYZE,,,,,
pg,8,"With this option, EXPLAIN executes the query, and then displays the true row counts and true run time accumulated within each plan node, along with the same estimates that a plain EXPLAIN shows",,,,,
pg,8,,,,,,
pg,8,Let's see an example of the use of this tool,,,,,
pg,8,,,,,,
pg,8,"world=# EXPLAIN ANALYZE SELECT * FROM city t1,country t2 WHERE id>100 AND t1",,,,,
pg,8,opulation>700000 AND t2,,,,,
pg,8,opulation<7000000;,,,,,
pg,8,QUERY PLAN,,,,,
pg,8,----------------------------------------------------------------------------------------------------------------------,,,,,
pg,8,Nested Loop,,,,,
pg,8,(cost=0.00,,,,,
pg,8,734.81 rows=50662 width=144) (actual time=0.081,,,,,
pg,8,22.066 rows=51100 loops=1),,,,,
pg,8,->,,,,,
pg,8,Seq Scan on city t1,,,,,
pg,8,(cost=0.00,,,,,
pg,8,93.19 rows=347 width=31) (actual time=0.069,,,,,
pg,8,0.618 rows=350 loops=1),,,,,
pg,8,Filter: ((id > 100) AND (population > 700000)),,,,,
pg,8,Rows Removed by Filter: 3729,,,,,
pg,8,->,,,,,
pg,8,Materialize,,,,,
pg,8,(cost=0.00,,,,,
pg,8,8.72 rows=146 width=113) (actual time=0.000,,,,,
pg,8,0.011 rows=146 loops=350),,,,,
pg,8,->,,,,,
pg,8,Seq Scan on country t2,,,,,
pg,8,(cost=0.00,,,,,
pg,8,7.99 rows=146 width=113) (actual time=0.007,,,,,
pg,8,0.058 rows=146 loops=1),,,,,
pg,8,Filter: (population < 7000000),,,,,
pg,8,Rows Removed by Filter: 93,,,,,
pg,8,Planning time: 0.136 ms,,,,,
pg,8,Execution time: 24.627 ms,,,,,
pg,8,(10 rows),,,,,
pg,8,"If we do not find the reason why our queries take longer than they should, we can check this blog for more information",,,,,
pg,8,,,,,,
pg,8,VACUUM,,,,,
pg,8,"The VACUUM process is responsible for several maintenance tasks within the database, one of them recovering storage occupied by dead tuples",,,,,
pg,8,"In the normal operation of PostgreSQL, tuples that are deleted or obsoleted by an update are not physically removed from their table; they remain present until a VACUUM is performed",,,,,
pg,8,"Therefore, it is necessary to do the VACUUM periodically, especially in frequently updated tables",,,,,
pg,8,,,,,,
pg,8,"If the VACUUM is taking too much time or resources, it means that we must do it more frequently, so that each operation has less to clean",,,,,
pg,8,,,,,,
pg,8,"In any case you may need to disable the VACUUM, for example when loading data in large quantities",,,,,
pg,8,,,,,,
pg,8,The VACUUM simply recovers space and makes it available for reuse,,,,,
pg,8,"This form of the command can operate in parallel with the normal reading and writing of the table, since an exclusive lock is not obtained",,,,,
pg,8,"However, the additional space is not returned to the operating system (in most cases); it is only available for reuse within the same table",,,,,
pg,8,,,,,,
pg,8,"VACUUM FULL rewrites all the contents of the table in a new disk file without additional space, which allows the unused space to return to the operating system",,,,,
pg,8,This form is much slower and requires an exclusive lock on each table while processing,,,,,
pg,8,,,,,,
pg,8,VACUUM ANALYZE performs a VACUUM and then an ANALYZE for each selected table,,,,,
pg,8,This is a practical way of combining routine maintenance scripts,,,,,
pg,8,,,,,,
pg,8,ANALYZE collects statistics on the contents of the tables in the database and stores the results in pg_statistic,,,,,
pg,8,"Subsequently, the query planner uses these statistics to help determine the most efficient execution plans for queries",,,,,
pg,8,,,,,,
pg,8,Download the Whitepaper Today,,,,,
pg,8,PostgreSQL Management & Automation with ClusterControl,,,,,
pg,8,"Learn about what you need to know to deploy, monitor, manage and scale PostgreSQL",,,,,
pg,8,Download the Whitepaper,,,,,
pg,8,Configuration parameters,,,,,
pg,8,To modify these parameters we must edit the file $ PGDATA / postgresql,,,,,
pg,8,conf,,,,,
pg,8,We must bear in mind that some of them require a restart of our database,,,,,
pg,8,,,,,,
pg,8,max_connections,,,,,
pg,8,Determines the maximum number of simultaneous connections to our database,,,,,
pg,8,"There are memory resources that can be configured per client, therefore, the maximum number of clients can suggest the maximum amount of memory used",,,,,
pg,8,,,,,,
pg,8,superuser_reserved_connections,,,,,
pg,8,"In case of reaching the limit of max_connection, these connections are reserved for superuser",,,,,
pg,8,,,,,,
pg,8,shared_buffers,,,,,
pg,8,Sets the amount of memory that the database server uses for shared memory buffers,,,,,
pg,8,"If you have a dedicated database server with 1 GB or more of RAM, a reasonable initial value for shared_buffers is 25% of your system's memory",1,,shared_buffers,P = 0.25 * memory,Memory >= 1GB
pg,8,"Larger configurations for shared_buffers generally require a corresponding increase in max_wal_size, to extend the process of writing large amounts of new or modified data over a longer period of time",,,,,
pg,8,,,,,,
pg,8,temp_buffers,,,,,
pg,8,Sets the maximum number of temporary buffers used for each session,,,,,
pg,8,These are local session buffers used only to access temporary tables,,,,,
pg,8,A session will assign the temporary buffers as needed up to the limit given by temp_buffers,,,,,
pg,8,,,,,,
pg,8,work_mem,,,,,
pg,8,"Specifies the amount of memory that will be used by the internal operations of ORDER BY, DISTINCT, JOIN, and hash tables before writing to the temporary files on disk",,,,,
pg,8,When configuring this value we must take into account that several sessions be executing these operations at the same time and each operation will be allowed to use as much memory as specified by this value before it starts to write data in temporary files,,,,,
pg,8,,,,,,
pg,8,This option was called sort_mem in older versions of PostgreSQL,,,,,
pg,8,,,,,,
pg,8,maintenance_work_mem,,,,,
pg,8,"Specifies the maximum amount of memory that maintenance operations will use, such as VACUUM, CREATE INDEX, and ALTER TABLE ADD FOREIGN KEY",,,,,
pg,8,"Since only one of these operations can be executed at the same time by a session, and an installation usually does not have many of them running simultaneously, it can be larger than the work_mem",1,1742,maintenance_work_mem,P > work_mem,
pg,8,Larger configurations can improve performance for VACUUM and database restores,,,,,
pg,8,,,,,,
pg,8,"When the autovacuum is executed, this memory can be assigned the number of times in which the autovacuum_max_workers parameter is configured, so we must take this into account, or otherwise, configure the autovacuum_work_mem parameter to manage this separately",,,,,
pg,8,,,,,,
pg,8,fsync,,,,,
pg,8,"If fsync is enabled, PostgreSQL will try to make sure that the updates are physically written to the disk",,,,,
pg,8,This ensures that the database cluster can be recovered to a consistent state after an operating system or hardware crash,,,,,
pg,8,,,,,,
pg,8,"While disabling fsync generally improves performance, it can cause data loss in the event of a power failure or a system crash",1,,fsync,P = off,
pg,8,"Therefore, it is only advisable to deactivate fsync if you can easily recreate your entire database from external data",,,,,
pg,8,,,,,,
pg,8,checkpoint_segments (PostgreSQL < 9.5),,,,,
pg,8,Maximum number of record file segments between automatic WAL control points (each segment is normally 16 megabytes),,,,,
pg,8,Increasing this parameter can increase the amount of time needed to recover faults,,,,,
pg,8,"In a system with a lot of traffic, it can affect the performance if it is set to a very low value",,,,,
pg,8,It is recommended to increase the value of checkpoint_segments on systems with many data modifications,,,,,
pg,8,,,,,,
pg,8,"Also, a good practice is to save the WAL files on a disk other than PGDATA",,,,,
pg,8,This is useful both for balancing the writing and for security in case of hardware failure,,,,,
pg,8,,,,,,
pg,8,"As of PostgreSQL 9.5 the configuration variable ""checkpoint_segments"" was removed, and was replaced by ""max_wal_size"" and ""min_wal_size""",,,,,
pg,8,max_wal_size (PostgreSQL >= 9.5),,,,,
pg,8,Maximum size the WAL is allowed to grow between the control points,,,,,
pg,8,The size of WAL can exceed max_wal_size in special circumstances,,,,,
pg,8,Increasing this parameter can increase the amount of time needed to recover faults,,,,,
pg,8,,,,,,
pg,8,min_wal_size (PostgreSQL >= 9.5),,,,,
pg,8,"When the WAL file is kept below this value, it is recycled for future use at a checkpoint, instead of being deleted",,,,,
pg,8,"This can be used to ensure that enough WAL space is reserved to handle spikes in the use of WAL, for example when executing large batch jobs",,,,,
pg,8,,,,,,
pg,8,wal_sync_method,,,,,
pg,8,Method used to force WAL updates to the disk,,,,,
pg,8,"If fsync is disabled, this setting has no effect",,,,,
pg,8,,,,,,
pg,8,wal_buffers,,,,,
pg,8,The amount of shared memory used for WAL data that has not yet been written to disk,,,,,
pg,8,"The default setting is about 3% of shared_buffers, not less than 64KB or more than the size of a WAL segment (usually 16MB)",,,,,
pg,8,Setting this value to at least a few MB can improve write performance on a server with many concurrent transactions,,,,,
pg,8,,,,,,
pg,8,effective_cache_size,,,,,
pg,8,This value is used by the query planner to take into account plans that may or may not fit in memory,,,,,
pg,8,This is taken into account in the cost estimates of using an index; a high value makes it more likely that index scans are used and a low value makes it more likely that sequential scans will be used,,,,,
pg,8,A reasonable value would be 50% of the RAM,1,1784,effective_cache_size,P = 0.5 * memory,
pg,8,,,,,,
pg,8,default_statistics_target,,,,,
pg,8,PostgreSQL collects statistics from each of the tables in its database to decide how queries will be executed on them,,,,,
pg,8,"By default, it does not collect too much information, and if you are not getting good execution plans, you should increase this value and then run ANALYZE in the database again (or wait for the AUTOVACUUM)",,,,,
pg,8,,,,,,
pg,8,synchronous_commit,,,,,
pg,8,"Specifies whether the transaction commit will wait for the WAL records to be written to disk before the command returns a ""success"" indication to the client",,,,,
pg,8,"The possible values ​​are: ""on"", ""remote_apply"", ""remote_write"", ""local"" and ""off""",,,,,
pg,8,"The default setting is ""on""",,,,,
pg,8,"When it is disabled, there may be a delay between the time the client returns, and when the transaction is guaranteed to be secure against a server lock",,,,,
pg,8,"Unlike fsync, disabling this parameter does not create any risk of database inconsistency: a crash of the operating system or database may result in the loss of some recent transactions allegedly committed, but the state of the database will be exactly the same as if those transactions had been cancelled cleanly",,,,,
pg,8,"Therefore, deactivating synchronous_commit can be a useful alternative when performance is more important than the exact certainty about the durability of a transaction",1,,synchronous_commit,P = off,
pg,8,,,,,,
pg,8,Logging,,,,,
pg,8,There are several types of data to log that may be useful or not,,,,,
pg,8,Let's see some of them:,,,,,
pg,8,log_min_error_statement: Sets the minimum logging level,,,,,
pg,8,,,,,,
pg,8,log_min_duration_statement: Used to record slow queries in the system,,,,,
pg,8,,,,,,
pg,8,log_line_prefix: Adheres information at the beginning of each log line,,,,,
pg,8,,,,,,
pg,8,"log_statement: You can choose between NONE, DDL, MOD, ALL",,,,,
pg,8,"Using ""all"" can cause performance problems",1,1810,log_statement,P != all,
pg,8,,,,,,
pg,8,Design,,,,,
pg,8,"In many cases, the design of our database can affect performance",,,,,
pg,8,"We must be careful in our design, normalizing our schema and avoiding redundant data",,,,,
pg,8,In many cases it is convenient to have several small tables instead of one huge table,,,,,
pg,8,"But as we said before, everything depends on our system and there is not a single possible solution",,,,,
pg,8,,,,,,
pg,8,We must also use the indexes responsibly,,,,,
pg,8,"We should not create indexes for each field or combination of fields, since, although we do not have to travel the entire table, we are using disk space and adding overhead to write operations",,,,,
pg,8,,,,,,
pg,8,Another very useful tool is the management of connection pool,,,,,
pg,8,"If we have a system with a lot of load, we can use this to avoid saturating the connections in the database and to be able to reuse them",,,,,
pg,8,,,,,,
pg,8,Hardware,,,,,
pg,8,"As we mentioned at the beginning of this blog, hardware is one of the important factors that directly affect the performance of our database",,,,,
pg,8,Let's see some points to keep in mind,,,,,
pg,8,,,,,,
pg,8,"Memory: The more RAM we have, the more memory data we can handle, and that means better performance",,,,,
pg,8,"The speed of writing and reading on disk is much slower than in memory, therefore, the more information we can have in memory, the better performance we will have",,,,,
pg,8,,,,,,
pg,8,"CPU: Maybe it does not make much sense to say this, but the more CPU we have, the better",,,,,
pg,8,"In any case it is not the most important in terms of hardware, but if we can have a good CPU, our processing capacity will improve and that directly impacts our database",,,,,
pg,8,,,,,,
pg,8,"Hard disk: We have several types of discs that we can use, SCSI, SATA, SAS, IDE",,,,,
pg,8,We also have solid state disks,,,,,
pg,8,"We must compare quality / price, which we should use to compare its speed",,,,,
pg,8,"But the type of disk is not the only thing to consider, we must also see how to configure them",,,,,
pg,8,"If we want good performance, we can use RAID10, keeping the WALs on another disk outside the RAID",,,,,
pg,8,It is not recommended to use RAID5 since the performance of this type of RAID for databases is not good,,,,,
pg,8,,,,,,
pg,8,Conclusion,,,,,
pg,8,"After taking into account the points mentioned in this blog, we can perform a benchmark to verify the behavior of the database",,,,,
pg,8,,,,,,
pg,8,It is also important to have our database monitored to determine if we are facing a performance problem and to be able to solve it as soon as possible,,,,,
pg,8,"For this task there are several tools such as Nagios, ClusterControl or Zabbix, among others, that allow us not only to monitor, but with some of them, allows us to take proactive action before the problem occurs",,,,,
pg,8,"With ClusterControl, in addition to monitoring, administration and several other utilities, we can receive recommendations on what actions we can take when receiving performance alerts",,,,,
pg,8,This allows us to have an idea of how to solve potential problems,,,,,
pg,8,,,,,,
pg,8,This blog is not intended to be an exhaustive guide to how to improve database performance,,,,,
pg,8,"Hopefully, It gives a clearer picture of what things can become important and some of the basic parameters that can be configured",,,,,
pg,8,Do not hesitate to let us know if we’ve missed any important ones,,,,,
pg,8,,,,,,
pg,8,Previous blog,,,,,
pg,8,Next blog,,,,,
pg,8,Related resources:,,,,,
pg,8,Blog,,,,,
pg,8,Why is PostgreSQL Running Slow? Tips & Tricks to Get to the Source,,,,,
pg,8,Blog,,,,,
pg,8,An Overview of Database Indexing in PostgreSQL,,,,,
pg,8,Blog,,,,,
pg,8,How to Benchmark PostgreSQL Performance,,,,,
pg,8,Blog,,,,,
pg,8,A Guide to Using pgBouncer for PostgreSQL,,,,,
pg,8,Technology,,,,,
pg,8,ClusterControl for PostgreSQL,,,,,
pg,8,Next blog,,,,,
pg,8,read more by:,,,,,
pg,8,Sebastian Insausti,,,,,
pg,8,"Sebastian Insausti has loved technology since his childhood, when he did his first computer course using Windows 3.11",,,,,
pg,8,And from that moment he was decided on what his profession would be,,,,,
pg,8,"He has since built up experience with MySQL, PostgreSQL, HAProxy, WAF (ModSecurity), Linux (RedHat, CentOS, OL, Ubuntu server), Monitoring (Nagios), Networking and Virtualization (VMWare, Proxmox, Hyper-V, RHEV)",,,,,
pg,8,He’s also a speaker and has given a few talks locally on InnoDB Cluster and MySQL Enterprise together with an Oracle team,,,,,
pg,8,,,,,,
pg,8,More from This Author,,,,,
pg,8,What's New in PostgreSQL 12,,,,,
pg,8,"Oct 21, 2019",,,,,
pg,8,by Sebastian Insausti,,,,,
pg,8,PostgreSQL 12 is now available with notable improvements to query performance,,,,,
pg,8,In this blog we’ll take a look at these new features and show you how to get and install this new PostgreSQL 12 version,,,,,
pg,8,We’ll also explore some considerations to take into account when upgrading,,,,,
pg,8,,,,,,
pg,8,Severalnines,,,,,
pg,8,"October 21, 2019",,,,,
pg,8,Which Time-Series Database is Better: TimescaleDB vs InfluxDB,,,,,
pg,8,"May 16, 2019",,,,,
pg,8,by Sebastian Insausti,,,,,
pg,8,"In the new time-series database world, TimescaleDB and InfluxDB are two popular options with fundamentally different architectures",,,,,
pg,8,"One is based off a relational database, PostgreSQL, the other build as a NoSQL engine",,,,,
pg,8,"In this blog, we’ll give you a short description of those two, and how they stack against each other",,,,,
pg,8,,,,,,
pg,8,Severalnines,,,,,
pg,8,"September 04, 2019",,,,,
pg,8,How to Deploy PostgreSQL to a Docker Container Using ClusterControl,,,,,
pg,8,"May 09, 2019",,,,,
pg,8,by Sebastian Insausti,,,,,
pg,8,"Deploying a single PostgreSQL instance on Docker is fairly easy, but deploying a replication cluster requires a bit more work",,,,,
pg,8,"In this blog, we’ll see how to deploy PostgreSQL on Docker and how we can make it easier to configure a primary-standby replication setup with ClusterControl",,,,,
pg,8,,,,,,
pg,8,Severalnines,,,,,
pg,8,"August 01, 2019",,,,,
pg,8,View the discussion thread,,,,,
pg,8,,,,,,
pg,8,ClusterControl,,,,,
pg,8,The only management system you’ll ever need to take control of your open source database infrastructure,,,,,
pg,8,,,,,,
pg,8,Learn more,,,,,
pg,8,Products,,,,,
pg,8,Full-Ops Management,,,,,
pg,8,Configuration Management,,,,,
pg,8,Database Backups,,,,,
pg,8,ResourcesDatabase Blog,,,,,
pg,8,Whitepapers,,,,,
pg,8,Tutorials,,,,,
pg,8,Webinars,,,,,
pg,8,Trainings,,,,,
pg,8,Certification,,,,,
pg,8,SupportGet Support,,,,,
pg,8,ClusterControl Documentation,,,,,
pg,8,Backup Ninja Documentation,,,,,
pg,8,ClusterControl on Slack,,,,,
pg,8,BlogMySQL,,,,,
pg,8,PostgreSQL,,,,,
pg,8,MariaDB,,,,,
pg,8,Galera Cluster,,,,,
pg,8,MongoDB,,,,,
pg,8,TimescaleDB,,,,,
pg,8,MySQL NDB Cluster,,,,,
pg,8,Docker,,,,,
pg,8,About usCareers,,,,,
pg,8,Customers,,,,,
pg,8,Partners,,,,,
pg,8,Contact us,,,,,
pg,8,Sign up for Planets9s,,,,,
pg,8,Your e-mail *,,,,,
pg,8,© Copyright 2014-2020 Severalnines AB,,,,,
pg,8,All rights reserved,,,,,
pg,8,,,,,,
pg,8,Website Policies,,,,,
pg,8,Sitemap,,,,,
pg,9,PostgreSQL Performance Tuning and Optimization | EDB,,,,,
pg,9,Skip to main content,,,,,
pg,9,Barrio main menu,,,,,
pg,9,Why EDB?,,,,,
pg,9,EDB Supercharges PostgreSQL,,,,,
pg,9,wrapper,,,,,
pg,9,Use Cases,,,,,
pg,9,Oracle Migration,,,,,
pg,9,Hybrid Cloud,,,,,
pg,9,High Availability,,,,,
pg,9,Solutions for,,,,,
pg,9,IT Professionals,,,,,
pg,9,Database Architects,,,,,
pg,9,Developers,,,,,
pg,9,Database Admins,,,,,
pg,9,Products,,,,,
pg,9,Products Overview,,,,,
pg,9,wrapper,,,,,
pg,9,Databases,,,,,
pg,9,EDB Postgres Advanced Server,,,,,
pg,9,PostgreSQL,,,,,
pg,9,wrapper,,,,,
pg,9,Tools,,,,,
pg,9,Postgres Enterprise Manager,,,,,
pg,9,Backup and Recovery Tool,,,,,
pg,9,Failover Manager,,,,,
pg,9,Open Source Projects,,,,,
pg,9,Migration Portal,,,,,
pg,9,Migration Toolkit,,,,,
pg,9,Replication Server,,,,,
pg,9,Services,,,,,
pg,9,Services Overview,,,,,
pg,9,Training,,,,,
pg,9,Getting Started,,,,,
pg,9,PostgreSQL Optimization,,,,,
pg,9,Enterprise Strategy,,,,,
pg,9,Custom Services,,,,,
pg,9,Support,,,,,
pg,9,Customer Support Portal,,,,,
pg,9,Support Overview,,,,,
pg,9,PostgreSQL Technical Support,,,,,
pg,9,Remote DBA Service,,,,,
pg,9,Cloud DBA Service,,,,,
pg,9,Technical Account Management,,,,,
pg,9,Resources,,,,,
pg,9,Docs,,,,,
pg,9,wrapper,,,,,
pg,9,Blog,,,,,
pg,9,Webinars,,,,,
pg,9,PostgreSQL Tutorials,,,,,
pg,9,Training,,,,,
pg,9,Partners,,,,,
pg,9,White Papers,,,,,
pg,9,Customer Stories,,,,,
pg,9,Product Compatibility,,,,,
pg,9,Plans,,,,,
pg,9,Barrio utility menu,,,,,
pg,9,Contact,,,,,
pg,9,Dashboard,,,,,
pg,9,Sign In,,,,,
pg,9,Downloads,,,,,
pg,9,Barrio Mobile Menu,,,,,
pg,9,Why EDB?,,,,,
pg,9,EDB Supercharges PostgreSQL,,,,,
pg,9,Use Cases,,,,,
pg,9,Oracle Migration,,,,,
pg,9,Hybrid Cloud,,,,,
pg,9,High Availability,,,,,
pg,9,Solutions for,,,,,
pg,9,IT Professionals,,,,,
pg,9,Database Architects,,,,,
pg,9,Developers,,,,,
pg,9,Database Admins,,,,,
pg,9,Products,,,,,
pg,9,Products Overview,,,,,
pg,9,Databases,,,,,
pg,9,EDB Postgres Advanced Server,,,,,
pg,9,PostgreSQL,,,,,
pg,9,Tools,,,,,
pg,9,Postgres Enterprise Manager,,,,,
pg,9,Backup and Recovery Tool,,,,,
pg,9,Failover Manager,,,,,
pg,9,Open Source Projects,,,,,
pg,9,Migration Portal,,,,,
pg,9,Migration Toolkit,,,,,
pg,9,Replication Server,,,,,
pg,9,Services,,,,,
pg,9,Services Overview,,,,,
pg,9,Training,,,,,
pg,9,Getting Started,,,,,
pg,9,Postgres Optimization,,,,,
pg,9,Enterprise Strategy,,,,,
pg,9,Custom Services,,,,,
pg,9,Support,,,,,
pg,9,Support Overview,,,,,
pg,9,PostgreSQL Technical Support,,,,,
pg,9,Remote DBA Service,,,,,
pg,9,Cloud DBA Service,,,,,
pg,9,Technical Account Management,,,,,
pg,9,Resources,,,,,
pg,9,Docs,,,,,
pg,9,Blog,,,,,
pg,9,Webinars,,,,,
pg,9,Postgres Tutorials,,,,,
pg,9,Training,,,,,
pg,9,Partners,,,,,
pg,9,White Papers,,,,,
pg,9,Customer Stories,,,,,
pg,9,Product Compatibility,,,,,
pg,9,Plans,,,,,
pg,9,Downloads,,,,,
pg,9,Contact,,,,,
pg,9,Sign In,,,,,
pg,9,Dashboard,,,,,
pg,9,PostgreSQL Performance Tuning and Optimization,,,,,
pg,9,"Some of the most critical aspects of tuning PostgreSQL for performance are hardware updates, configuration, vacuuming, query performance, and indexing of queries",,,,,
pg,9,"This page consists of tips, issues, benchmarks, and tools to performance optimize PostgreSQL using different techniques",,,,,
pg,9,,,,,,
pg,9,How to Tune PostgreSQL GUC Parameters,,,,,
pg,9,"Tushar Ahuja · May 5, 2020",,,,,
pg,9,This article discusses GUC parameters that can be used for PostgreSQL tuning and how to configure them for improved performance,,,,,
pg,9,,,,,,
pg,9,What is Parallel Vacuum in PostgreSQL 13,,,,,
pg,9,"Dilip Kumar · April 17, 2020",,,,,
pg,9,"In PostgreSQL, we already support parallelism of a SQL query which leverages multiple cores to execute the query faster",,,,,
pg,9,"Vacuum is one of the most critical utility operations which helps in controlling bloat, one of the major problems for PostgreSQL DBAs",,,,,
pg,9,"So, vacuum needs to run really fast to reduce the bloat as early as possible",,,,,
pg,9,"In PG13, parallel vacuum is introduced which allows for parallel vacuuming of multiple indexes corresponding to a single table",,,,,
pg,9,,,,,,
pg,9,PostgreSQL query tuning checklist,,,,,
pg,9,"Tushar Ahuja · April 6, 2020",,,,,
pg,9,This article offers a checklist of tools available for improving PostgreSQL query performance,,,,,
pg,9,,,,,,
pg,9,How to tune PostgreSQL for memory,,,,,
pg,9,"Tushar Ahuja · April 6, 2020",,,,,
pg,9,This article looks at parameters that can be used to help manage memory in PostgreSQL,,,,,
pg,9,Recommended settings for each parameter are also provided,,,,,
pg,9,,,,,,
pg,9,Comprehensive guide on how to tune database parameters and configuration in PostgreSQL,,,,,
pg,9,"Swapnil Suryawanshi · December 17, 2019",,,,,
pg,9,This article discusses parameters that can be used to configure performance in PostgreSQL,,,,,
pg,9,"After introducing ways of measuring database speed, it reviews the parameters and ways to optimize performance with them",,,,,
pg,9,,,,,,
pg,9,DO or UNDO - There is no PostgreSQL VACUUM,,,,,
pg,9,"Robert Haas · January 30, 2018",,,,,
pg,9,What if PostgreSQL didn’t need VACUUM at all? This seems hard to imagine,,,,,
pg,9,"After all, PostgreSQL uses multi-version concurrency control (MVCC), and if",,,,,
pg,9,,,,,,
pg,9,,,,,,
pg,9,The State of VACUUM,,,,,
pg,9,"Robert Haas · January 9, 2018",,,,,
pg,9,"In a recent blog post, I talked about why every system that implements MVCC needs some scheme for removing old row versions, and how VACUUM meets that",,,,,
pg,9,,,,,,
pg,9,,,,,,
pg,9,History of improvements in VACUUM in PostgreSQL,,,,,
pg,9,Robert M,,,,,
pg,9,"Haas · January 5, 2018",,,,,
pg,9,"In a recent blog post, I talked about why every system that implements MVCC needs some scheme for removing old row versions, and how VACUUM meets that need for PostgreSQL",,,,,
pg,9,"In this post, I’d like to examine the history of VACUUM improvements in recent years, the state of VACUUM as it exists in PostgreSQL today, and how it might be improved in the future",,,,,
pg,9,,,,,,
pg,9,MVCC and VACUUM in PostgreSQL,,,,,
pg,9,"Robert Haas · December 19, 2017",,,,,
pg,9,"Experienced PostgreSQL users and developers rattle off the terms “MVCC” and “VACUUM” as if everyone should know what they are and how they work, but",,,,,
pg,9,,,,,,
pg,9,,,,,,
pg,9,Why we need VACUUM to implement MVCC In PostgreSQL,,,,,
pg,9,Robert M,,,,,
pg,9,"Haas · December 18, 2017",,,,,
pg,9,"Experienced PostgreSQL users and developers rattle off the terms “MVCC” and “VACUUM” as if everyone should know what they are and how they work, but in fact many people don’t",,,,,
pg,9,,,,,,
pg,9,Is PostgreSQL autovacuum too aggressive?,,,,,
pg,9,"Ameen Abbas · September 17, 2017",,,,,
pg,9,I covered vacuum basics in my earlier post,,,,,
pg,9,"In this post, I'm covering the importance of aggressive autovacuum",,,,,
pg,9,Database Administrators who just started their career might have doubts in their mind,,,,,
pg,9,How does VACUUM work in PostgreSQL,,,,,
pg,9,"Richard Yen · August 24, 2017",,,,,
pg,9,"I recently had a customer who was trying to figure out why his VACUUM-for-wraparound was taking so long–he had a 6TB database, and the VACUUM had been running for over 4 days",,,,,
pg,9,,,,,,
pg,9,Controlling Autovacuum in PostgreSQL,,,,,
pg,9,"Bruce Momjian · January 9, 2017",,,,,
pg,9,"Unlike other database systems, Postgres makes the cleanup process visible and tunable to users",,,,,
pg,9,Autovacuum performs recycling of old rows and updates optimizer statistics,,,,,
pg,9,,,,,,
pg,9,Get Postgres tips & tricks,,,,,
pg,9,Subscribe to our newsletter to get advanced Postgres how-tos,,,,,
pg,9,,,,,,
pg,9,Related Tutorials,,,,,
pg,9,Developer Resources,,,,,
pg,9,High Availability,,,,,
pg,9,Replication and Failover,,,,,
pg,9,Performance Tuning,,,,,
pg,9,Performance Monitoring and Alerting,,,,,
pg,9,"Containers, Kubernetes, Docker",,,,,
pg,9,Oracle To Postgres Migration,,,,,
pg,9,DBA and Admin Resources,,,,,
pg,9,Tools and Extensions,,,,,
pg,9,Featured Webinar,,,,,
pg,9,How to Monitor Postgres Like a Pro!,,,,,
pg,9,Monitoring is a critical element for overall performance of the database,,,,,
pg,9,Learn how to ensure your database is healthy and contributing to the long term stability of your database and application,,,,,
pg,9,,,,,,
pg,9,Watch Now,,,,,
pg,9,Introducing Postgres Pulse Live,,,,,
pg,9,Free To Attend: Every other Monday 11AM ET,,,,,
pg,9,A biweekly blog and live video forum series built to offer insight into how we analyze problems and develop solutions using Postgres,,,,,
pg,9,,,,,,
pg,9,About Postgres Pulse Live,,,,,
pg,9,Postgres Enterprise Manager,,,,,
pg,9,"Postgres Performance Tuning, Monitoring and Alerting Tool",,,,,
pg,9,"In this tech guide, we describe the six things a developer should know about in terms of how easy it is to install, work with, and deploy Postgres as well as the unique capabilities and wide range of features that Postgres offers",,,,,
pg,9,,,,,,
pg,9,Download Now,,,,,
pg,9,Ready to take the next step with PostgreSQL? Contact Us,,,,,
pg,9,Barrio main menu,,,,,
pg,9,Why EDB?,,,,,
pg,9,Use Cases,,,,,
pg,9,Oracle Migration,,,,,
pg,9,Hybrid Cloud,,,,,
pg,9,High Availability,,,,,
pg,9,Solutions for,,,,,
pg,9,IT Professionals,,,,,
pg,9,Database Architects,,,,,
pg,9,Developers,,,,,
pg,9,Database Admins,,,,,
pg,9,Products,,,,,
pg,9,Databases,,,,,
pg,9,EDB Postgres Advanced Server,,,,,
pg,9,PostgreSQL,,,,,
pg,9,Tools,,,,,
pg,9,Postgres Enterprise Manager,,,,,
pg,9,Backup and Recovery Tool,,,,,
pg,9,Failover Manager,,,,,
pg,9,Open Source Projects,,,,,
pg,9,Migration Portal,,,,,
pg,9,Migration Toolkit,,,,,
pg,9,Replication Server,,,,,
pg,9,Services,,,,,
pg,9,Services Overview,,,,,
pg,9,Training,,,,,
pg,9,Getting Started,,,,,
pg,9,PostgreSQL Optimization,,,,,
pg,9,Enterprise Strategy,,,,,
pg,9,Custom Services,,,,,
pg,9,Support,,,,,
pg,9,Customer Support Portal,,,,,
pg,9,Support Overview,,,,,
pg,9,PostgreSQL Technical Support,,,,,
pg,9,Remote DBA Service,,,,,
pg,9,Cloud DBA Service,,,,,
pg,9,Technical Account Management,,,,,
pg,9,Resources,,,,,
pg,9,Docs,,,,,
pg,9,Blog,,,,,
pg,9,Webinars,,,,,
pg,9,PostgreSQL Tutorials,,,,,
pg,9,Training,,,,,
pg,9,Partners,,,,,
pg,9,White Papers,,,,,
pg,9,Customer Stories,,,,,
pg,9,Product Compatibility,,,,,
pg,9,Plans,,,,,
pg,9,Company,,,,,
pg,9,About EDB,,,,,
pg,9,PostgreSQL Contributions,,,,,
pg,9,Careers,,,,,
pg,9,Events,,,,,
pg,9,Press Releases,,,,,
pg,9,Media Coverage,,,,,
pg,9,Customers,,,,,
pg,9,Follow Us,,,,,
pg,9,Twitter,,,,,
pg,9,LinkedIn,,,,,
pg,9,Facebook,,,,,
pg,9,YouTube,,,,,
pg,9,Barrio Footer Secondary Menu,,,,,
pg,9,© 2020 EDB,,,,,
pg,9,GDPR,,,,,
pg,9,Privacy Policy,,,,,
pg,9,Terms of Use,,,,,
pg,9,Trademarks,,,,,
pg,9,Select LanguageEnglish (EN)DutchFrenchGermanJapaneseKoreanPortugueseSpanishThis automated translation should not be considered exact and only used to approximate the original English language content,,,,,
pg,9,"EDB does not guarantee the accuracy, reliability, or timeliness of any information translated",,,,,
pg,9,,,,,,
pg,10,Performance Tuning PostgreSQL,,,,,
pg,10,About,,,,,
pg,10,Impact,,,,,
pg,10,Products,,,,,
pg,10,Blog,,,,,
pg,10,Contact,,,,,
pg,10,Performance Tuning PostgreSQL,,,,,
pg,10,by,,,,,
pg,10,Frank Wiles,,,,,
pg,10,Introduction,,,,,
pg,10,PostgreSQL is the most advanced,,,,,
pg,10,and flexible Open Source SQL database today,,,,,
pg,10,,,,,,
pg,10,With this power and,,,,,
pg,10,flexibility comes a problem,,,,,
pg,10,,,,,,
pg,10,How do the PostgreSQL developers tune the,,,,,
pg,10,default configuration for everyone? Unfortunately the answer is they can't,,,,,
pg,10,,,,,,
pg,10,"The problem is that every database is not only different in its design, but",,,,,
pg,10,also its requirements,,,,,
pg,10,Some systems are used to log mountains of data that,,,,,
pg,10,is almost never queried,,,,,
pg,10,Others have essentially static data that is queried,,,,,
pg,10,"constantly, sometimes feverishly",,,,,
pg,10,,,,,,
pg,10,"Most systems however have some, usually",,,,,
pg,10,"unequal, level of reads and writes to the database",,,,,
pg,10,Add this little,,,,,
pg,10,"complexity on top of your totally unique table structure, data, and hardware",,,,,
pg,10,configuration and hopefully you begin to see why tuning can be difficult,,,,,
pg,10,,,,,,
pg,10,The default configuration PostgreSQL ships with is a very solid configuration,,,,,
pg,10,"aimed at everyone's best guess as to how an ""average"" database on ""average""",,,,,
pg,10,hardware should be setup,,,,,
pg,10,This article aims to help PostgreSQL users of all,,,,,
pg,10,levels better understand PostgreSQL performance tuning,,,,,
pg,10,,,,,,
pg,10,Understanding the process,,,,,
pg,10,The first step to learning how to tune your PostgreSQL database is to,,,,,
pg,10,understand the life cycle of a query,,,,,
pg,10,Here are the steps of a query:,,,,,
pg,10,Transmission of query string to database backend,,,,,
pg,10,Parsing of query string,,,,,
pg,10,Planning of query to optimize retrieval of data,,,,,
pg,10,Retrieval of data from hardware,,,,,
pg,10,Transmission of results to client,,,,,
pg,10,The first step is the sending of the query string ( the actual SQL,,,,,
pg,10,command you type in or your application uses ) to the database backend,,,,,
pg,10,,,,,,
pg,10,"There isn't much you can tune about this step, however if you have a",,,,,
pg,10,very large queries that cannot be prepared in advance it may help to,,,,,
pg,10,put them into the database as a stored procedure and cut the data,,,,,
pg,10,transfer down to a minimum,,,,,
pg,10,,,,,,
pg,10,Once the SQL query is inside the database server it is parsed into,,,,,
pg,10,tokens,,,,,
pg,10,,,,,,
pg,10,This step can also be minimized by using stored procedures,,,,,
pg,10,,,,,,
pg,10,The planning of the query is where PostgreSQL really starts to do some,,,,,
pg,10,work,,,,,
pg,10,,,,,,
pg,10,This stage checks to see if the query is already prepared if your,,,,,
pg,10,version of PostgreSQL and client library support this feature,,,,,
pg,10,,,,,,
pg,10,It also,,,,,
pg,10,analyzes your SQL to determine what the most efficient way of retrieving,,,,,
pg,10,your data is,,,,,
pg,10,Should we use an index and if so which one? Maybe a hash,,,,,
pg,10,join on those two tables is appropriate?,,,,,
pg,10,These are some of the decisions,,,,,
pg,10,the database makes at this point of the process,,,,,
pg,10,,,,,,
pg,10,This step can be,,,,,
pg,10,eliminated if the query is previously prepared,,,,,
pg,10,,,,,,
pg,10,Now that PostgreSQL has a plan of what it believes to be the best way,,,,,
pg,10,"to retrieve the data, it is time to actually get it",,,,,
pg,10,,,,,,
pg,10,While there,,,,,
pg,10,"are some tuning options that help here, this step is mostly effected",,,,,
pg,10,by your hardware configuration,,,,,
pg,10,,,,,,
pg,10,And finally the last step is to transmit the results to the client,,,,,
pg,10,While,,,,,
pg,10,"there aren't any real tuning options for this step, you should be aware",,,,,
pg,10,that all of the data that you are returning is pulled from the disk and,,,,,
pg,10,sent over the wire to your client,,,,,
pg,10,,,,,,
pg,10,Minimizing the number of rows and columns,,,,,
pg,10,to only those that are necessary can often increase your performance,,,,,
pg,10,,,,,,
pg,10,General Tuning,,,,,
pg,10,There are several postmaster options that can be set that drastically,,,,,
pg,10,"affect performance, below is a list of the most commonly used and how",,,,,
pg,10,they effect performance:,,,,,
pg,10,max_connections = <num> — This option sets the,,,,,
pg,10,maximum number of database backend to have at any one time,,,,,
pg,10,,,,,,
pg,10,Use this,,,,,
pg,10,feature to ensure that you do not launch so many backends that you begin,,,,,
pg,10,swapping to disk and kill the performance of all the children,,,,,
pg,10,,,,,,
pg,10,Depending,,,,,
pg,10,on your application it may be better to deny the connection entirely,,,,,
pg,10,rather than degrade the performance of all of the other children,,,,,
pg,10,,,,,,
pg,10,shared_buffers = <num> — Editing this option is the simplest,,,,,
pg,10,way to improve the performance of your database server,,,,,
pg,10,,,,,,
pg,10,The default,,,,,
pg,10,is pretty low for most modern hardware,,,,,
pg,10,,,,,,
pg,10,General wisdom says that this should be,,,,,
pg,10,set to roughly 25% of available RAM on the system,1,2333,shared_buffers,P = 0.25 * memory,
pg,10,,,,,,
pg,10,Like most of the options,,,,,
pg,10,I will outline here you will simply need to try them at different levels (both up and down ) and see how well it works on your particular system,,,,,
pg,10,,,,,,
pg,10,Most people find that setting it larger than a third starts to degrade performance,1,2333,shared_buffers,P <= 0.33 * memory,
pg,10,,,,,,
pg,10,effective_cache_size = <num> — This value tells,,,,,
pg,10,PostgreSQL's optimizer how much memory PostgreSQL has available for caching data and helps in determing whether or not it use an index or not,,,,,
pg,10,,,,,,
pg,10,The larger the value increases the likely hood of using an index,,,,,
pg,10,,,,,,
pg,10,This should,,,,,
pg,10,be set to the amount of memory allocated to shared_buffers plus the amount of,1,2347,effective_cache_size,P > shared_buffers,
pg,10,OS cache available,,,,,
pg,10,,,,,,
pg,10,Often this is more than 50% of the total system memory,1,2347,effective_cache_size,P > 0.5 * memory,
pg,10,,,,,,
pg,10,work_mem = <num> — This option is used to control the,,,,,
pg,10,amount of memory using in sort operations and hash tables,,,,,
pg,10,,,,,,
pg,10,While you may,,,,,
pg,10,need to increase the amount of memory if you do a ton of sorting in your,,,,,
pg,10,"application, care needs to be taken",,,,,
pg,10,,,,,,
pg,10,"This isn't a system wide parameter,",,,,,
pg,10,but a per operation one,,,,,
pg,10,,,,,,
pg,10,So if a complex query has several sort operations,,,,,
pg,10,in it it will use multiple work_mem units of memory,,,,,
pg,10,,,,,,
pg,10,Not to mention that,,,,,
pg,10,multiple backends could be doing this at once,,,,,
pg,10,,,,,,
pg,10,This query can often lead,,,,,
pg,10,your database server to swap if the value is too large,,,,,
pg,10,,,,,,
pg,10,This option was,,,,,
pg,10,previously called sort_mem in older versions of PostgreSQL,,,,,
pg,10,,,,,,
pg,10,max_fsm_pages = <num> — This option helps to control,,,,,
pg,10,the free space map,,,,,
pg,10,,,,,,
pg,10,When something is deleted from a table it isn't,,,,,
pg,10,"removed from the disk immediately, it is simply marked as ""free"" in the",,,,,
pg,10,free space map,,,,,
pg,10,,,,,,
pg,10,The space can then be reused for any new INSERTs that,,,,,
pg,10,you do on the table,,,,,
pg,10,,,,,,
pg,10,If your setup has a high rate of DELETEs and INSERTs,,,,,
pg,10,it may be necessary increase this value to avoid table bloat,,,,,
pg,10,,,,,,
pg,10,fsync = <boolean> —,,,,,
pg,10,This option determines if,,,,,
pg,10,all your WAL pages are fsync()'ed to disk before a transactions is,,,,,
pg,10,committed,,,,,
pg,10,,,,,,
pg,10,"Having this on is safer, but can reduce write performance",1,2393,fsync,P = off,
pg,10,If,,,,,
pg,10,fsync is not enabled there is the chance of unrecoverable data corruption,,,,,
pg,10,,,,,,
pg,10,Turn this off at your own risk,,,,,
pg,10,,,,,,
pg,10,commit_delay = <num> and commit_siblings = <num>,,,,,
pg,10,— These options are used in concert to help improve performance by writing,,,,,
pg,10,out multiple transactions that are committing at once,,,,,
pg,10,,,,,,
pg,10,If there are commit_siblings number of backends active at the instant your transaction is committing then,,,,,
pg,10,the server waiting commit_delay microseconds to try and commit multiple transactions at once,,,,,
pg,10,,,,,,
pg,10,random_page_cost = <num> — random_page_cost controls the,,,,,
pg,10,way PostgreSQL views non-sequential disk reads,,,,,
pg,10,,,,,,
pg,10,A higher value makes it more,,,,,
pg,10,likely that a sequential scan will be used over an index scan indicating that,,,,,
pg,10,your server has very fast disks,,,,,
pg,10,,,,,,
pg,10,"If this is still confusing to you, Revolution Systems does offer a",,,,,
pg,10,PostgreSQL Tuning Service,,,,,
pg,10,Note that many of these options consume shared memory and it will probably,,,,,
pg,10,be necessary to increase the amount of shared memory allowed on your system,,,,,
pg,10,to get the most out of these options,,,,,
pg,10,,,,,,
pg,10,Hardware Issues,,,,,
pg,10,Obviously the type and quality of the hardware you use for your database,,,,,
pg,10,server drastically impacts the performance of your database,,,,,
pg,10,,,,,,
pg,10,Here are,,,,,
pg,10,a few tips to use when purchasing hardware for your database server (in order of importance):,,,,,
pg,10,RAM —,,,,,
pg,10,The more RAM you have the more disk,,,,,
pg,10,cache you will have,,,,,
pg,10,,,,,,
pg,10,This greatly impacts performance considering,,,,,
pg,10,memory I/O is thousands of times faster than disk I/O,,,,,
pg,10,,,,,,
pg,10,Disk types — Obviously fast Ultra-320 SCSI,,,,,
pg,10,"disks are your best option, however high end SATA drives are also",,,,,
pg,10,very good,,,,,
pg,10,,,,,,
pg,10,With SATA each disk is substantially cheaper and with that,,,,,
pg,10,you can afford more spindles than with SCSI on the same budget,,,,,
pg,10,,,,,,
pg,10,Disk configuration — The optimum configuration,,,,,
pg,10,is RAID 1+0 with as many disks as possible and with your transaction log,,,,,
pg,10,(pg_xlog) on a separate disk ( or stripe ) all by itself,,,,,
pg,10,RAID 5 is not,,,,,
pg,10,a very good option for databases unless you have more than 6 disks in,,,,,
pg,10,your volume,,,,,
pg,10,,,,,,
pg,10,With newer versions of PostgreSQL you can also use the,,,,,
pg,10,"tablespaces option to put different tables, databases, and indexes on",,,,,
pg,10,different disks to help optimize performance,,,,,
pg,10,,,,,,
pg,10,Such as putting your often,,,,,
pg,10,used tables on a fast SCSI disk and the less used ones slower,,,,,
pg,10,IDE or SATA drives,,,,,
pg,10,,,,,,
pg,10,"CPUs — The more CPUs the better, however",,,,,
pg,10,if your database does not use many complex functions your money is,,,,,
pg,10,best spent on more RAM or a better disk subsystem,,,,,
pg,10,,,,,,
pg,10,In general the more RAM and disk spindles you have in your system the,,,,,
pg,10,better it will perform,,,,,
pg,10,This is because with the extra RAM you will,,,,,
pg,10,access your disks less,,,,,
pg,10,,,,,,
pg,10,And the extra spindles help spread the reads and,,,,,
pg,10,writes over multiple disks to increase throughput and to reduce,,,,,
pg,10,drive head congestion,,,,,
pg,10,,,,,,
pg,10,Another good idea is to separate your application code and your database,,,,,
pg,10,server onto different hardware,,,,,
pg,10,,,,,,
pg,10,Not only does this provide more hardware,,,,,
pg,10,"dedicated to the database server, but the operating system's disk",,,,,
pg,10,cache will contain more PostgreSQL data and not other various application,,,,,
pg,10,or system data this way,,,,,
pg,10,,,,,,
pg,10,"For example, if you have one web server and one database server you can",,,,,
pg,10,use a cross-over cable on a separate ethernet interface to handle just,,,,,
pg,10,the web server to database network traffic to ensure you reduce,,,,,
pg,10,any possible bottlenecks there,,,,,
pg,10,,,,,,
pg,10,You can also obviously create an entirely,,,,,
pg,10,different physical network for database traffic if you have multiple servers,,,,,
pg,10,that access the same database server,,,,,
pg,10,,,,,,
pg,10,Useful Tuning Tools,,,,,
pg,10,The most useful tool in tuning your database is the SQL command EXPLAIN ANALYZE,,,,,
pg,10,,,,,,
pg,10,This allows you to profile each SQL query your application performs and see,,,,,
pg,10,exactly how the PostgreSQL planner will process the query,,,,,
pg,10,,,,,,
pg,10,Let's look at,,,,,
pg,10,"a short example, below is a simple table structure and query",,,,,
pg,10,,,,,,
pg,10,CREATE TABLE authors (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,name,,,,,
pg,10,varchar,,,,,
pg,10,);,,,,,
pg,10,CREATE TABLE books (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,author_id,,,,,
pg,10,"int4,",,,,,
pg,10,title,,,,,
pg,10,varchar,,,,,
pg,10,);,,,,,
pg,10,If we use the query:,,,,,
pg,10,EXPLAIN ANALYZE SELECT authors,,,,,
pg,10,"name, books",,,,,
pg,10,title,,,,,
pg,10,"FROM books, authors",,,,,
pg,10,WHERE books,,,,,
pg,10,author_id=16 and authors,,,,,
pg,10,id = books,,,,,
pg,10,author_id,,,,,
pg,10,ORDER BY books,,,,,
pg,10,title;,,,,,
pg,10,You will get output similar to the following:,,,,,
pg,10,QUERY PLAN,,,,,
pg,10,--------------------------------------------------------------------------------------------------------------,,,,,
pg,10,Sort,,,,,
pg,10,(cost=29.71,,,,,
pg,10,29.73 rows=6 width=64) (actual time=0.189,,,,,
pg,10,16.233 rows=7 loops=1),,,,,
pg,10,Sort Key: books,,,,,
pg,10,title,,,,,
pg,10,->,,,,,
pg,10,Nested Loop,,,,,
pg,10,(cost=0.00,,,,,
pg,10,29.63 rows=6 width=64) (actual time=0.068,,,,,
pg,10,0.129 rows=7 loops=1),,,,,
pg,10,->,,,,,
pg,10,Index Scan using authors_pkey on authors,,,,,
pg,10,(cost=0.00,,,,,
pg,10,5.82 rows=1 width=36) (actual time=0.029,,,,,
pg,10,0.033 rows=1 loops=1),,,,,
pg,10,Index Cond: (id = 16),,,,,
pg,10,->,,,,,
pg,10,Seq Scan on books,,,,,
pg,10,(cost=0.00,,,,,
pg,10,23.75 rows=6 width=36) (actual time=0.026,,,,,
pg,10,0.052 rows=7 loops=1),,,,,
pg,10,Filter: (author_id = 16),,,,,
pg,10,Total runtime: 16.386 ms,,,,,
pg,10,You need to read this output from bottom to top when analyzing it,,,,,
pg,10,,,,,,
pg,10,The,,,,,
pg,10,first thing PostgreSQL does is do a sequence scan on the books table looking,,,,,
pg,10,at each author_id column for values that equal 16,,,,,
pg,10,,,,,,
pg,10,Then it does an index,,,,,
pg,10,"scan of the authors table, because of the implicit index created by the PRIMARY",,,,,
pg,10,KEY options,,,,,
pg,10,,,,,,
pg,10,Then finally the results are sorted by books,,,,,
pg,10,title,,,,,
pg,10,,,,,,
pg,10,The values you see in parenthesis are the estimated and actual cost of,,,,,
pg,10,that portion of the query,,,,,
pg,10,,,,,,
pg,10,The closer together the estimate and the actual,,,,,
pg,10,costs are the better performance you will typically see,,,,,
pg,10,,,,,,
pg,10,Need some expert help tuning your database? Learn more about our,,,,,
pg,10,PostgreSQL Tuning Service,,,,,
pg,10,"Now, let's change the structure a little bit by adding an index on",,,,,
pg,10,books,,,,,
pg,10,author_id to avoid the sequence scan with this command:,,,,,
pg,10,CREATE INDEX books_idx1 on books(author_id);,,,,,
pg,10,"If you rerun the query again, you won't see any noticeable change in the",,,,,
pg,10,output,,,,,
pg,10,,,,,,
pg,10,This is because PostgreSQL has not yet re-analyzed the data,,,,,
pg,10,and determined that the new index may help for this query,,,,,
pg,10,,,,,,
pg,10,This can,,,,,
pg,10,be solved by running:,,,,,
pg,10,ANALYZE books;,,,,,
pg,10,"However, in this small test case I'm working with the planner still favors",,,,,
pg,10,the sequence scan because there aren't very many rows in my books table,,,,,
pg,10,,,,,,
pg,10,If a query is going to return a large portion of a table then the planner,,,,,
pg,10,chooses a sequence scan over an index because it is actually faster,,,,,
pg,10,You,,,,,
pg,10,can also force PostgreSQL to favor index scans over sequential scans,,,,,
pg,10,by setting the configuration parameter enable_seqscan to off,1,,enable_seqscan,P = off,
pg,10,,,,,,
pg,10,"This doesn't remove all sequence scans, since some tables may not have",,,,,
pg,10,"an index, but it does force the planner's hand into always using an",,,,,
pg,10,index scan when it is available,,,,,
pg,10,,,,,,
pg,10,This is probably best done by sending,,,,,
pg,10,the command SET enable_seqscan = off at the start of every,,,,,
pg,10,connection rather than setting this option database wide,,,,,
pg,10,,,,,,
pg,10,This way you,,,,,
pg,10,can control via your application code when this is in effect,,,,,
pg,10,"However,",,,,,
pg,10,in general disabling sequence scans should only be used in tuning,,,,,
pg,10,your application and is not really intended for every day use,,,,,
pg,10,,,,,,
pg,10,Typically the best way to optimize your queries is to use indexes on,,,,,
pg,10,specific columns and combinations of columns to correspond to often used,,,,,
pg,10,queries,,,,,
pg,10,,,,,,
pg,10,Unfortunately this is done by trial and error,,,,,
pg,10,,,,,,
pg,10,You should also,,,,,
pg,10,note that increasing the number of indexes on a table increases the number,,,,,
pg,10,of write operations that need to be performed for each INSERT and UPDATE,,,,,
pg,10,,,,,,
pg,10,So don't do anything silly and just add indexes for each column in each,,,,,
pg,10,table,,,,,
pg,10,,,,,,
pg,10,You can help PostgreSQL do what you want by playing with the level of,,,,,
pg,10,statistics that are gathered on a table or column with the command:,,,,,
pg,10,ALTER TABLE <table> ALTER COLUMN <column> SET STATISTICS <number>;,,,,,
pg,10,This value can be a number between 0 and 1000 and helps PostgreSQL determine,,,,,
pg,10,what level of statistics gathering should be performed on that column,,,,,
pg,10,,,,,,
pg,10,This,,,,,
pg,10,helps you to control the generated query plans without having slow vacuum,,,,,
pg,10,and analyze operations because of generating large amounts of stats for,,,,,
pg,10,all tables and columns,,,,,
pg,10,,,,,,
pg,10,Another useful tool to help determine how to tune your database is to turn,,,,,
pg,10,on query logging,,,,,
pg,10,,,,,,
pg,10,You can tell PostgreSQL which queries you are interested,,,,,
pg,10,in logging via the log_statement configuration option,,,,,
pg,10,This is,,,,,
pg,10,very useful in situations where you many users executing ad hoc queries,,,,,
pg,10,to your system via something like Crystal Reports or via psql directly,,,,,
pg,10,,,,,,
pg,10,Database Design and Layout,,,,,
pg,10,Sometimes the design and layout of your database affects performance,,,,,
pg,10,,,,,,
pg,10,"For example, if you have an employee database that looks like this:",,,,,
pg,10,CREATE TABLE employees (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,active,,,,,
pg,10,"boolean,",,,,,
pg,10,first_name,,,,,
pg,10,"varchar,",,,,,
pg,10,middle_name,,,,,
pg,10,"varchar,",,,,,
pg,10,last_name,,,,,
pg,10,"varchar,",,,,,
pg,10,ssn,,,,,
pg,10,"varchar,",,,,,
pg,10,address1,,,,,
pg,10,"varchar,",,,,,
pg,10,address2,,,,,
pg,10,"varchar,",,,,,
pg,10,city,,,,,
pg,10,"varchar,",,,,,
pg,10,state,,,,,
pg,10,"varchar(2),",,,,,
pg,10,zip,,,,,
pg,10,"varchar,",,,,,
pg,10,home_phone,,,,,
pg,10,"varchar,",,,,,
pg,10,work_phone,,,,,
pg,10,"varchar,",,,,,
pg,10,cell_phone,,,,,
pg,10,"varchar,",,,,,
pg,10,fax_phone,,,,,
pg,10,"varchar,",,,,,
pg,10,pager_number,,,,,
pg,10,"varchar,",,,,,
pg,10,business_email,,,,,
pg,10,"varchar,",,,,,
pg,10,personal_email,,,,,
pg,10,"varchar,",,,,,
pg,10,salary,,,,,
pg,10,"int4,",,,,,
pg,10,vacation_days,,,,,
pg,10,"int2,",,,,,
pg,10,sick_days,,,,,
pg,10,"int2,",,,,,
pg,10,employee_number,,,,,
pg,10,"int4,",,,,,
pg,10,office_addr_1,,,,,
pg,10,"varchar,",,,,,
pg,10,office_addr_2,,,,,
pg,10,"varchar,",,,,,
pg,10,office_city,,,,,
pg,10,"varchar,",,,,,
pg,10,office_state,,,,,
pg,10,"varchar(2),",,,,,
pg,10,office_zip,,,,,
pg,10,"varchar,",,,,,
pg,10,department,,,,,
pg,10,"varchar,",,,,,
pg,10,title,,,,,
pg,10,"varchar,",,,,,
pg,10,supervisor_id,,,,,
pg,10,int4,,,,,
pg,10,);,,,,,
pg,10,"This design is easy to understand, but isn't very good on several levels",,,,,
pg,10,,,,,,
pg,10,"While it will depend on your particular application, in most cases you",,,,,
pg,10,won't need to access all of this data at one time,,,,,
pg,10,,,,,,
pg,10,In portions of your,,,,,
pg,10,application that deal with HR functions you are probably only interested,,,,,
pg,10,"in their name, salary, vacation time, and sick days",,,,,
pg,10,"However, if the application",,,,,
pg,10,displays an organization chart it would only be concerned with the department,,,,,
pg,10,and supervisor_id portions of the table,,,,,
pg,10,,,,,,
pg,10,By breaking up this table into smaller tables you can get more efficient,,,,,
pg,10,"queries since PostgreSQL has less to read through, not to mention better",,,,,
pg,10,functionality,,,,,
pg,10,Below is one way to make this structure better:,,,,,
pg,10,CREATE TABLE employees (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,active,,,,,
pg,10,"boolean,",,,,,
pg,10,employee_number,,,,,
pg,10,"int4,",,,,,
pg,10,first_name,,,,,
pg,10,"varchar,",,,,,
pg,10,middle_name,,,,,
pg,10,"varchar,",,,,,
pg,10,last_name,,,,,
pg,10,"varchar,",,,,,
pg,10,department,,,,,
pg,10,"varchar,",,,,,
pg,10,title,,,,,
pg,10,"varchar,",,,,,
pg,10,email,,,,,
pg,10,varchar,,,,,
pg,10,);,,,,,
pg,10,CREATE TABLE employee_address (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,employee_id,,,,,
pg,10,"int4,",,,,,
pg,10,personal,,,,,
pg,10,"boolean,",,,,,
pg,10,address_1,,,,,
pg,10,"varchar,",,,,,
pg,10,address_2,,,,,
pg,10,"varchar,",,,,,
pg,10,city,,,,,
pg,10,"varchar,",,,,,
pg,10,state,,,,,
pg,10,"varchar(2),",,,,,
pg,10,zip,,,,,
pg,10,varchar,,,,,
pg,10,);,,,,,
pg,10,CREATE TABLE employee_number_type (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,type,,,,,
pg,10,varchar,,,,,
pg,10,);,,,,,
pg,10,CREATE TABLE employee_number (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,employee_id,,,,,
pg,10,"int4,",,,,,
pg,10,type_id,,,,,
pg,10,"int4,",,,,,
pg,10,number,,,,,
pg,10,varchar,,,,,
pg,10,);,,,,,
pg,10,CREATE TABLE employee_hr_info (,,,,,
pg,10,id,,,,,
pg,10,"int4 PRIMARY KEY,",,,,,
pg,10,employee_id,,,,,
pg,10,"int4,",,,,,
pg,10,ssn,,,,,
pg,10,"varchar,",,,,,
pg,10,salary,,,,,
pg,10,"int4,",,,,,
pg,10,vacation_days,,,,,
pg,10,"int2,",,,,,
pg,10,sick_days,,,,,
pg,10,int2,,,,,
pg,10,);,,,,,
pg,10,With this table structure the data associated with an employee is broken,,,,,
pg,10,out into logical groupings,,,,,
pg,10,The main table contains the most frequently,,,,,
pg,10,used information and the other tables store all of the rest of the information,,,,,
pg,10,,,,,,
pg,10,The added benefit of this layout is that you can have any number of phone,,,,,
pg,10,numbers and addresses associated with a particular employee now,,,,,
pg,10,,,,,,
pg,10,Another useful tip is to use partial indexes on columns where you typically,,,,,
pg,10,query a certain value more often than another,,,,,
pg,10,,,,,,
pg,10,Take for example the employee,,,,,
pg,10,table above,,,,,
pg,10,,,,,,
pg,10,You're probably only displaying active employees,,,,,
pg,10,"throughout the majority of the application, but creating a partial index",,,,,
pg,10,on that column where the value is true can help speed up the query and may,,,,,
pg,10,help the planner to choose to use the index in cases where it otherwise,,,,,
pg,10,would not,,,,,
pg,10,You can create a partial index like this:,,,,,
pg,10,CREATE INDEX employee_idx2 ON employee(active) WHERE active='t';,,,,,
pg,10,Or you may have a situation where a row has a column named 'employee_id' that,,,,,
pg,10,"is null until the row is associated with an employee, maybe in some trouble",,,,,
pg,10,ticket like system,,,,,
pg,10,,,,,,
pg,10,In that type of application you would probably have a,,,,,
pg,10,'View Unassigned Tickets' portion of the application which would benefit,,,,,
pg,10,from a partial index such as this:,,,,,
pg,10,CREATE INDEX tickets_idx1 ON tickets(employee_id) WHERE employee_id IS NULL;,,,,,
pg,10,Application Development,,,,,
pg,10,There are many different ways to build applications which use a SQL,,,,,
pg,10,"database, but there are two very common themes that I will call",,,,,
pg,10,stateless and stateful,,,,,
pg,10,In the area of performance,,,,,
pg,10,there are different issues that impact each,,,,,
pg,10,,,,,,
pg,10,Stateless is typically the access type used by web based applications,,,,,
pg,10,,,,,,
pg,10,Your,,,,,
pg,10,"software connects to the database, issues a couple of queries, returns to",,,,,
pg,10,"results to the user, and disconnects",,,,,
pg,10,,,,,,
pg,10,The next action the users takes,,,,,
pg,10,"restarts this process with a new connect, new set of queries, etc",,,,,
pg,10,,,,,,
pg,10,Stateful applications are typically non-web based user interfaces where,,,,,
pg,10,an application initiates a database connection and holds it open for the,,,,,
pg,10,duration the application is in use,,,,,
pg,10,,,,,,
pg,10,Stateless Applications,,,,,
pg,10,In web based applications each time something is requested by the user,,,,,
pg,10,", the application initiates a new database connection",,,,,
pg,10,,,,,,
pg,10,While PostgreSQL has a very short connection creation time and in general,,,,,
pg,10,"it is not a very expensive operation, it is best to use some sort of",,,,,
pg,10,database connection pooling method to get maximum performance,,,,,
pg,10,,,,,,
pg,10,"There are several ways to accomplish database connection pooling, here",,,,,
pg,10,is a short list of common ones:,,,,,
pg,10,Pgpool is a small,,,,,
pg,10,server that you run on the same server as your clients that will pool,,,,,
pg,10,database connections to some local or remote server,,,,,
pg,10,,,,,,
pg,10,The application simply,,,,,
pg,10,points at the pgpool instance instead of the normal postmaster,,,,,
pg,10,,,,,,
pg,10,From the,,,,,
pg,10,application's perspective nothing has changed as the connection pooling is,,,,,
pg,10,hidden from it,,,,,
pg,10,,,,,,
pg,10,In a mod_perl environment you can,,,,,
pg,10,use Apache::DBI,,,,,
pg,10,to handle database connection pooling inside of Apache itself,,,,,
pg,10,,,,,,
pg,10,SQLRelay is another db,,,,,
pg,10,connection manager that is somewhat database agnostic,,,,,
pg,10,,,,,,
pg,10,It works with,,,,,
pg,10,with several databases other than PostgreSQL,,,,,
pg,10,,,,,,
pg,10,"You can always write a small bit of code to do this for you yourself,",,,,,
pg,10,but I would highly recommend using an already developed solution to reduce,,,,,
pg,10,the amount of debugging you have to do,,,,,
pg,10,,,,,,
pg,10,It should be noted that in a few bizarre instances I've actually seen,,,,,
pg,10,database connection pooling reduce the performance of web based applications,,,,,
pg,10,,,,,,
pg,10,At a certain point the cost of handling the pooling is more expensive than,,,,,
pg,10,simply creating a new connection,,,,,
pg,10,,,,,,
pg,10,I suggest testing it both ways to see which,,,,,
pg,10,is best for your environment,,,,,
pg,10,,,,,,
pg,10,Stateful Applications,,,,,
pg,10,When building stateful applications you should look into using database,,,,,
pg,10,cursors via the DECLARE command,,,,,
pg,10,,,,,,
pg,10,A cursor allows you to plan and execute,,,,,
pg,10,"a query, but only pull back the data as you need it, for example one row",,,,,
pg,10,at a time,,,,,
pg,10,,,,,,
pg,10,This can greatly increase the snappiness of the UI,,,,,
pg,10,,,,,,
pg,10,General Application Issues,,,,,
pg,10,These issues typically effect both stateful and stateless applications,,,,,
pg,10,in the same fashion,,,,,
pg,10,,,,,,
pg,10,One good technique is to use server side prepared,,,,,
pg,10,queries for any queries you execute often,,,,,
pg,10,,,,,,
pg,10,This reduces the overall,,,,,
pg,10,query time by caching the query plan for later use,,,,,
pg,10,,,,,,
pg,10,It should be noted however if you prepare a query in advance using placeholder,,,,,
pg,10,values ( such as 'column_name = ?' ) then the planner will not always be able,,,,,
pg,10,to choose the best plan,,,,,
pg,10,,,,,,
pg,10,"For example, your query has a placeholder for the",,,,,
pg,10,boolean column 'active' and you have a partial index on false values the,,,,,
pg,10,planner won't use it because it cannot be sure the value passed in on,,,,,
pg,10,execution will be true or false,,,,,
pg,10,,,,,,
pg,10,"You can also obviously utilize stored procedures here to reduce the transmit,",,,,,
pg,10,"parse, and plan portions of the typical query life cycle",,,,,
pg,10,,,,,,
pg,10,It is best to,,,,,
pg,10,profile your application and find commonly used queries and data manipulations,,,,,
pg,10,and put them into a stored procedure,,,,,
pg,10,,,,,,
pg,10,Other Useful Resources,,,,,
pg,10,Here is a short list of other items that may be of help,,,,,
pg,10,,,,,,
pg,10,PostgreSQL Homepage —,,,,,
pg,10,The obvious place for all things PostgreSQL,,,,,
pg,10,,,,,,
pg,10,psql-performance mailing list — This PostgreSQL mailing list is focused on,,,,,
pg,10,performance related questions and discussions,,,,,
pg,10,,,,,,
pg,10,PostgreSQL Tuning Service,,,,,
pg,10,PostgreSQL Support Service,,,,,
pg,10,Recommended Books,,,,,
pg,10,PostgreSQL 9.0 High Performance,,,,,
pg,10,Beginning Databases with PostgreSQL: From Novice to Professional,,,,,
pg,10,PostgreSQL 9 Admin Cookbook,,,,,
pg,10,Practical PostgreSQL (O'Reilly Unix),,,,,
pg,10,PostgreSQL: Introduction and Concepts,,,,,
pg,10,Frank Wiles switched to using PostgreSQL as his primary database system over,,,,,
pg,10,15 years ago and has never looked back,,,,,
pg,10,He has used PostgreSQL in a variety of,,,,,
pg,10,"situations, most often however coupled with Python and Django to build high performance",,,,,
pg,10,browser based applications,,,,,
pg,10,He has published several articles and a book,,,,,
pg,10,on topics ranging from systems administration to application development,,,,,
pg,10,,,,,,
pg,10,He can be reached at frank@revsys,,,,,
pg,10,com,,,,,
pg,10,,,,,,
pg,10,Let’s work together,,,,,
pg,10,,,,,,
pg,10,sales@revsys,,,,,
pg,10,com,,,,,
pg,10,Contact us,,,,,
pg,10,Services,,,,,
pg,10,Django,,,,,
pg,10,PostgreSQL,,,,,
pg,10,Operations,,,,,
pg,10,Development,,,,,
pg,10,Open Source,,,,,
pg,10,Systems Admin,,,,,
pg,10,Products,,,,,
pg,10,Spectrum,,,,,
pg,10,Open Source,,,,,
pg,10,Blog,,,,,
pg,10,News,,,,,
pg,10,Blog,,,,,
pg,10,Quick Tips,,,,,
pg,10,Talks,,,,,
pg,10,Other,,,,,
pg,10,About,,,,,
pg,10,Case Studies,,,,,
pg,10,Team,,,,,
pg,10,Testimonials,,,,,
pg,10,Clients,,,,,
pg,10,Press,,,,,
pg,10,Contact,,,,,
pg,10,Get Connected,,,,,
pg,10,Signup for our newsletter for tips and tricks,,,,,
pg,10,,,,,,
pg,10,Have a comment or suggestion? comments@revsys,,,,,
pg,10,com,,,,,
pg,10,"©2002–2020 Revolution Systems, LLC",,,,,
pg,10,All rights reserved,,,,,
