<!DOCTYPE html>
<html lang="en">
  <head content="width=device-width, initial-scale=1">
    <meta charset="utf-8">

    <title>H2 Database: Features and Usage</title>
    
    <meta name="author" content="David Woodard">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/kura/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/kura/assets/themes/bootstrap/css/style.css" rel="stylesheet">
	<link href="/kura/assets/themes/bootstrap/css/github.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="/resources/respond/Respond.min.js"></script>
    <![endif]-->

    <!--Google Analytics
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-56028459-3', 'auto');
      ga('send', 'pageview');

    </script>
    -->
  </head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/kura">Eclipse Kura™ Documentation</a>
        </div>
      </div>
    </nav>
    <div class="container main-container">
      <div class="row main-container">
        <div id="navigation" class="col-md-3 collapse navbar-collapse navbar-ex1-collapse" style="font-size: 1em; font-weight: bold;">
          <ul class="list-unstyled">
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Introduction"></input>
                    <label class="nav-header" for="Introduction" style="display:block; cursor:pointer">Introduction</label>
                    <div>
                      
                      <li><a href="/kura/intro/intro.html">Overview</a></li>
                      
                
                  
                      <li><a href="/kura/intro/raspberry-pi-quick-start.html">Raspberry Pi Quick Start</a></li>
                      
                
                  
                      <li><a href="/kura/intro/docker-quick-start.html">Docker Quick Start</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Configuration"></input>
                    <label class="nav-header" for="Configuration" style="display:block; cursor:pointer">Configuration</label>
                    <div>
                      
                      <li><a href="/kura/config/console.html">Administration Console</a></li>
                      
                
                  
                      <li><a href="/kura/config/gateway-status.html">Gateway Status</a></li>
                      
                
                  
                      <li><a href="/kura/config/network-configuration.html">Network Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/ethernet-configuration.html">Ethernet Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/wi-fi-configuration.html">Wi-Fi Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/firewall-configuration.html">Firewall Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/cloud-services.html">Cloud Services</a></li>
                      
                
                  
                      <li><a href="/kura/config/cloud-service-configuration.html">Cloud Service Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/data-service-configuration.html">Data Service Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/connection-monitors.html">Connection Monitors in DataService</a></li>
                      
                
                  
                      <li><a href="/kura/config/message-publishing-backoff-delay.html">Message Publishing Backoff Delay</a></li>
                      
                
                  
                      <li><a href="/kura/config/mqttdata-transport-service-configuration.html">MqttData Transport Service Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/ssl-configuration.html">SSL Configuration</a></li>
                      
                
                  
                      <li><a href="/kura/config/auth.html">Gateway Administration Console Authentication</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Built-in Services"></input>
                    <label class="nav-header" for="Built-in Services" style="display:block; cursor:pointer">Built-in Services</label>
                    <div>
                      
                      <li><a href="/kura/builtin/intro.html">Introduction</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/simple-artemis-mqtt-broker-service.html">Simple Artemis MQTT Broker Service</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/activemq-artemis-broker-service.html">ActiveMQ Artemis Broker Service</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/clock-service.html">Clock Service</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/deployment-service.html">Deployment Service</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/cloudcat.html">Cloudcat</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/command-service.html">Command Service</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/h2-database.html">H2 Database: Features and Usage</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/h2-database-external-connections.html">H2 database: Connecting external applications</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/position-service.html">Position Service</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/rest-service.html">REST Service</a></li>
                      
                
                  
                      <li><a href="/kura/builtin/watchdog-service.html">Watchdog Service</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Administration"></input>
                    <label class="nav-header" for="Administration" style="display:block; cursor:pointer">Administration</label>
                    <div>
                      
                      <li><a href="/kura/admin/directory-layout.html">Directory Layout</a></li>
                      
                
                  
                      <li><a href="/kura/admin/snapshot-management.html">Snapshot Management</a></li>
                      
                
                  
                      <li><a href="/kura/admin/application-management.html">Application Management</a></li>
                      
                
                  
                      <li><a href="/kura/admin/remote-management.html">Remote Management with Everyware Cloud</a></li>
                      
                
                  
                      <li><a href="/kura/admin/remote-management-kapua.html">Remote Management with Eclipse Kapua</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Cloud Connection API and Usage"></input>
                    <label class="nav-header" for="Cloud Connection API and Usage" style="display:block; cursor:pointer">Cloud Connection API and Usage</label>
                    <div>
                      
                      <li><a href="/kura/cloud-api/1-overview.html">Overview</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-api/2-user-guide.html">User guide</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-api/3-app-dev-guide.html">Application developer guide</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-api/4-stack-dev-guide.html">Cloud connection developer guide</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-api/5-stack-components.html">Built-in Cloud Services</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Cloud Platforms Connection"></input>
                    <label class="nav-header" for="Cloud Platforms Connection" style="display:block; cursor:pointer">Cloud Platforms Connection</label>
                    <div>
                      
                      <li><a href="/kura/cloud-stacks/kura-ec-cloud.html">Eurotech Everyware Cloud&trade; platform</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-stacks/kura-aws-cloud.html">Amazon AWS IoT&trade; platform</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-stacks/kura-azure.html">Azure IoT Hub&trade; platform</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-stacks/kura-kapua.html">Eclipse Kapua&trade; platform</a></li>
                      
                
                  
                      <li><a href="/kura/cloud-stacks/kura-hono.html">Eclipse Hono&trade; platform</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Apache Camel Integration"></input>
                    <label class="nav-header" for="Apache Camel Integration" style="display:block; cursor:pointer">Apache Camel Integration</label>
                    <div>
                      
                      <li><a href="/kura/camel/kura-camel.html">Apache Camel™ integration</a></li>
                      
                
                  
                      <li><a href="/kura/camel/kura-camel-app.html">Apache Camel™ as application</a></li>
                      
                
                  
                      <li><a href="/kura/camel/kura-camel-cloud.html">Apache Camel™ Cloud Service</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Connect Field Devices"></input>
                    <label class="nav-header" for="Connect Field Devices" style="display:block; cursor:pointer">Connect Field Devices</label>
                    <div>
                      
                      <li><a href="/kura/devices/1-driver-and-assets.html">Drivers, Assets and Channels</a></li>
                      
                
                  
                      <li><a href="/kura/devices/2-field-protocols.html">Field Protocols</a></li>
                      
                
                  
                      <li><a href="/kura/devices/3-1-asset-implemetation.html">Asset implementation</a></li>
                      
                
                  
                      <li><a href="/kura/devices/3-driver-implemetation.html">Driver implementation</a></li>
                      
                
                  
                      <li><a href="/kura/devices/4-IO-apis.html">I/O APIs</a></li>
                      
                
                  
                      <li><a href="/kura/devices/5-s7-driver.html">S7comm Driver</a></li>
                      
                
                  
                      <li><a href="/kura/devices/6-opcua-driver.html">OPC UA Driver</a></li>
                      
                
                  
                      <li><a href="/kura/devices/1-gpio-driver.html">GPIO Driver</a></li>
                      
                
                  
                      <li><a href="/kura/devices/2-beacon-drivers.html">BLE Beacon Drivers</a></li>
                      
                
                  
                      <li><a href="/kura/devices/sensortag-driver.html">TI SensorTag Driver</a></li>
                      
                
                  
                      <li><a href="/kura/devices/sensehat-driver.html">RaspberryPi SenseHat driver</a></li>
                      
                
                  
                      <li><a href="/kura/devices/xdk-driver.html">Xdk Driver</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Kura Wires"></input>
                    <label class="nav-header" for="Kura Wires" style="display:block; cursor:pointer">Kura Wires</label>
                    <div>
                      
                      <li><a href="/kura/wires/kura-wires-intro.html">Kura Wires overview</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-dbfilter.html">How to use DB Store and Filter components in Kura Wires</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-fifo.html">FIFO Wire Component</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-opcua.html">OPC/UA application in Kura Wires</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-sensortag.html">TI SensorTag driver in Kura Wires</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-namespace.html">Kura Wires MQTT namespace</a></li>
                      
                
                  
                      <li><a href="/kura/wires/1-kura-wires-script-filter.html">Script Filter Wire component</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-gpio.html">GPIO driver in Kura Wires</a></li>
                      
                
                  
                      <li><a href="/kura/wires/1-kura-wires-multiport.html">Multiport wire components</a></li>
                      
                
                  
                      <li><a href="/kura/wires/2-kura-wires-conditional.html">Conditional component</a></li>
                      
                
                  
                      <li><a href="/kura/wires/3-kura-wires-join.html">Join component</a></li>
                      
                
                  
                      <li><a href="/kura/wires/4-kura-wires-math.html">Mathematical components example</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-statistical.html">Statistical components examples</a></li>
                      
                
                  
                      <li><a href="/kura/wires/1-kura-wires-eddystone.html">Connect to a RuuviTag+ using the Eddystone&trade; Driver</a></li>
                      
                
                  
                      <li><a href="/kura/wires/kura-wires-ibeacon.html">iBeacon&trade; driver in Kura Wires</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Development"></input>
                    <label class="nav-header" for="Development" style="display:block; cursor:pointer">Development</label>
                    <div>
                      
                      <li><a href="/kura/dev/kura-setup.html">Getting Started</a></li>
                      
                
                  
                      <li><a href="/kura/dev/hello-example.html">Hello World Example</a></li>
                      
                
                  
                      <li><a href="/kura/dev/deploying-bundles.html">Deploying Bundles</a></li>
                      
                
                  
                      <li><a href="/kura/dev/remote-debugging.html">Remote debugging on target platform</a></li>
                      
                
                  
                      <li><a href="/kura/dev/configurable_component.html">Configurable Application</a></li>
                      
                
                  
                      <li><a href="/kura/dev/heater_demo.html">Publishing Application</a></li>
                      
                
                  
                      <li><a href="/kura/dev/serial-example.html">Serial Example</a></li>
                      
                
                  
                      <li><a href="/kura/dev/kura-dio-apis.html">Device I/O</a></li>
                      
                
                  
                      <li><a href="/kura/dev/kura-modbus-protocol.html">Modbus Protocol</a></li>
                      
                
                  
                      <li><a href="/kura/dev/watchdog-service.html">How to Use Watchdog</a></li>
                      
                
                  
                      <li><a href="/kura/dev/how-to-manage-network-settings.html">How to Manage Network Settings</a></li>
                      
                
                  
                      <li><a href="/kura/dev/bluetooth-le-example.html">Legacy Bluetooth LE Example</a></li>
                      
                
                  
                      <li><a href="/kura/dev/bluetooth-le-beacon-example.html">Legacy BLE Beacon Example</a></li>
                      
                
                  
                      <li><a href="/kura/dev/bluetooth-le-beacon-scanner-example.html">Legacy BLE Beacon Scanner Example</a></li>
                      
                
                  
                      <li><a href="/kura/dev/bluetooth-le-apis.html">Kura Bluetooth LE APIs</a></li>
                      
                
                  
                      <li><a href="/kura/dev/beacon-apis.html">Kura Beacon APIs</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Reference"></input>
                    <label class="nav-header" for="Reference" style="display:block; cursor:pointer">Reference</label>
                    <div>
                      
                      <li><a href="/kura/ref/mqtt-namespace.html">Kura Remote Device Management</a></li>
                      
                
                  
                      <li><a href="/kura/ref/api-ref.html">API Reference</a></li>
                      
                
                  
                      <li><a href="/kura/ref/hardware-targets.html">Hardware Targets</a></li>
                      
                
                  
                      <li><a href="/kura/ref/asset-v1.html">ASSET-V1 MQTT Namespace</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
              </div>
            
              
              

              <div>
                
                  
                    <input type="checkbox" style="display:none" id="Quality Assurance"></input>
                    <label class="nav-header" for="Quality Assurance" style="display:block; cursor:pointer">Quality Assurance</label>
                    <div>
                      
                      <li><a href="/kura/qa/intro.html">Introduction</a></li>
                      
                
                  
                      <li><a href="/kura/qa/unit-testing.html">Unit Testing</a></li>
                      
                
                  
                      <li><a href="/kura/qa/system-testing.html">System Testing</a></li>
                      
                    </div>
                  
                
              </div>
            
              
              

              <div>
                
              </div>
            
          </ul>
        </div>
        <div class="col-md-9 main-content">
          <div class="page-header">
  <h1>H2 Database: Features and Usage </h1>
</div>

<div class="row">
  <div class="col-xs-12">
      <ul>
  <li><a href="#supported-features">Supported features</a></li>
  <li><a href="#limitations">Limitations</a></li>
  <li><a href="#changes-to-database-related-components">Changes to database related components</a></li>
  <li><a href="#usage">Usage</a>
    <ul>
      <li><a href="#creating-a-new-h2-database-instance">Creating a new H2 database instance</a></li>
      <li><a href="#selecting-a-database-instance-for-existing-kura-components">Selecting a database instance for existing Kura components</a></li>
      <li><a href="#enabling-the-tcp-server">Enabling the TCP Server</a></li>
      <li><a href="#using-the-web-console">Using the Web console</a></li>
      <li><a href="#changing-the-password">Changing the password</a></li>
    </ul>
  </li>
  <li><a href="#persistence-modes">Persistence Modes</a></li>
</ul>

<p>Starting from version 3.1.0, Eclipse Kura includes the <a href="http://www.h2database.com/html/main.html">H2 database engine</a>. This document provides a description of the main features of the H2 database integrated with Eclipse Kura and gives some basic information about its usage.</p>

<h3 id="supported-features">Supported Features</h3>

<p>Eclipse Kura supports the following H2 database features:</p>

<ul>
  <li>
    <p><strong>Persistence modes</strong>: The H2 implementation currently supports in-memory and file-based database instances. See
<a href="#persistence-modes">Persistence Modes</a> for more details.</p>
  </li>
  <li>
    <p><strong>Multiple database instances</strong>: It is possible to create and configure multiple database instances from the Kura Web UI, these instances can be selectively consumed by applications. A default database instance is created automatically.</p>
  </li>
  <li>
    <p><strong>TCP Server</strong>: The current implementation allows external processes to access the database instances managed by Kura using TCP. This enables the integration of external applications that can share data with Kura components using the database.</p>
  </li>
  <li>
    <p><strong>Web based console</strong>: It is possible to start the H2 Web console directly from the Kura Web UI. The console can be used to inspect the database contents and perform arbitrary queries for debug purposes.</p>
  </li>
  <li>
    <p><strong>Basic credential management</strong>: The current implementation allows to change the password of the admin DB user from the Kura Web UI. This allows to restrict access to existing database instances.</p>
  </li>
</ul>

<h3 id="limitations">Limitations</h3>

<p>The following list briefly describes some limitations of the H2 database integrated with Eclipse Kura:</p>

<ul>
  <li>
    <p><strong>Private in-memory instances</strong>: Only named in-memory instances are supported (e.g. <code class="language-plaintext highlighter-rouge">jdbc:h2:mem:&lt;dbname&gt;</code>, where <code class="language-plaintext highlighter-rouge">&lt;dbname&gt;</code> is not the empty string), private instances represented by the <code class="language-plaintext highlighter-rouge">jdbc:h2:mem:</code> URL are currently not supported.</p>
  </li>
  <li>
    <p><strong>Remote connections</strong>: The current implementation only supports embedded database instances. Connecting to remote instances using the <code class="language-plaintext highlighter-rouge">jdbc:h2:tcp:*</code> and <code class="language-plaintext highlighter-rouge">jdbc:h2:ssl:*</code> connector URLs is not supported.</p>
  </li>
</ul>

<h3 id="changes-to-database-related-components">Changes to database related components</h3>

<p>The DataService in Eclipse Kura uses the H2 database by default for implementing the message store. However, there is no support for migrating an old HSQLDB database to the new H2.</p>

<p>The new <code class="language-plaintext highlighter-rouge">H2DbWireRecordFilter</code> and <code class="language-plaintext highlighter-rouge">H2DbWireRecordStore</code> Wire components have been added. These components provide the same functionalities offered by the HSQL based <code class="language-plaintext highlighter-rouge">DbWireRecordFilter</code> and <code class="language-plaintext highlighter-rouge">DbWireRecordStore</code> components, but using the H2 database. The legacy components will continue to be available in order to keep backward compatibility, but will be deprecated since Kura 3.1.0 and should not be used for new installations.</p>

<h3 id="usage">Usage</h3>

<h4 id="creating-a-new-h2-database-instance">Creating a new H2 database instance</h4>

<p>To create a new H2 database instance, use the following procedure:</p>

<ol>
  <li>Open the Kura Web UI press and on the <code class="language-plaintext highlighter-rouge">+</code> button in the side menu, under the <strong>Services</strong> section. A pop-up dialog should appear.</li>
  <li>Select <code class="language-plaintext highlighter-rouge">org.eclipse.kura.core.db.H2DbService</code> from the <strong>Factories</strong> drop down list, enter an arbitrary name for the new instance and click <strong>Apply</strong>.</li>
</ol>

<p><img src="/kura/assets/images/database/new_instance.png" alt="New instance" /></p>

<ol start="3">
  <li>An entry for the newly created instance should appear in the side menu under <strong>Services</strong>, click on it to review its configuration:</li>
</ol>

<p><img src="/kura/assets/images/database/instance_config.png" alt="Instance configuration" /></p>

<ol start="4">
  <li>Change the settings if needed and then click <strong>Apply</strong>.</li>
</ol>

<p>For more information about the DB URL format see http://www.h2database.com/html/features.html and <a href="#persistence-modes">Persistence Modes</a>.</p>

<p>It is not possible to create different DB instances that manage the same DB url. When creating a new instance please make sure that the URL specified in the <strong>db.connector.url</strong> field is not managed by another instance.</p>

<h4 id="selecting-a-database-instance-for-existing-kura-components">Selecting a database instance for existing Kura components</h4>

<p>A database instance is identified by its <em>Kura service pid</em>. The pid for the default instance is <code class="language-plaintext highlighter-rouge">org.eclipse.kura.db.H2DbService</code>, the pid for instances created using the Web UI is the string entered in the <strong>Name</strong> field at step 2 of the previous section.</p>

<p>The built-in Kura components that use database functionalities allow user to specify which instance to use in their configuration. These components are the <code class="language-plaintext highlighter-rouge">DataService</code> component of the cloud stack and the <code class="language-plaintext highlighter-rouge">H2DbWireRecordFilter</code> and <code class="language-plaintext highlighter-rouge">H2DbWireRecordStore</code> wire components.</p>

<p>The configuration of each component contains a property that allows specifying the service pid of the desired instance:</p>

<ul>
  <li>
    <p><strong>DataService</strong>
<img src="/kura/assets/images/database/dataservice.png" alt="Data Service" />
The pid of the database instance can be specified using the <strong>store.db.service.pid</strong> field.</p>
  </li>
  <li>
    <p><strong>DbWireRecordFilter</strong>
<img src="/kura/assets/images/database/dbfilter.png" alt="Db Filter" />
The pid of the database instance can be specified using the <strong>db.service.pid</strong> field.</p>
  </li>
  <li>
    <p><strong>DbWireRecordStore</strong>
<img src="/kura/assets/images/database/dbstore.png" alt="Db Store" />
The pid of the database instance can be specified using the <strong>db.service.pid</strong> field.</p>
  </li>
</ul>

<h4 id="enabling-the-tcp-server">Enabling the TCP Server</h4>

<p>The TCP server can be used by creating an <code class="language-plaintext highlighter-rouge">H2DbServer</code> instance:</p>

<ol>
  <li>
    <p>Open the Kura Web UI press and on the <code class="language-plaintext highlighter-rouge">+</code> button in the side menu, under the <strong>Services</strong> section. A pop-up dialog should appear.</p>
  </li>
  <li>
    <p>Select <code class="language-plaintext highlighter-rouge">org.eclipse.kura.core.db.H2DbServer</code> from the <strong>Factories</strong> drop down list, enter an arbitrary name for the new instance and click <strong>Apply</strong>.</p>
  </li>
</ol>

<p><img src="/kura/assets/images/database/new_server_instance.png" alt="New instance" /></p>

<ol start="3">
  <li>Click on the name of the new server instance in the left side of the Web Ui. The configuration of the server component will appear:</li>
</ol>

<p><img src="/kura/assets/images/database/server.png" alt="Server" /></p>

<ol start="4">
  <li>
    <p>Set the <strong>db.server.type</strong> field to <code class="language-plaintext highlighter-rouge">TCP</code></p>
  </li>
  <li>
    <p>Review the server options under <strong>db.server.commandline</strong>, check http://www.h2database.com/javadoc/org/h2/tools/Server.html for more information about the available options.</p>
  </li>
</ol>

<p>The default settings, <code class="language-plaintext highlighter-rouge">-tcpPort 9123 -tcpAllowOthers -ifExists</code>, configure the server to bind on port 9123, to allow connections from any host and to allow access only to existing databases.</p>

<ol>
  <li>
    <p>Set the <strong>db.server.enabled</strong> to <code class="language-plaintext highlighter-rouge">true</code>.</p>
  </li>
  <li>
    <p>The server is now listening on the specified port.</p>
  </li>
</ol>

<p>Make sure to review the firewall configuration in order to ensure that the server is reachable from the external process.</p>

<h4 id="enabling-the-web-console">Enabling the Web console</h4>

<p>In order to enable the H2 Web console, proceed as follows:</p>

<ol>
  <li>
    <p>Create a new <code class="language-plaintext highlighter-rouge">H2DbServer</code> instance like in the previous section.</p>
  </li>
  <li>
    <p>Set the <strong>db.server.type</strong> field to <code class="language-plaintext highlighter-rouge">WEB</code></p>
  </li>
  <li>
    <p>Enter appropriate parameters for the Web server in the <strong>db.server.commandline</strong> field. An example of valid settings can be <code class="language-plaintext highlighter-rouge">-webPort 9123 -webAllowOthers -ifExists</code>.</p>
  </li>
  <li>
    <p>Set the <strong>db.server.enabled</strong> to <code class="language-plaintext highlighter-rouge">true</code>.</p>
  </li>
  <li>
    <p>The server is now listening on the specified port. Make sure to review the firewall configuration in order to ensure that the server is reachable from the external process.</p>
  </li>
  <li>
    <p>Use a browser to access the console. Open the <code class="language-plaintext highlighter-rouge">http://&lt;device-ip&gt;:&lt;web-console-port&gt;</code> URL, where <code class="language-plaintext highlighter-rouge">&lt;device-ip&gt;</code> is the IP address of the Kura device and <code class="language-plaintext highlighter-rouge">&lt;web-console-port&gt;</code> is the port specified at step 3.</p>
  </li>
</ol>

<p><img src="/kura/assets/images/database/console1.png" alt="" /></p>

<ol start="7">
  <li>Enter the DB URL as specified in the Kura configuration in the <strong>JDBC URL</strong> field and the credentials. Click on <strong>Connect</strong>, you should be able to access the console.</li>
</ol>

<p><img src="/kura/assets/images/database/console2.png" alt="" /></p>

<h4 id="changing-the-password">Changing the password</h4>

<p>The prerequisite for being able to change the password is that</p>

<ol>
  <li>
    <p>Open the configuration of the desired database instance in the Kura Web UI.</p>
  </li>
  <li>
    <p>Enter the new password in the <strong>db.password</strong> field.</p>
  </li>
  <li>
    <p>Click <strong>Apply</strong>.</p>
  </li>
</ol>

<div class="alert alert-warning">
  <strong>Note: </strong> <p>If the H2DbServer instance fails to open a database, it will delete and recreate all database files. This behavior is aimed at preventing potential issues caused by incorrect credentials in the configuration snapshots. It is highly recommended to perform a backup of an existing database before trying to open it using a H2DbService instance and before changing the password.</p>

</div>

<h3 id="persistence-modes">Persistence Modes</h3>

<p>The H2 database support several levels of persistence modes.</p>

<h4 id="in-memory">In memory</h4>

<p>An in-memory database instance can be created using the following URL structure: <code class="language-plaintext highlighter-rouge">jdbc:h2:mem:&lt;dbname&gt;</code>, where <code class="language-plaintext highlighter-rouge">&lt;dbname&gt;</code> is a non-empty string that represents the database name.
This configuration is suggested for database instances that are frequently updated.
Examples:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">jdbc:h2:mem:kuradb</code></li>
  <li><code class="language-plaintext highlighter-rouge">jdbc:h2:mem:mydb</code></li>
</ul>

<p>The default database instance is in-memory by default and uses the <code class="language-plaintext highlighter-rouge">jdbc:h2:mem:kuradb</code> URL.</p>

<h4 id="most-persistent">Most persistent</h4>

<p>A persistent database instance can be created using the <code class="language-plaintext highlighter-rouge">jdbc:h2:file:&lt;dbpath&gt;</code>, where <code class="language-plaintext highlighter-rouge">&lt;dbpath&gt;</code> is a non-empty string that represents the database path.</p>

<p>If no URL parameters are supplied the database will enable the transaction log by default. The transaction log is used to restore the database to a consistent state after a crash or power failure. This provides good protection against data losses but causes a lot of writes to the storage device, reducing both performance and the lifetime of flash-based storage devices.</p>

<p>This configuration is suggested for database instances that are rarely updated.
Examples:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">jdbc:h2:file:/opt/db/mydb</code></li>
</ul>

<p>Make sure to use absolute paths in the db URL since H2 does not support db paths relative to the working directory.</p>

<h4 id="mostly-persistent">Mostly persistent</h4>

<p>The transaction log can be disabled by appending the <code class="language-plaintext highlighter-rouge">LOG=0</code> parameter to the DB URL. In this way it is possible to reduce the stress on the underlying storage device and increase performance, at the expense of a higher probability of losing data in case of power failure.</p>

<p>In order to reduce the probability of data losses the H2DbService performs periodic checkpoints on the database. A checkpoint forces all pending modifications to be committed to the storage device. The interval in seconds between two consecutive checkpoints can be configured using the <strong>db.checkpoint.interval.seconds</strong> property.</p>

<p>This configuration is suggested for database instances with intermediate update rates.
Examples:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">jdbc:h2:file:/opt/db/mydb;LOG=0</code></li>
</ul>

<h4 id="filesystem-tuning">Filesystem tuning</h4>

<p>The H2 database might become corrupted [1] in case of power failure.
In case of file-backed database (e.g. mostly or most persistent), the following database mount options can improve database reliability, reducing the database corruption probability at the expense of reduced performance and lifetime of the flash storage devices:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">data=journal</code>: From EXT4(5) Linux MAN Page:</p>

    <blockquote>
      <p>All data is committed into the journal prior to being written into the main filesystem.</p>
    </blockquote>

    <p>This setting only applies to ext3/ext4 filesystems.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sync</code>: From mount(8) Linux MAN Page:</p>

    <blockquote>
      <p>All I/O to the filesystem should be done synchronously. In case of media with limited number of write cycles (e.g. some flash drives) “sync” may cause life-cycle shortening.</p>
    </blockquote>
  </li>
</ul>

<p>After some long running tests [1], it appears that the <code class="language-plaintext highlighter-rouge">data=journal</code> option alone is enough to reduce corruption probability (no corruption observed during the test).</p>

<p>[1] https://github.com/eclipse/kura/issues/2169</p>

<p>In order to apply the options above, perform the following steps:</p>

<p>1 - Edit the <code class="language-plaintext highlighter-rouge">/etc/fstab</code> row for the filesystem containing the database file, appending the desired options to the fourth column, using comma as separator.</p>

<p>For example on Raspbian an <code class="language-plaintext highlighter-rouge">/etc/fstab</code> file with <code class="language-plaintext highlighter-rouge">data=journal</code> enabled will look like the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proc            /proc           proc    defaults          0       0
PARTUUID=3920f25c-01  /boot           vfat    defaults          0       2
PARTUUID=3920f25c-02  /               ext4    defaults,noatime,data=journal  0       1
# a swapfile is not a swap partition, no line here
#   use  dphys-swapfile swap[on|off]  for that
</code></pre></div></div>

<p>2 - If the database resides on the root filesystem, the <code class="language-plaintext highlighter-rouge">data=journal</code> option must be specified in the kernel command line as well, by appending <code class="language-plaintext highlighter-rouge">rootflags=data=journal</code></p>

<p>On Raspbian this can be done by editing the <code class="language-plaintext highlighter-rouge">/boot/cmdline.txt</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=PARTUUID=3920f25c-02 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait rootflags=data=journal
</code></pre></div></div>

  </div>
</div>


          <hr>
          <footer>
            <p>
              <span class="pull-right text-muted">
                Documentation for Eclipse Kura™
              </span>
            </p>
          </footer>
        </div>
      </div>
    </div>

    <script src="/kura/assets/themes/bootstrap/resources/jquery/jquery.min.js"></script>
    <script src="/kura/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

